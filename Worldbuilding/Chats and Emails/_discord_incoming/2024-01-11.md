# Discord DM – 2024-01-11

[2024-01-11 09:43 AM] Deciusmus: Depending on what my afternoon looks like, here is the workflow I am thinking of trying to implement:
    
    1. Run the "prepare for export" template in the vault. This will:
       (step 1) process all files with a headerversion attribute and make headers static
       (step 2) read main.md and recursively follow its links, setting shared: true in the front matter of any reachable page. Pages in MOC, DM, and Worldbuilding will be skipped and so the won't count for reachability.
       (step 3) read all files and update the links to be markdown links rather than wikilinks. This will remove links that point to files where shared: true doesn't exist, and will point to index.md on files that share a name with their immediate parent direction
    
    2. Run the github publisher above, with no modification of file content, exporting only shared: true, and converting folder named-files to index.md. This will push to the docs folder in the website repo.
    
    3. Github actions triggers MkDocs which uses taelgar_hooks.py to strip comments and strip `%%`Campaign:`%%` and `%%`Date:`%%` stuff
[2024-01-11 11:09 AM] rsulfuratus: I'm not going to mess around with websites until after the session tonight (most likely over the long weekend), but my plan is to work on taelgar_hooks.py which will be configurable by a website.json file, and will by default strip comments/campaign/date and optionally (a) slugify files, (b) convert links, and (c) skip files by name/glob/graph/tag/graph connectivity
[2024-01-11 11:13 AM] Deciusmus: (b) and (c) are duplicative of what I'm proposing in the js code above
[2024-01-11 11:18 AM] rsulfuratus: but you can't slugify files without also fixing links
[2024-01-11 11:18 AM] rsulfuratus: otherwise all your links will break because they don't point to a file anymore
[2024-01-11 11:19 AM] rsulfuratus: but actually i don't think it matters if there is both a js and a python implementation with slightly different twists
[2024-01-11 11:20 AM] Deciusmus: well, you can convert `[The Cleansed]`(The%20Cleansed.md) to `[The Cleansed]`(the-cleansed.md)
[2024-01-11 11:20 AM] Deciusmus: i.e. the order should probably be convert->`slugify
[2024-01-11 11:28 AM] rsulfuratus: for mkdocs you need `[The Cleansed]`(../../Groups/the-cleansed.md)
[2024-01-11 11:28 AM] Deciusmus: Right but I was going to do that via the javascript prepare for export
[2024-01-11 11:47 AM] Deciusmus: not the slugifying
[2024-01-11 11:47 AM] Deciusmus: but the convert to MD links
[2024-01-11 11:48 AM] Deciusmus: which I think is trivial with the obisidian api as it gives you a list of inks on the page
[2024-01-11 12:41 PM] rsulfuratus: poking around a little, i actually think that handling the relative link generation is best done as an mkdocs plugin, since that means that the folder names can change / move as desired to e.g. generate a nice nav structure or whatever
[2024-01-11 12:42 PM] rsulfuratus: we already enforce unique file names so it is pretty trivial to just let a plugin handle converting `[Link Text]`(note-name.md) to proper relative links
[2024-01-11 12:42 PM] rsulfuratus: that also allows slugification of folder names if desired
[2024-01-11 12:42 PM] Deciusmus: The biggest issue I’ve seen is folder notes
[2024-01-11 12:43 PM] Deciusmus: Lots of existing tools that turn wiki links into markdown and lots of tools that turn Sembara/Semabara.md into Sembara/index.md
[2024-01-11 12:44 PM] rsulfuratus: there are lots of plugins to handle that though, e.g. something like https://pypi.org/project/mkdocs-literate-nav/
[2024-01-11 12:44 PM] Deciusmus: But I haven’t found anything that works together to let the link like [[Sembara]] become `[Sembara]`(sembara/index.md)
[2024-01-11 12:44 PM] Deciusmus: I looked at literate nav it requires specifying the entire tree which is too much work
[2024-01-11 12:45 PM] rsulfuratus: i think you'd need to do it programatically. but if you want slugified urls and nice looking nav there is as far as I can tell no other choice
[2024-01-11 12:47 PM] rsulfuratus: e.g. you can either use index.md and section notes to have:
    Greater Sembaba link to Gazetteer/Greater Sembara/index.md
    
    but then either the url is:
    Gazetteer/Greater%20Sembara
    
    or the nav display is:
    greater-sembara (or I guess Greater-Sembara)
[2024-01-11 12:47 PM] rsulfuratus: if you programatically generate an actual nav, you can have:
    Greater Sembara ->` gazetteer/greater-sembara/greater-sembara.md
[2024-01-11 12:48 PM] rsulfuratus: at least as I understand it
[2024-01-11 12:49 PM] Deciusmus: Yes I think that is probably true. I didn’t think about the implications of slugifying links
[2024-01-11 12:50 PM] Deciusmus: Although if you programmatically generating the entire nav the actual folder structure doesn’t matter at all
[2024-01-11 12:52 PM] Deciusmus: And also no reason to rename to index.md
[2024-01-11 12:53 PM] rsulfuratus: right, I think actually not have the nav tied to the folder structure is a big positive. e.g., for the my version of taelgarverse I might want a top level nav item: "Campaign Notes" which points to Dunmari Frontier, and the top level nav item "Other Campaigns" which points to other campaigns
[2024-01-11 12:54 PM] Deciusmus: Right.
[2024-01-11 12:54 PM] rsulfuratus: I also might want to explicitly exclude ~Unnamed~ files from nav
[2024-01-11 12:54 PM] Deciusmus: So the GitHub publisher plug-in I linked above is pretty good at publishing and renaming wiki links —- it just can’t handle folder notes
[2024-01-11 12:55 PM] rsulfuratus: see also: https://oprypin.github.io/mkdocs-gen-files/
[2024-01-11 12:55 PM] Deciusmus: But maybe folder notes are the wrong approach and having the hook generate the nav on the mkdocs size is better
[2024-01-11 12:56 PM] Deciusmus: `*`side
[2024-01-11 12:57 PM] Deciusmus: I almost have the “set shared:true” in the front matter of all reachable files working
[2024-01-11 12:58 PM] rsulfuratus: this is also quite powerful: https://github.com/fralau/mkdocs-macros-plugin
[2024-01-11 12:58 PM] Deciusmus: And from there — as long as I don’t care about the nav having 
    
    Sembara:
    * Sembara
    
    The GitHub publish works really well
[2024-01-11 12:58 PM] rsulfuratus: I am not ever going to use the github publish workflow because I am basically 100% certain it is not going to work with my secrets filter
[2024-01-11 12:59 PM] Deciusmus: That is true it won’t
[2024-01-11 01:00 PM] rsulfuratus: so my build process is always going to be pull a fresh copy of taelgar repo into the source dir (which will have secrets as `%%`SECRET`[1]``%%`), and then run the export code, and push
[2024-01-11 01:00 PM] Deciusmus: I mean, secrets will get stripped correctly by the mkdocs plugin so it depends a bit on whether you care if the GitHub repo for your taelgarverse has the secrets or not
[2024-01-11 01:00 PM] Deciusmus: But the advantage of the shared: true approach is that it doesn’t require agreement on what to push to where or how
[2024-01-11 01:01 PM] Deciusmus: A python hook can just only include markdowns with shared true
[2024-01-11 01:01 PM] rsulfuratus: right I'm also not sure that I actually want to strip non-linked pages
[2024-01-11 01:01 PM] rsulfuratus: so that will be optional in the python hook
[2024-01-11 01:02 PM] Deciusmus: Right. Maybe I should call the front matter “rooted: true”
[2024-01-11 01:02 PM] Deciusmus: It just means there is no need to calculate rooted in python. If you want to know if a page is rooted just check the front matter
[2024-01-11 01:03 PM] rsulfuratus: rooted is trivial with the obsidiantools package but annoying complicated otherwise
[2024-01-11 01:04 PM] rsulfuratus: but obsidiantools is quite slow on a big set of files so would prefer not to have to install and run that as a github action or the website will take 20 minutes to build
[2024-01-11 01:04 PM] rsulfuratus: so that is quite nice to have in the metadata
[2024-01-11 02:20 PM] Deciusmus: Rooted is quite complex because ultimately almost everything is rooted from anywhere
[2024-01-11 02:27 PM] rsulfuratus: roamlinks looks like it handles wikilinks quite well: https://github.com/Jackiexiao/mkdocs-roamlinks-plugin/blob/master/tests/test_plugin.py
[2024-01-11 02:27 PM] Deciusmus: I mean, it isn't complicated per se, it is just pointless without more work
[2024-01-11 02:28 PM] rsulfuratus: the big thing is just making sure that the files are slugified because it converts [[File Name]] to `[File Name]`(file_name.md)
[2024-01-11 02:39 PM] rsulfuratus: actually nevermind, roamlinks seems to work completely fine for all wikilinks
[2024-01-11 02:39 PM] rsulfuratus: so I think no need to fix links
[2024-01-11 02:40 PM] Deciusmus: right, if no folder pages (because nav is generated)
[2024-01-11 02:46 PM] Deciusmus: Ok I have the rooted stuff working
[2024-01-11 02:46 PM] Deciusmus: It starts from main.md and follows links recursively, seetting "rooted: true" on each page it reaches
[2024-01-11 02:47 PM] Deciusmus: if a page has excludeRooted: `["key", "key2" ]` then links on that page are not followed
[2024-01-11 02:47 PM] Deciusmus: you specify the key when you start the export
[2024-01-11 02:47 PM] Deciusmus: i.e. excludeRooted: `["Clee"]` set on a page means if you are generating rooted things for Clee, don't follow links on that page
[2024-01-11 02:53 PM] rsulfuratus: okay roamlinks works fine but it is annoying slow, since it walks the directory tree for every link it finds, instead of caching information, so it takes 3-4 minutes to build the website
[2024-01-11 03:14 PM] rsulfuratus: mkdocs uses the `title` metadata field to determine document names, so you get a bunch of `Lord` etc in the nav panel
[2024-01-11 03:32 PM] Deciusmus: ok, I am going to push a change which updates the prepare for export template so that it adds rooted: true
[2024-01-11 03:32 PM] Deciusmus: it starts from main.md, follows paths, sets rooted: true in header
[2024-01-11 03:33 PM] Deciusmus: you can make a page not be part of the path follow via 
    excludedRooted: `[key]` as above
[2024-01-11 03:33 PM] Deciusmus: I've addeda  bunch of excludedRooted: `["Clee"]` to various pages
[2024-01-11 06:36 PM] Deciusmus: I've been messing around with images:
    
    Obsidian:
![[../_discord_assets/image-9E176.png]]

