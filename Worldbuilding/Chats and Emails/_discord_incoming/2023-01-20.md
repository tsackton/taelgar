# Discord DM â€“ 2023-01-20

[2023-01-20 07:55 AM] Deciusmus: I was rethinking the whereabouts stuff a bit this morning. It is going to be very difficult to export it correctly at the moment because it depends on reading the obsidian vault data to determine if it should link the location or not, and python is not easily going to have access to that.
    
    I was thinking maybe it would make sense to have only current location be live (and just not export that)
[2023-01-20 08:17 AM] rsulfuratus: I was rethinking a bit too just because it is going to be a pain to query origin / home with data view
[2023-01-20 08:24 AM] rsulfuratus: I donâ€™t think the python is an issue though, you just have flags for the config elements
[2023-01-20 09:42 AM] Deciusmus: I meant the logic that auto-links if the region exists
[2023-01-20 09:42 AM] Deciusmus: i.e. does [[region]] vs region
[2023-01-20 09:43 AM] Deciusmus: python is going to have a hard time replicating that I think
[2023-01-20 09:43 AM] rsulfuratus: ah. yes, that will be difficult since my python script doesn't currently have access to a list of files in your vault
[2023-01-20 09:43 AM] rsulfuratus: hmm. actually, it does.
[2023-01-20 09:44 AM] rsulfuratus: this might be pretty trivial
[2023-01-20 09:45 AM] rsulfuratus: for obsidianhtml need to export links in the form: `[region]`(relative/path/to/region/file.md), not [[region]]
[2023-01-20 09:46 AM] rsulfuratus: but I think this is only a few lines of code with the right modules. but will add dependencies to the python script you'll need to install
[2023-01-20 09:51 AM] rsulfuratus: yeah this is like 3 lines of code since I already have all the md files in your vault
[2023-01-20 09:52 AM] rsulfuratus: you'll need to install https://docs.python.org/3/library/pathlib.html
[2023-01-20 09:53 AM] Deciusmus: Either way...
    
    I don't actually know if there is much value in having the origin/home/party last seen stuff by dynamic
[2023-01-20 09:53 AM] rsulfuratus: origin, sure
[2023-01-20 09:54 AM] Deciusmus: For party last seen, exporting it as
    `%%`Campaign:xxx%$
    last seen by: 
    `%%`%
[2023-01-20 09:54 AM] Deciusmus: probably makes more sense
[2023-01-20 09:54 AM] Deciusmus: the chance of both of us wanting to set it for different parties is actually pretty low
[2023-01-20 09:54 AM] Deciusmus: That leaves home. Which for something like what, 90% of people, doesn't change over the course of their fictional life
[2023-01-20 09:55 AM] Deciusmus: in which case again, who cares
[2023-01-20 09:55 AM] Deciusmus: It only really matters for people who moved homes between 1719 and 1748
[2023-01-20 09:55 AM] rsulfuratus: yeah, the issue is it is simpler to have home dynamic for everyone to handle the 5 edge cases, or is it easier to have a better way to handle edge cases?
[2023-01-20 10:00 AM] Deciusmus: So I think there are two different questions
[2023-01-20 10:00 AM] Deciusmus: The first one is whether we should have the whereabouts processing (outside of current location) move to the template generation
[2023-01-20 10:00 AM] Deciusmus: So still driven by whereabouts, but baked into the MD file
[2023-01-20 10:02 AM] Deciusmus: conceptually, if you really had someone with different homes you could always export it to the YAML as:
    
    `%%`^Date:1719-1740`%%`
    Home: blah, blah
    `%%`Date`%%`
    `%%`^Date:1740`%%`
    Home:blah,blah
    `%%`
    
    Your python script might need a minor update to allow a date end, i.e. string the date:1719-1740 unless the date is between those two values
[2023-01-20 10:03 AM] Deciusmus: That makes the obsidian note slightly less nice to read at the upside of making the export to html easier
[2023-01-20 10:04 AM] Deciusmus: The other question is whether we should simplify origin / home outside of whereabouts
[2023-01-20 10:04 AM] Deciusmus: The downside of that is that for home at least it is quite difficult to simplify
[2023-01-20 10:05 AM] Deciusmus: unless you lose the ability to have different homes...
[2023-01-20 10:05 AM] Deciusmus: Is the dv query to find the current home actually that hard?
[2023-01-20 10:06 AM] rsulfuratus: the tricky bit is the logic to determine if the first date in the whereabouts is origin or home, since based on the current setup that requires that you compare to born and correct for missing born information
[2023-01-20 10:07 AM] rsulfuratus: I was wondering about just manually specifying, e.g:
    ```
    whereabouts:
         - { date: 1734-01-01, place: "Ko'zula village", region: The Central Highlands, type: origin}
         - { date: 1734-01-02, place: "Ko'zula village", region: The Central Highlands, type: home}
         - { date: 1748-01-02, place: "Forest of Nightmares", region: The Central Highlands, type: excursion}
    ```
[2023-01-20 10:08 AM] Deciusmus: ah
[2023-01-20 10:08 AM] rsulfuratus: could have a script that fills in type based on the current logic
[2023-01-20 10:09 AM] Deciusmus: that's a good idea
[2023-01-20 10:09 AM] Deciusmus: you could then make date optional
[2023-01-20 10:09 AM] rsulfuratus: exactly
[2023-01-20 10:10 AM] Deciusmus: So what about the following set of changes
[2023-01-20 10:15 AM] Deciusmus: 1. Whereabouts Spec Change:
    
    * Use type: of origin, home, excursion and date is optional
    * "origin" is calculated as first whereabouts with type origin (expected to be single one))
    * "home" is calculated as:
    *** If there is a single value with home, it is home, and the date is ignored/optional
    *** If there are multiple values with home, the most recent whereabouts with type home where the date is before or equal to the current campaign date. 
    * "current" is calculated as it is today
    * "last party seen" is calculated as it is today
[2023-01-20 10:18 AM] rsulfuratus: I think that would work
[2023-01-20 10:18 AM] rsulfuratus: allows for most people just setting origin if desired and home, without needing dates
[2023-01-20 10:18 AM] Deciusmus: Right
[2023-01-20 10:20 AM] Deciusmus: 2. Whereabouts Header Generation Change
    
    * The generate header Javascript is modified to bake the origin into the header markdown, rather than using a dataview
    * The generate header Javascript is modified to bake the party last seen location into the markdown, under a `%%` Campaign `%%` export filter, on the assumption that each campaign will have a distinct set of "important" NPCs where the last seen by party date is worth setting.
    *** If any NPCs come up where we want to manage for two campaigns, discuss a solution then.
[2023-01-20 10:21 AM] Deciusmus: 3. The existing get_Whereabouts is modified to be a get_CurrentWhereabouts and it just returns the current location. The python export can (for now) just strip this.
[2023-01-20 10:26 AM] Deciusmus: That leaves home. Two options:
    
    Option 1: Bake in.
    The generate header Javascript is modified to create a Based in: line for EACH home region, protected under a `%%`Date`%%` export filter (which would need to be modified to include an end date).
    Pros: Keeps export working fine without more work; prevents a lot of flux as the export and Javascript diverge. 
    Cons: Actual note in obsidian slightly messy for complex characters with multiple home regions. Also not live with whereabouts changes.
    
    Option 2: Keep dynamic.
    Create a get_HomeRegion DataView function which exports the home for the current campaign date or "" if no home. The header includes this in the right spot and it gets reimplmeneted in python.
    Pros: Neater obsidian note. Live with whereabouts changes.
    Cons: More work to get the export working.
    
    Option 3: Both.
    If there is a single home region, the Javascript bakes it into the generated markdown. If there are multiples, it inserts a get_HomeRegion DV.
    Pros: Neater markdown in Obsidian. Simple characters with a single home region have working export immediately.
    Cons: Still need to create a get_HomeRegion to support characters with complex histores.
[2023-01-20 10:28 AM] Deciusmus: Thoughts?
[2023-01-20 10:30 AM] rsulfuratus: generally speaking the annoying part about the python export functions is not replicating the core date extraction code, but all the ancillary formatting, which easily diverges
[2023-01-20 10:31 AM] rsulfuratus: I might think a bit this weekend about a better way to do this, perhaps using a json config file that both dataview and python can read, which would make the python functions way simpler to implement and would make option 2 a lot more straightforward
[2023-01-20 10:31 AM] rsulfuratus: I guess the other issue here is that we need to agree on whether origin is always displayed or not, if origin == home
[2023-01-20 10:32 AM] Deciusmus: I'm happy to always display origin
[2023-01-20 10:32 AM] Deciusmus: and party last seen
[2023-01-20 10:32 AM] Deciusmus: I just don't like displaying current location unless it is different than home
[2023-01-20 10:32 AM] rsulfuratus: right
[2023-01-20 10:32 AM] Deciusmus: I would also like my export to never show current location, which is one advantage of breaking it up
[2023-01-20 10:32 AM] rsulfuratus: yeah
[2023-01-20 10:32 AM] rsulfuratus: me too
[2023-01-20 10:33 AM] Deciusmus: One option would be to have something like:
    
    get_CurrentFantasyDate
    get_CurrentWhereabouts
[2023-01-20 10:34 AM] Deciusmus: then the template could insert:
    
    >`>` Current location (on $=dv.view("get_CurrentFantasyDate"):  $=dv.view("get_CurrentWhereabouts")
[2023-01-20 10:34 AM] Deciusmus: and the ancillary formatting wouldn't need to change
[2023-01-20 10:34 AM] Deciusmus: or I guess
[2023-01-20 10:34 AM] Deciusmus: for current location that is not needed
[2023-01-20 10:35 AM] Deciusmus: nevermind
[2023-01-20 10:35 AM] Deciusmus: for current location it is better to have it all in a view
[2023-01-20 10:35 AM] Deciusmus: ignore me
[2023-01-20 10:35 AM] Deciusmus: and in fact, because of blank home strings, you can't really make it simpler
[2023-01-20 10:37 AM] Deciusmus: Maybe I should make a github issue for this so we can track what we agreed ğŸ™‚
[2023-01-20 10:37 AM] Deciusmus: But I think at the very least:
    * Change origin to use type: origin and change the origin line to be generated by the template
    * Change the calculation of home to use type: home
    * Change the calculation of excursion to use type: excursion
[2023-01-20 10:38 AM] rsulfuratus: I think the header should be:
    >`>` Originally from: place, region
    `$=dv.view("get_HomeRegion")`
    `$=dv.view("get_CurrentWhereabouts")`
    `%%`^Campaign:xxxx`%%`
    >`>` Last seen by `<PARTY NAME>` at `<DATE>`: 
    `%%`^End`%%`
[2023-01-20 10:38 AM] rsulfuratus: where originally from only prints if origin is defined, and the last three lines only print if lastSeenByParty_XXXX is defined
[2023-01-20 10:38 AM] rsulfuratus: I would remove the fallback to a generic lastSeenBy metadata, last seen must define by who or it isn't displayed
[2023-01-20 10:39 AM] rsulfuratus: I would then implement get_HomeRegion in python, but not get_CurrentWhereabouts, which we assume is never exported
[2023-01-20 10:40 AM] Deciusmus: I was going to have:
    
    lastSeenByParty:
    lastSeenByPartyName:
[2023-01-20 10:40 AM] rsulfuratus: I don't like that because I have multiple campaigns
[2023-01-20 10:41 AM] rsulfuratus: there are a surprising number of people who cross between great library and dunmar, for example, and also between mawar and dunmar, and mawar and great library
[2023-01-20 10:41 AM] rsulfuratus: not all of them need last seen by, but better to be flexible now
[2023-01-20 10:41 AM] Deciusmus: do you want to export each one separately
[2023-01-20 10:42 AM] Deciusmus: i.e have:
    
    `%%`^Campaign:c1`%%`
    >`>` Last seen by `<PARTY NAME>` at `<DATE>`: 
    `%%`^End`%%`
    `%%`^Campaign:c2`%%`
    >`>` Last seen by `<PARTY NAME>` at `<DATE>`: 
    `%%`^End`%%`
    `%%`^Campaign:c3`%%`
    >`>` Last seen by `<PARTY NAME>` at `<DATE>`: 
    `%%`^End`%%`
[2023-01-20 10:43 AM] rsulfuratus: yes, that is what I would imagine for obsidian, although I should probably change the python code so that it can handle single-line, e.g. `%%`^Campaign:c1`%%` >`>` Last seen by `<PARTY NAME>` at `<DATE>`:  `%%`^End`%%`
[2023-01-20 10:43 AM] Deciusmus: in that case the campaign prefix stuff isn't helpful
[2023-01-20 10:44 AM] Deciusmus: we need something like:
    
    lastSeenByParty:
    - {date: x, campaign: y}
[2023-01-20 10:44 AM] rsulfuratus: ah. yeah, that works
[2023-01-20 10:44 AM] Deciusmus: ideally we'd add something to metadata.json to define campaigns
[2023-01-20 10:45 AM] Deciusmus: i.e. 
    
    { campaigns: { name: Cleeenseau, partyName: Blah Blah Blah, prefix: clee }}
[2023-01-20 10:45 AM] rsulfuratus: yeah that would be great
[2023-01-20 10:45 AM] Deciusmus: then your last seen by could be:
    - {date: xyz, campaignId: DuFr }
[2023-01-20 10:45 AM] Deciusmus: and it would look up the party name from the json and generate the insertion
[2023-01-20 10:49 AM] Deciusmus: I'm still not convinced there is any benefit to having the home region stuff by dynamic if there is only a single home region
[2023-01-20 10:49 AM] Deciusmus: Mostly because I don't want to write python code but I do want to get a new web export soon ğŸ™‚
[2023-01-20 10:52 AM] rsulfuratus: Well, it is easy enough to go with option 3 if you prefer. I just don't like option 1. 
    
    I am planning on working on python stuff this weekend, to:
    1) clean up the export code to generate a new website to go with session notes from last session, and 
    2) come up with a way, using python filters and pandoc, to push specific md pages to google drive as docx files, and sync changes back to the obsidian md file (to allow for things like party treasure, and editing session notes). this code will also replace links with links to the website
[2023-01-20 10:53 AM] Deciusmus: I might end up with option 3
[2023-01-20 10:53 AM] Deciusmus: I agree that I don't love option 1
[2023-01-20 12:28 PM] Deciusmus: unfortunately this line:
    `%%`^Campaign:xxxx`%%`
    
    Generates an empty newline in the callout
[2023-01-20 12:29 PM] Deciusmus: 
![[../_discord_assets/image-4C48D.png]]
[2023-01-20 12:29 PM] rsulfuratus: what if you do:
    `%%`^Campaign:xxxx`%%` Location text `%%`^End`%%`
[2023-01-20 12:29 PM] rsulfuratus: all as one line? that should be fine right?
[2023-01-20 12:30 PM] rsulfuratus: I just need to modify my code so it doesn't assume the flag is on a line by itself
[2023-01-20 12:30 PM] rsulfuratus: (but I will probably still assume that the callout begins at the start of a line and ends at the end of a line)
[2023-01-20 12:31 PM] Deciusmus: 
![[../_discord_assets/image-DEA22.png]]
[2023-01-20 12:31 PM] Deciusmus: much nicer
[2023-01-20 12:31 PM] Deciusmus: that's this:
    
    ```
    >`>` `%%`Campaign:clee`%%` Last seen by PARTY NAME at February 3rd, 1701: Whitsun District, [[Chardon]], [[Chardonian Empire]] `%%`End`%%`
    >`>` `%%`Campaign:DuFr`%%` Last seen by PARTY NAME at February 3rd, 1719: [[Amberglow]], [[Feywild]] `%%`End`%%`
    ```
[2023-01-20 12:32 PM] rsulfuratus: I will change my python code so you can do:
    ``%%`^Campaign:xxxx`%%` Location text `%%`^End`%%``
    or:
    ```
    `%%`^Campaign:xxxx`%%` Location text 
    more text
    `%%`^End`%%`
    ```
    or:
    ```
    `%%`^Campaign:xxxx`%%` 
    Paragraph of text
    `%%`^End`%%`
    ```
    But not:
    ```
    Text `%%`^Campaign:xxx`%%` campaign text `%%`^End`%%` 
    ```
[2023-01-20 12:33 PM] rsulfuratus: I think generally you either want the first (for headers or other single-line stuff) or the third (for campaign-specific paragraphs)
[2023-01-20 12:33 PM] Deciusmus: right although I have Text Campaign
[2023-01-20 12:33 PM] Deciusmus: as the callout start is "text"
[2023-01-20 12:33 PM] Deciusmus: ````%%`Campaign:clee`%%`>`>` Last seen by PARTY NAME at February 3rd, 1701: Whitsun District, [[Chardon]], [[Chardonian Empire]] `%%`End`%%````
[2023-01-20 12:34 PM] Deciusmus: ^ doesn't work
[2023-01-20 12:34 PM] rsulfuratus: ah. hmm. okay, let me fiddle with that
[2023-01-20 12:34 PM] rsulfuratus: just a bit more annoying because I have to regex the line instead of just using line.startswith() and line.endswith()
[2023-01-20 12:34 PM] rsulfuratus: but don't think it is too bad
[2023-01-20 12:34 PM] Deciusmus: it renders as
![[../_discord_assets/image-28642.png]]
[2023-01-20 12:34 PM] Deciusmus: you can just trim leading >`
[2023-01-20 12:35 PM] Deciusmus: i.e. 
    line.trim('>`').startsWith(...) is fine
[2023-01-20 12:35 PM] rsulfuratus: ah okay
[2023-01-20 12:35 PM] Deciusmus: I won't have anything in "text" other than an arbitrary number of >`
[2023-01-20 12:35 PM] Deciusmus: depending on how deep the callout is
[2023-01-20 12:35 PM] rsulfuratus: that is fine then
[2023-01-20 12:51 PM] Deciusmus: I can't avoid a newline if no home
[2023-01-20 12:51 PM] Deciusmus: So I was thinking of doing:
    (wanderer, no fixed location)
[2023-01-20 12:52 PM] Deciusmus: 
![[../_discord_assets/image-83919.png]]
[2023-01-20 12:52 PM] Deciusmus: rather than:
![[../_discord_assets/image-06DC8.png]]
[2023-01-20 12:53 PM] rsulfuratus: alternatively could have a newline after home if exists, and there would just be whitespace after the permanent location block and the moveable location block
[2023-01-20 12:53 PM] rsulfuratus: so you'd either have: originally, home, newline, location
[2023-01-20 12:53 PM] rsulfuratus: or: originally, newline, location
[2023-01-20 12:53 PM] rsulfuratus: but I'm fine either way
[2023-01-20 12:55 PM] rsulfuratus: I guess the first option might look weird if there is no home or origin, since you'd have a double-indent newline to start the location section
[2023-01-20 12:55 PM] Deciusmus: yeah
[2023-01-20 01:00 PM] Deciusmus: actually
[2023-01-20 01:00 PM] Deciusmus: nevermind, it is an artifact of testing
[2023-01-20 01:00 PM] Deciusmus: my generateHeader block won't even insert the dv.view unless you have 2+ home regions
[2023-01-20 01:00 PM] Deciusmus: so it will only come up when you have 2+ home regions and then you change them live
[2023-01-20 01:08 PM] Deciusmus: is this the right rule for current:
    let current = metadata.whereabouts.findLast(s =>` compare_dates(s.date, currentJsDate) `<= 0 && s.type != "origin");
[2023-01-20 01:10 PM] rsulfuratus: yes
[2023-01-20 01:17 PM] Deciusmus: 
![[../_discord_assets/image-DB9D8.png]]
[2023-01-20 01:17 PM] Deciusmus: gotta go back to work now
[2023-01-20 01:18 PM] Deciusmus: but in my limited testing it seems to work
[2023-01-20 01:22 PM] Deciusmus: Here's what I'm about to push, let me know if you want me to hold off:
    
    * An update to the update-frontermatter template so that if there is no whereabouts, it converts from home/homeRegion/location/locatonRegion using the new approach
    * An update to the main generate header template so that if any of the whereabouts in the file have a type set, it uses the new logic we've been discussing. otherwise it injects the old get_Whereabouts.
    * New scripts for get_CurrentWhereabots and get_HomeWhereabouts that should be pretty easy to port to python for export (and the get_current) probably just needs to return ""
[2023-01-20 01:23 PM] Deciusmus: Still would be nice to have auto-convesion of whereabouts to new format, but haven't written that yet
[2023-01-20 01:58 PM] rsulfuratus: ğŸ‘
[2023-01-20 01:58 PM] rsulfuratus: sounds great
[2023-01-20 02:59 PM] Deciusmus: pushed

