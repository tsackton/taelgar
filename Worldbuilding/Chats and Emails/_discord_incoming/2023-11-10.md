# Discord DM ‚Äì 2023-11-10

[2023-11-10 08:40 AM] rsulfuratus: any reason not to merge your PR?
[2023-11-10 09:30 AM] Deciusmus: Breaks export I think
[2023-11-10 09:30 AM] Deciusmus: But otherwise no
[2023-11-10 09:30 AM] Deciusmus: Esp if you are going to fix exports
[2023-11-10 09:30 AM] rsulfuratus: yeah was going to work on that this weekend
[2023-11-10 09:30 AM] rsulfuratus: i have today off
[2023-11-10 09:34 AM] Deciusmus: I pushed some fixes just now
[2023-11-10 09:37 AM] rsulfuratus: I merged, so switch back to main if you do anything else
[2023-11-10 09:46 AM] Deciusmus: got it
[2023-11-10 09:46 AM] Deciusmus: I wanted you to review a few of the changes
[2023-11-10 09:46 AM] Deciusmus: But..
[2023-11-10 09:46 AM] Deciusmus: I was trying to fix some people's whereabouts and wasn't always sure it was correct
[2023-11-10 09:47 AM] rsulfuratus: right, i'm looking at the recent changes now
[2023-11-10 09:47 AM] rsulfuratus: but also getting some weird bugs
[2023-11-10 09:47 AM] rsulfuratus: 
```
    Dataview: Failed to execute view '_scripts/view/get_HomeWhereabouts.js'.
    
    TypeError: Assignment to constant variable.
```
[2023-11-10 09:47 AM] Deciusmus: I was still fixing stuff last night
[2023-11-10 09:47 AM] Deciusmus: do you have customJS
[2023-11-10 09:47 AM] Deciusmus: I moved a lot of stuff to depend on customJS
[2023-11-10 09:48 AM] Deciusmus: which file is showing this
[2023-11-10 09:48 AM] rsulfuratus: yeah i have that
[2023-11-10 09:49 AM] rsulfuratus: actually reloading obsidian seems to have fixed that particular issue
[2023-11-10 10:00 AM] Deciusmus: I pushed a fix for some issues btw
[2023-11-10 10:09 AM] Deciusmus: The "new" whereabouts logic, btw, is as follows:
  ```  
    For simple NPCs just set origin to either origin: string or origin: { place: xxx, region: yyy }. Don't use whereabouts at all.
    This will generate a dynamic "get_Homewhereabouts" line to the template, which will output either: Based in or Lived in depending on whether the NPC is alive or not.
    
    For simple NPCs with a separate home and origin, set origin as above, plus a whereabouts with a {type: home, place:, region: } and no date.
    This will generate a Originally from line with the origin plus a get_Homewhereabouts as above. 
    If you know when the NPC moved from origin to home, you can set on a date on the home line. This will keep the originally from, but also add a "currentwhereabouts" dynamic line. (See below)
    
    For complex NPCs with various more complexity, you set the full whereabouts structure. (see below)
```
[2023-11-10 10:14 AM] rsulfuratus: so i'm messing around a bit and actually i think the assumption that traveling continues forever is also probably wrong
[2023-11-10 10:14 AM] rsulfuratus: e.g. this is not necessarily correct:
![[../_discord_assets/image-49FF5.png]]
[2023-11-10 10:15 AM] rsulfuratus: current location for Dain is unknown - might still be traveling in Illoria but I actually have no idea and haven't invented that detail
[2023-11-10 10:15 AM] rsulfuratus: would be much more useful to me to have "Last Known Location" than "current location"
[2023-11-10 10:16 AM] rsulfuratus: simple option is to just report Last Known Location (last whereabouts date): Location
[2023-11-10 10:17 AM] rsulfuratus: right now not sure how lastSeenByParty is handled
[2023-11-10 10:17 AM] Deciusmus: So I was messing around with the idea of visit having an "end: true" or "end: false"
[2023-11-10 10:17 AM] Deciusmus: So for example Antonia is in the mirror of soul trapping, which is an indefinite visit
[2023-11-10 10:18 AM] Deciusmus: so I wanted her to show as "current location: mirror of soul trapping"
[2023-11-10 10:18 AM] Deciusmus: but of course if the fantasy calendar date is 1800, who knows if that is true
[2023-11-10 10:19 AM] Deciusmus: But really actually that is just a way of turning off the implicit "a visit is 1 day"
[2023-11-10 10:20 AM] rsulfuratus: i think rather than indefinite, in the cases where you actually have positively decided the stay is "a while" it is easy enough to just set an end date an estimated time in the future
[2023-11-10 10:20 AM] rsulfuratus: e.g. for antonia I'd just set end-date: 1751-12-10 which would be 3 years
[2023-11-10 10:21 AM] rsulfuratus: if we ever play out what happens to her can change that, if not that is kind of a reasonable assumption, could even set { date: 1751-12-10, place: Voltara, type: home }
[2023-11-10 10:22 AM] rsulfuratus: but my default assumption is that if i don't make a positive decision that something is happening for a certain length of time (even if just estimated), then we don't know if it continued for a day a week or a year
[2023-11-10 10:24 AM] rsulfuratus: i think how i'd encode it is to have two dates: "last seen date", and "last known date". if last known date is `< current date, the text is "Last Known Location (last known date): Location". if last known date is >`= current date, the text is "Current Location (current date): Location"
[2023-11-10 10:24 AM] Deciusmus: Maybe the right thing to do is something like:
    
    * assume visit and travel is 1 day if not otherwise set
    * assume home is indefinite unless date_end is set
    * calculate the "last known" location which is using the same logic as I have today, but uses the date of the whereabouts line, rather than the current fantasy calendar date, in the text (i.e. Last known location (as of xxx): (something)
[2023-11-10 10:25 AM] rsulfuratus: yes exactly
[2023-11-10 10:26 AM] Deciusmus: I'm not sure about the Current though -- the current location is different than last known
[2023-11-10 10:26 AM] Deciusmus: But your rule is not right
[2023-11-10 10:26 AM] Deciusmus: You can tell the different between "the current fantasy date matches a location" vs "the current fantasy date doesn't match a location"
[2023-11-10 10:26 AM] Deciusmus: Basically, actually, what I said is totally wrong
[2023-11-10 10:27 AM] Deciusmus: Actually what you want is:
    * Keep existing current location logic, but change travel to also have an implicit end date of 1 day
[2023-11-10 10:27 AM] Deciusmus: Then, the current location will be either an actual current location, or alternatively, unknown
[2023-11-10 10:28 AM] rsulfuratus: the logic is:
    1. if the current date is in the future (relative to last reported whereabouts), then current location doesn't exist (it is unknown, by definition). in this case you report Last Known Location (last known date): Location
    2. if current date is in the past (relative to last reported whereabouts), then you know the location, and you report Current Location (current date): Location
[2023-11-10 10:28 AM] Deciusmus: Then, if current location is unknown, you also output:
    
    Last known location (as of whereabouts_date): (last known)
[2023-11-10 10:29 AM] rsulfuratus: right, I'm just suggesting if current location is unknown, it is probably just too much clutter to report both current location: unknown and Last known location
[2023-11-10 10:29 AM] rsulfuratus: this assumes this is independent from last seen by party stuff
[2023-11-10 10:30 AM] Deciusmus: Is it too much clutter to have current: unknown and last known: something?
[2023-11-10 10:30 AM] rsulfuratus: I guess that would be fine
[2023-11-10 10:31 AM] rsulfuratus: you could end up with 5 location lines, if you have from, home, last known, last seen by, and current
[2023-11-10 10:31 AM] Deciusmus: I kinda like it, as either
    
    1) There is a known location - show
    Current location (as of current date): xxx
    
    2) There is no current location, but we do have a visit or travel that is not eligble to be current because it has ended
    Current (as of current): unknown
    Last known (as of whereabouts): yyy
[2023-11-10 10:31 AM] Deciusmus: Unlikely you'd have a home & last known
[2023-11-10 10:31 AM] Deciusmus: because we assume they are at home unless they are explicitly not
[2023-11-10 10:32 AM] rsulfuratus: hmm, that is not quite correct actually
[2023-11-10 10:33 AM] rsulfuratus: once someone leaves home, can't assume they are there unless they are explicited returned there
[2023-11-10 10:33 AM] Deciusmus: But that's why I made travel indefinite
[2023-11-10 10:35 AM] rsulfuratus: that isn't quite right either. e.g. someone who is "traveling in X" in DR 1719 is probably not still traveling in X in DR 1749
[2023-11-10 10:35 AM] rsulfuratus: but can't assume they are home either
[2023-11-10 10:35 AM] rsulfuratus: technically someone who just has a home line with no end can't assume to be home 20 years in the future either
[2023-11-10 10:35 AM] rsulfuratus: but generally speaking I think the simplifying assumption is there are two types of NPCs: those that travel and those that don't
[2023-11-10 10:36 AM] rsulfuratus: taking the trouble to fill out whereabouts is an implicit signal that this is an npc that travels
[2023-11-10 10:36 AM] rsulfuratus: the concept is basically we have a "knowledge cutoff date" for each npc
[2023-11-10 10:37 AM] rsulfuratus: if there is nothing but a home or a home/origin, we implicitly assume knowledge cutoff date = current date, which is fine
[2023-11-10 10:37 AM] rsulfuratus: someone can make something up but the default, unless you actively invent a contrast, is they just stay home forever
[2023-11-10 10:38 AM] rsulfuratus: if there is a whereabouts line, and the last line is a home entry, same assumption
[2023-11-10 10:38 AM] rsulfuratus: if there is a whereabouts line and the last line is not a home entry (its a stop, or traveling) then the knowledge cutoff date is not current date, its the last whereabouts date
[2023-11-10 10:39 AM] rsulfuratus: we assume we have no idea where they are after that
[2023-11-10 10:39 AM] rsulfuratus: basically, if the last recorded location for an NPC is home or origin, then they remain there until told otherwise
[2023-11-10 10:40 AM] rsulfuratus: if the last recorded location for an NPC is traveling or stop, then they are in a quantum indeterminate state at any date after last recorded
[2023-11-10 11:02 AM] Deciusmus: See, I'm not sure about that
[2023-11-10 11:02 AM] Deciusmus: one sec, have to pay attention to my meeting for a bi
[2023-11-10 12:42 PM] Deciusmus: See, I think the right logic is back to the idea of defined vs undefined ends. I think if you say:
    
    - home = Cleenseau
    - travel to Dunfry, start = Jan 5, end = Jan 29
    
    It is very reasonably to assume that after Jan 29 they are back home
[2023-11-10 12:43 PM] Deciusmus: I don't think it makes sense to have to go back and add ANOTHER home line, or something like that
[2023-11-10 12:47 PM] rsulfuratus: right, that's sensible
[2023-11-10 12:47 PM] Deciusmus: I think what you actually want is to say that logically, every whereabouts line is:
    
    * a start date
    * an end date
    * a place
    
    Then to find the current location of someone, you just find the whereabouts that started before the current date and ended after the current date, and if there are multiples, you take the one with the shortest duration
[2023-11-10 12:48 PM] Deciusmus: that makes nested work nicely, i.e. you could have
    
    - home Chardon ( 1719 - 1740 )
    - travel Green Sea ( 1722 - 1725 )
    - visit Irrla  (1723)
    - travel western Irrla (1723 May - July)
    - visit some town in western irrla ( June 10 - 15)
[2023-11-10 12:49 PM] Deciusmus: obviously you wouldn't bother with that level of detail for most characters
[2023-11-10 12:49 PM] Deciusmus: but the algorithm with work
[2023-11-10 12:49 PM] Deciusmus: Then, to make it not annoying, you need a mechanism to not have to make up start and end dates for everything
[2023-11-10 12:49 PM] rsulfuratus: my main goal is to have sensible assumptions that don't require a lot of extra work
[2023-11-10 12:50 PM] Deciusmus: So...
    type = home, assume the start = born, end = died
[2023-11-10 12:50 PM] Deciusmus: type = visit and travel, assume end = start
[2023-11-10 12:51 PM] Deciusmus: then, if it seems useful, we could add an "indefinite: true" to visit and travel, which would assume end = died as well
[2023-11-10 12:52 PM] Deciusmus: but realistically I'm not sure if that matters, because usually if someone is travelling you want to assume the travel ends
[2023-11-10 12:52 PM] Deciusmus: Then you can implement your idea of "travelling" or "not travelling" by setting an end on the home or not
[2023-11-10 12:54 PM] Deciusmus: So character 1:
    - home = Cleenseau, no start or end
    - travel = Dunfry, start = 1720 end = 1721
    
    will show as in Cleenseau outside of 1720-1721
    
    Character 2:
    - home = Cleenseau, no start, end = 1720
    - travel = Dunfry, start = 1720 end = 1721
    
    Will show in Cleenseau up to 1720, travelling in Dunfry 1720 - 1721, and unknown after 1721
[2023-11-10 12:56 PM] Deciusmus: Basically character one would have, in 1720
    
    Home: Cleenseau
    Current Location: travelling in Dunfry
    
    And in 1722
    Home: Cleenseau
    
    Whereas character two would have, in 1720
    
    Origin: Cleenseau
    Current Location: travelling in Dunfry
    
    And in 1722:
    
    Origin: Cleenseau
    Last Known Location (1721): travelling in Dunfry
    Current Location: unknown
[2023-11-10 12:57 PM] Deciusmus: Then last seen by party works exactly the same, except it uses the "last seen by date" rather than the "current date" to get the current location.
[2023-11-10 12:59 PM] Deciusmus: So a different simple case might be a traveling merchant the party met at an inn who has no home or origin.
    
    There you'd have one line
    type: visit, place = the Inn, date = the date
    last seen by party = the date
    
    It would output
    
    Last Seen By Party (the date): the inn
    Last Known Location (the date): the Inn
    Current Location: unknown
[2023-11-10 12:59 PM] rsulfuratus: i think the complication for me is that i usually don't want to work out complicated travel histories, just to be able to record when people were at specific locations
[2023-11-10 12:59 PM] Deciusmus: doesn't this let you do that?
[2023-11-10 12:59 PM] rsulfuratus: well i guess what happens if you have no home?
[2023-11-10 12:59 PM] Deciusmus: see example above
[2023-11-10 01:01 PM] rsulfuratus: right okay
[2023-11-10 01:01 PM] Deciusmus: but ignore last seen by party, to make it simpler.
    
    If you have a single line in whereabouts:
    
    - type: visit, date = some date, place = the Inn
    
    It would output if the fantasy calendar date == some  date
    
    Current location (some date): the inn
    
    And if the fantasy calendar date >` some date
    
    Last known location (some date): the inn
    Current location (fant. cal date): unnknown
[2023-11-10 01:01 PM] Deciusmus: and if the fantasy calendar date `< some date:
    
    Current location (fant cal date): unknown
[2023-11-10 01:02 PM] Deciusmus: if you know they were at the inn for a week (say because the were an important NPC in the session and the whole session was at the inn), you could add an end: `<some date + 1 week>` which would extent the period of time the current location showed as the inn
[2023-11-10 01:03 PM] Deciusmus: But realistically that is rarely worth bothering with
[2023-11-10 01:04 PM] rsulfuratus: right, okay. i think setting the end date of home to be xxx to indicate someone should be considered "traveling until stated otherwise" is fine
[2023-11-10 01:04 PM] rsulfuratus: presumably then one could just add another home line, or alternatively delete the end date, if they return
[2023-11-10 01:04 PM] Deciusmus: right
[2023-11-10 01:04 PM] Deciusmus: although, what you really want, is the ability to not set the home date
[2023-11-10 01:05 PM] rsulfuratus: it would be nice to support the edge case of "left home at 1748-08-22, traveling in Illoria at 1748-10-23" and have location between 08-22 and 10-23 be unknown
[2023-11-10 01:05 PM] rsulfuratus: then it is just the default assumption if home has no date
[2023-11-10 01:06 PM] Deciusmus: That would work if automatically if you set home end = 1748-08-22
[2023-11-10 01:06 PM] rsulfuratus: right, okay
[2023-11-10 01:06 PM] Deciusmus: alternatively, you could set
    
    type: travelling (with no place) with a start of 1748-08-22 and an end of 1748-10-23
[2023-11-10 01:06 PM] Deciusmus: then it would say
    
    Home: Chardon
    Location: travelling
    
    If you were >`08/22 but before 10/23
[2023-11-10 01:07 PM] Deciusmus: It really depends on whether you want the whereabouts section to report their home as chardon or not
[2023-11-10 01:07 PM] Deciusmus: or whatever
[2023-11-10 01:07 PM] rsulfuratus: right, here also it might be easier to just set "traveling" from 1748-08-22 on and then track events with date tag
[2023-11-10 01:07 PM] Deciusmus: right
[2023-11-10 01:07 PM] Deciusmus: But I actually think there is a missing feature here
[2023-11-10 01:07 PM] Deciusmus: Which is the idea of "hazy future"
[2023-11-10 01:08 PM] Deciusmus: Although actually
[2023-11-10 01:08 PM] Deciusmus: in your example above, what do you want to show as the location on 10-24-1748
[2023-11-10 01:08 PM] Deciusmus: "unknown" with "last know" = traveling in Iloria?
[2023-11-10 01:08 PM] rsulfuratus: yes
[2023-11-10 01:09 PM] Deciusmus: right, so what you want is the ability to flag something as "hazy future"
[2023-11-10 01:09 PM] Deciusmus: Which would mean - they are not in THIS place forever, but they are not home either
[2023-11-10 01:09 PM] Deciusmus: I'm not sure how to do it exactly
[2023-11-10 01:10 PM] Deciusmus: But imagine two characters. One who has gone for an extended travel, and it isn't clear where they are exactly, but they are not home.
    The other who has actually moved to a new home or is moving
[2023-11-10 01:10 PM] Deciusmus: For one you want to see
    
    Home: Cleenseau
    Last known location: traveling in the Plaguelands
    Current location: Unknown
    
    For the other you want to see
    
    Originally from: Cleenseau
    Last known location: traveling in the Plaguelands
    Current location: Unknown
[2023-11-10 01:11 PM] rsulfuratus: ah, hmm. i don't actually really care about the "Home" or "Originally from" distinction
[2023-11-10 01:11 PM] Deciusmus: It isn't super relevant for the actual text output, but I was playing around with the idea of a data view query you could add to a place that would show:
    
    * all the people who live in the place
    and also
    * all the people who are currently in the place
[2023-11-10 01:12 PM] rsulfuratus: i think of "home" as "associated with"
[2023-11-10 01:12 PM] Deciusmus: Right, I agree that home = associated with
[2023-11-10 01:12 PM] rsulfuratus: e.g. I'd still want Dain to have "Based in: Chardon" despite current location being unknown
[2023-11-10 01:13 PM] Deciusmus: Right, that is where the "hazy future" comes in
[2023-11-10 01:13 PM] rsulfuratus: i just don't want to assume people are home at an arbitrary date in the future
[2023-11-10 01:13 PM] rsulfuratus: or assume they are at their last known location either
[2023-11-10 01:13 PM] rsulfuratus: this is why I kind of like the concept of a knowledge horizon
[2023-11-10 01:14 PM] Deciusmus: Right, I think that is what I mean by hazy future
[2023-11-10 01:15 PM] rsulfuratus: so the way I would probably do is is track a "knowledge horizon" variable for each NPC. 
    
    if they have no whereabouts lines, the knowledge horizon is the current date. 
    if they have a whereabouts line, the knowledge horizon is the last recorded date in the whereabouts
[2023-11-10 01:15 PM] Deciusmus: See I don't think that is quite right
[2023-11-10 01:16 PM] rsulfuratus: the conflict is about what to do with people who finish traveling
[2023-11-10 01:16 PM] Deciusmus: Because I want to record an end date for a visit or travel, and assume that the have returned home
[2023-11-10 01:16 PM] rsulfuratus: right
[2023-11-10 01:16 PM] rsulfuratus: i guess my argument then is that if you know they returned home, you probably should write that down somewhere
[2023-11-10 01:16 PM] rsulfuratus: e.g. by having a whereabouts line with home or something else
[2023-11-10 01:17 PM] Deciusmus: See for me, I don't want to do that because it is too cluttered. My use case is ~10 important NPCs in Cleenseau
[2023-11-10 01:17 PM] Deciusmus: I'd like to be able to, in session prep for say me next session, record that some of these folks are gone on various errands or whatever
[2023-11-10 01:17 PM] Deciusmus: Then, I can easily just set the fantasy calendar date to the current in game date and see who is or is not in town
[2023-11-10 01:18 PM] rsulfuratus: hmm
[2023-11-10 01:18 PM] Deciusmus: But if in game, someone returns (or in between sessions I decide they return), I just want to set the end on the visit / travel line
[2023-11-10 01:19 PM] Deciusmus: I could just delete it but that seems sad, because it seems cool to have a record of the travels
[2023-11-10 01:19 PM] Deciusmus: But I definitely don't want to have to set an end on the travel line AND add a new home line
[2023-11-10 01:20 PM] rsulfuratus: ah. right. but what if having an end date on the travel line implicitly indicates that the person returned home
[2023-11-10 01:20 PM] rsulfuratus: (or, rather, on the last travel line)
[2023-11-10 01:20 PM] rsulfuratus: a person who has no uncompleted travel is home
[2023-11-10 01:20 PM] rsulfuratus: a person who is traveling with a start date, but not an end date, has a hazy future
[2023-11-10 01:20 PM] rsulfuratus: i think that probably works for all our use cases
[2023-11-10 01:21 PM] Deciusmus: the other idea is what if the output of type: travel with no place isn't "travelling" but "unknown"
[2023-11-10 01:21 PM] rsulfuratus: that is probably a good idea as well
[2023-11-10 01:21 PM] Deciusmus: I mean, in combo with your idea
[2023-11-10 01:22 PM] rsulfuratus: so in that case, home should only have start/end if a person has multiple homes
[2023-11-10 01:22 PM] Deciusmus: Right, or has left home with no new home
[2023-11-10 01:23 PM] rsulfuratus: right, e.g. someone like Dee Wildcloak who fled chardon for "parts unknown"
[2023-11-10 01:23 PM] Deciusmus: Right
[2023-11-10 01:23 PM] rsulfuratus: but for 'traveling with hazy future', you just set a whereabouts line
[2023-11-10 01:23 PM] rsulfuratus: in that case, i'm not sure whereabouts even needs a type
[2023-11-10 01:23 PM] Deciusmus: Well, it is nice for defaults
[2023-11-10 01:24 PM] rsulfuratus: well in this case i'm assuming everything important can be inferred from whether end date exists
[2023-11-10 01:25 PM] rsulfuratus: e.g., if you have wherebabouts with a start date but no end date, then you report last known location and current location unknown
[2023-11-10 01:25 PM] Deciusmus: It's hard to represent "home" though
[2023-11-10 01:26 PM] Deciusmus: i.e. to have Based in: xxx, Last known: yyy, current: unknown
[2023-11-10 01:26 PM] rsulfuratus: originally from: xxx, based in: yyy are always reported if origin and home exist (and are different)
[2023-11-10 01:26 PM] Deciusmus: but without a type, how do you know what is home?
[2023-11-10 01:26 PM] rsulfuratus: home is not part of whereabouts
[2023-11-10 01:27 PM] Deciusmus: but then how do you manage someone who moves?
[2023-11-10 01:27 PM] Deciusmus: i.e. Vistra
[2023-11-10 01:27 PM] rsulfuratus: home can have multiple entries
[2023-11-10 01:27 PM] Deciusmus: I don't thnk that saves anything
[2023-11-10 01:27 PM] rsulfuratus: or maybe it is easier to have whereabouts with type = home and type = something else
[2023-11-10 01:27 PM] rsulfuratus: that is fair
[2023-11-10 01:27 PM] Deciusmus: yeah
[2023-11-10 01:27 PM] Deciusmus: I do think the distinction between "travel" and "visit" is maybe not important
[2023-11-10 01:28 PM] Deciusmus: i.e. you have whereabouts with 
    
    * start (optional)
    * end (optional)
    * type (home or away, required)
    * place (optional)
    
    You need at least one of start or place
[2023-11-10 01:29 PM] Deciusmus: although actually I think start is required
[2023-11-10 01:29 PM] rsulfuratus: start is required, yes
[2023-11-10 01:29 PM] Deciusmus: unless type = home, in which case null start = birth
[2023-11-10 01:29 PM] rsulfuratus: yeah
[2023-11-10 01:33 PM] rsulfuratus: i haven't looked at your code, but i wonder if the way to do this isn't a bunch of logical tests, but just to construct a set of date intervals for each person
[2023-11-10 01:36 PM] rsulfuratus: you construct a set of home intervals and a set of whereabouts intervals, and record the last known date as well
[2023-11-10 01:37 PM] rsulfuratus: then the "based in" line is ->` query home intervals, print "based in: XXX" or nothing
[2023-11-10 01:38 PM] rsulfuratus: the location line is ->` query whereabouts, return location, if unknown print current location unknown plus query with last recorded date and print that as last known location
[2023-11-10 01:42 PM] rsulfuratus: the main thing then is to consider how to decide when a person is hoome
[2023-11-10 01:43 PM] rsulfuratus: but when you construct location intervals, could fill "defined gaps" with home and "undefined gaps" with unknown
[2023-11-10 01:45 PM] Deciusmus: so basically:
    
    * start (required for away, defaults to birth if not set for home)
    * end (optional)
    * type (home or away)
    * place (required for home, optional for away if end is empty. required if end is present)
    
    Logic is:
    Logical end = start if end is undefined, otherwise end
    
    Find the "exact known whereabouts". This takes all of the whereabouts where type = away, start is before or equal to current, and logical end is before or equal to current. If there are multiples take the one with the smallest duration between start and logical end. This could be empty.
    Find the "home whereabouts". This is everything with type = home where start `<= current and end >`= current or where start `<= current and end is unset. If there are multiples take the one with the most recent start date.
    Find the "last known whereabout": This takes all of the whereabouts where type = away, start is before or equal to current, finds the one with the most recent logical end. 
    
    If there is a home whereabouts, output
    Based in: `<home>`
    
    If there is an exact known whereabouts, output:
    Current Location: `<exact known>`
    
    If there is no exact known whereabouts:
    
    if there is a home whereabouts and a last known whereabouts, and the last known whereabouts has an end, and it is in the past, output:
    Current Location: `<home>`
    
    Otherwise, if the last known whereabouts exists, and does not have an end, output:
    Last known (date): last known
    Current Location: Unknown
[2023-11-10 01:47 PM] rsulfuratus: yes, I think that is it.
    
    so for example, if I didn't want to decide exactly when Dain left Chardon, I could have:
    - start: , end:, type: home, location: Chardon
    - start: 08-27-1748, end:, type: away, location: Chardon
    - start: 10-23-1748, end:, type: away, location: Illora
[2023-11-10 01:48 PM] rsulfuratus: for dates before 08/27, you would just get: Based in: Chardon and no current or last known location
[2023-11-10 01:48 PM] rsulfuratus: on 08/27, you'd get: Based in: Chardon, Current Location: Chardon
[2023-11-10 01:48 PM] rsulfuratus: between 8/28-10/22, you'd get: Based in: Chardon, Current Location: unknown, Last Known (8/28): Chardon
[2023-11-10 01:49 PM] rsulfuratus: on 10/23, you'd get: Based in: Chardon, Current Location: Illoria
[2023-11-10 01:49 PM] rsulfuratus: after 10/23, you'd get: Based in: Chardon, Current Location: unknown, Last Known (10/22): Illoria
[2023-11-10 01:50 PM] rsulfuratus: if I later added an end: 01-25-1749 to the last away line, then for any dates after 1/25 you'd go back to "Based in: Chardon" with no current or last known
[2023-11-10 01:50 PM] Deciusmus: Yes
[2023-11-10 01:50 PM] rsulfuratus: that seems perfect
[2023-11-10 01:52 PM] rsulfuratus: for someone for whom you have very little information (e.g., a halfling traveler at an inn somewhere), you just end up with "Current Location: unknown; last known (date): inn"
[2023-11-10 01:52 PM] rsulfuratus: which is also exactly what you want
[2023-11-10 01:52 PM] Deciusmus: The one additional wrinkle is origins.
    
    Which, I think works best by adding:
    
    * Determine the "origin whereabouts": This is everything with type: home and just selects the one with the earliest start date.
    
    Then if we have >`1 whereabouts with type: home, and output:
    
    Originally from: `<origin>`
    
    In addition to everything else
[2023-11-10 01:53 PM] Deciusmus: That way, if you wanted to decide that Dain is never going back to Chardon, you could instead set end: 8-27-1748 on home line
[2023-11-10 01:53 PM] rsulfuratus: so, the only downside to that is it requires inventing when someone moved
[2023-11-10 01:53 PM] Deciusmus: You mean for the cases where you want a different origin and home but don't care when?
[2023-11-10 01:53 PM] rsulfuratus: yes
[2023-11-10 01:53 PM] Deciusmus: One sec, getting to that
[2023-11-10 01:54 PM] rsulfuratus: what we had before worked for that but had the downside of polluting the events tables with "moved to" at artificially precise dates
[2023-11-10 01:54 PM] Deciusmus: Actually, it works fine.
    
    If there are multiple home whereabouts with no start or end, we just take as the actual home whereabout the lexically last in the list
[2023-11-10 01:55 PM] Deciusmus: So if you have
    
    - type: home, place: somewhere in the feywild
    - type: home, place: Shimmersong
    
    It would output
    
    Originally from: somewhere in the feywild
    Based in: Shimmersong
[2023-11-10 01:56 PM] rsulfuratus: right, okay, that is great
[2023-11-10 01:56 PM] rsulfuratus: if you add a third line it is probably because you care when someone moved, but if you add a third line without any dates, it just means the 2nd line never gets printed
[2023-11-10 01:57 PM] Deciusmus: right
[2023-11-10 01:57 PM] Deciusmus: that would be a bit pointless, you may as well just change the 2nd line
[2023-11-10 01:57 PM] rsulfuratus: yeah
[2023-11-10 01:57 PM] Deciusmus: it might be nice to have a fuzzy_date: true
[2023-11-10 01:57 PM] rsulfuratus: well, maybe if you want to remember that they spent time in X but don't want to check dates at the momemt
[2023-11-10 01:58 PM] Deciusmus: which would mean the date should be ignored for events tables
[2023-11-10 01:59 PM] Deciusmus: especially if I do time-jump my campaign into the 1730s/early 1740s it might be useful for shared NPCs who are canonically in place A and time X and place B and time Y but no one wants to decide when they actually moved
[2023-11-10 02:00 PM] rsulfuratus: i would actually prefer to have those show up in the events table
[2023-11-10 02:00 PM] rsulfuratus: just have a comment in yaml `#approx` or something
[2023-11-10 02:00 PM] Deciusmus: ok
[2023-11-10 02:00 PM] Deciusmus: sure that probably makes more sense actually
[2023-11-10 02:00 PM] rsulfuratus: so that we know they can be changed. the events table stuff is great for checking internal consistency
[2023-11-10 02:00 PM] Deciusmus: righ
[2023-11-10 02:01 PM] rsulfuratus: i think as a general rule it makes sense to use  `#approx` or similar comments liberally in yaml for any shared npcs to delineate what is a guess and what is canonically
[2023-11-10 02:02 PM] Deciusmus: so then the final piece would be what does the events table output? For example what does this generate:
    
    start: , end:, type: home, location: Chardon
    start: 08-27-1748, end:, type: away, location: Chardon
    start: 10-23-1748, end:, type: away, location: Illora
[2023-11-10 02:02 PM] Deciusmus: simplest is just "Was in"
[2023-11-10 02:02 PM] rsulfuratus: was in is definitely the best
[2023-11-10 02:02 PM] Deciusmus: or if there is a start and end, an "arrived " and "left "
[2023-11-10 02:03 PM] rsulfuratus: i would say:
    - just start: turns to "Was in", or "Arrived at" if end is defined
    - end: turns to "Left"
[2023-11-10 02:04 PM] Deciusmus: right, makes sense
[2023-11-10 02:04 PM] rsulfuratus: mostly for generating "So and so left Chardon" when you have type: home, and just an end date
[2023-11-10 02:04 PM] rsulfuratus: i think that the events table can ignore type, actually
[2023-11-10 02:05 PM] rsulfuratus: (except for inputing "Born at:" events from born dates)
[2023-11-10 02:05 PM] Deciusmus: I think you want to say "Moved to" for home that has start but no end
[2023-11-10 02:05 PM] rsulfuratus: yes, that is also good
[2023-11-10 02:05 PM] Deciusmus: as opposed to "Was in"
[2023-11-10 02:06 PM] rsulfuratus: ah, actually, that reminds me, the last thing for whereabouts is that if the current date is >` died, shouldn't print location information at all (but we should assume died = 12-31-diedYear)
[2023-11-10 02:06 PM] Deciusmus: Yes agreed
[2023-11-10 02:06 PM] rsulfuratus: might print last known location actually
[2023-11-10 02:06 PM] Deciusmus: Actually, wait disagree
[2023-11-10 02:06 PM] Deciusmus: üôÇ
[2023-11-10 02:07 PM] Deciusmus: It should print:
    
    * originally as if they were alive, if it exists
    * lived in, rather than based in, if there is a home
    * never any current location
    * last known location as normal, if it would otherwise be printed
[2023-11-10 02:07 PM] rsulfuratus: right, yes, the originally/home stuff should stay
[2023-11-10 02:07 PM] rsulfuratus: i just meant current location information
[2023-11-10 02:08 PM] Deciusmus: right, for that I'd print last know if we would have otherwise
[2023-11-10 02:09 PM] rsulfuratus: yeah that would work, just means that if someone dies traveling and you want where they died to be recorded as last known, you have to leave the end date off
[2023-11-10 02:09 PM] rsulfuratus: that's good
[2023-11-10 02:10 PM] Deciusmus: right, which now that died supports day-precise dates, is fine
[2023-11-10 02:10 PM] Deciusmus: I think in the past we were using whereabouts with place: dead to track that someone died on May 5, not just some random date in the year
[2023-11-10 02:10 PM] rsulfuratus: yes, but this way is better
[2023-11-10 02:10 PM] Deciusmus: but now you can just do: died: 1702-05-11
[2023-11-10 02:10 PM] Deciusmus: yes, definitely
[2023-11-10 02:12 PM] rsulfuratus: we probably need some consistent tests for this, i was going to work on the python code and will verify we are reporting same output
[2023-11-10 02:12 PM] Deciusmus: I'm writing a spec in Obsidian now
[2023-11-10 02:13 PM] rsulfuratus: also do you want to stick with three separate functions? page dated value, home whereabouts, current whereabouts
[2023-11-10 02:15 PM] rsulfuratus: plus i guess regnal value for royalty
[2023-11-10 02:18 PM] Deciusmus: (Sorry dealing with work for a min, give me a sec)
[2023-11-10 02:39 PM] Deciusmus: So the original goal of the split functions was
    (a) to make the python simpler
    (b) to make it less likely to require dataview queries on some pages
    (c) make the dataview queries simpler
    
    I'm not sure if those are truly sensible
[2023-11-10 02:39 PM] rsulfuratus: the way to make the python simpler is implement as much as possible in metadataUtils.js
[2023-11-10 02:39 PM] Deciusmus: I suspect we want
    
    getPageDated =>` for the born/year/etc stuff
    getRegnal =>` for the reign
    getLocation =>` for everything else
[2023-11-10 02:40 PM] Deciusmus: can you call metadataUtils from python?
[2023-11-10 02:40 PM] Deciusmus: or is it just easier for some other reason?
[2023-11-10 02:40 PM] rsulfuratus: no, not that i'm aware of, but it is much easier for me to reimplement a bunch of functions
[2023-11-10 02:41 PM] rsulfuratus: really just the smaller each function is the easier it is to make sure it does the same thing in python
[2023-11-10 02:41 PM] Deciusmus: ah
[2023-11-10 02:41 PM] Deciusmus: I'm not sure how far you have gotten, but I was going to move a bunch of the logic into metadata utils
[2023-11-10 02:42 PM] rsulfuratus: right now i'm stuck on trying to decipher the fantasy calendar json to reimplement:
    ```
        get_displayDateFromPieces(day, month, year) {
            let currentFantasyCal = FantasyCalendarAPI.getCalendars()`[0]`;
            let date = { year: year, month: month, day: day };        
            return FantasyCalendarAPI.getDay(date, currentFantasyCal).displayDate;
        }
    ```
[2023-11-10 02:43 PM] Deciusmus: So I was about to suggest maybe it would be easier for metadataUtils to have a "setCurrentDate", and then you could just call that yourself
[2023-11-10 02:43 PM] Deciusmus: like, there is a lot I could do to structure metadataUtils to be more portabe
[2023-11-10 02:43 PM] Deciusmus: but I don't know if that is worthwhile if I don't get to it until next week üôÇ
[2023-11-10 02:44 PM] rsulfuratus: i want to get the export working this weekend because I want to update session notes
[2023-11-10 02:45 PM] rsulfuratus: i think the structure of metadataUtils isn't too bad and I can hack around a bit in javascript in some cases too
[2023-11-10 02:49 PM] rsulfuratus: parse_date_to_events_date is going to be annoying
[2023-11-10 02:50 PM] rsulfuratus: but everything else looks pretty easy
[2023-11-10 03:00 PM] rsulfuratus: github copilot is actually pretty much perfectly auto-generating the python code for me
[2023-11-10 03:00 PM] Deciusmus: just be aware that the javascript code does't match this convo
[2023-11-10 03:01 PM] rsulfuratus: yes, so far i'm just implementing the helper functions
[2023-11-10 03:17 PM] Deciusmus: pushed a spec
[2023-11-10 03:17 PM] Deciusmus: you might be better off, for get_CurrentWhereabouts, just ignoring the helper function and using the spec
[2023-11-10 03:19 PM] Deciusmus: oh the other reason we wanted 2 scripts was to separate the last seen by party
[2023-11-10 03:19 PM] Deciusmus: i.e. to have
    
    origin
    home
    last seen by part
    last known
    current
[2023-11-10 04:04 PM] rsulfuratus: i'm trying to figure out the date logic you have, as I think i can do this simpler in python. the assumption is that we have either:
    YYYY
    YYYY-MM
[2023-11-10 04:04 PM] rsulfuratus: YYYY-MM-DD
[2023-11-10 04:05 PM] rsulfuratus: and that for sorting and other purposes, if MM is missing, it is set to 1, and if DD is missing it is set to 1
[2023-11-10 04:10 PM] Deciusmus: yes
[2023-11-10 04:16 PM] Deciusmus: well, actually
[2023-11-10 04:16 PM] Deciusmus: I think for "end" dates we assume 12-31 or last day
[2023-11-10 04:20 PM] Deciusmus: I pushed a bunch of spec
[2023-11-10 04:21 PM] rsulfuratus: right
[2023-11-10 04:34 PM] Deciusmus: Encourage you to read the specs in _MOC\Templates and Scripts rather than look at a the Javascript
[2023-11-10 04:34 PM] Deciusmus: fixed a lot of logical bugs when writing them
[2023-11-10 04:34 PM] Deciusmus: you might be better off with just a reimplement from scratch using the spec than anything else
[2023-11-10 04:35 PM] Deciusmus: I think the specs are pretty clear and should be trivial to implement from
[2023-11-10 04:38 PM] rsulfuratus: re: this "Note that in frontmatter, specifying YYYY-MM and YYYY-MM-01 are identical. If you want to indicate that the day is unknown, set the date as YYYY-MMx"
[2023-11-10 04:38 PM] rsulfuratus: does this imply that if I split on `-` I can't assume outputs of split are ints?
[2023-11-10 04:39 PM] Deciusmus: yeah
[2023-11-10 04:40 PM] Deciusmus: Javascript parseInt happily ignores the trailing junk
[2023-11-10 04:40 PM] Deciusmus: which makes it easy
[2023-11-10 04:41 PM] Deciusmus: I mean, we could define that ONLY MMx is valid
[2023-11-10 04:41 PM] Deciusmus: literally x I mean
[2023-11-10 04:41 PM] rsulfuratus: no it doesn't matter, easy to trim non-numeric chars
[2023-11-10 04:41 PM] rsulfuratus: just trying to get the clean_date function correct as everything depends on that
[2023-11-10 04:41 PM] Deciusmus: yeah
[2023-11-10 04:42 PM] Deciusmus: the Javascript is  pain for that because we have 4 types of dates:
    
    - Luxon dates from Dataview
[2023-11-10 04:42 PM] Deciusmus: - JS Dates from YAML
    - String dates 
    - "fantasy calendar" dates which are very similar to Luxon dates but they have 0index rather than 1index months
[2023-11-10 04:42 PM] Deciusmus: In python you just have a string so in theory much easier
[2023-11-10 04:50 PM] rsulfuratus: born, created, founded, built: these are used to determine at what point the page started to exist. If the page has a type, then only the type value will be used. Otherwise, the order here is searched and the first defined one used.
[2023-11-10 04:50 PM] rsulfuratus: why don't we just use born and change the output text by type?
[2023-11-10 04:50 PM] rsulfuratus: seems unnecessarily complicated for coding
[2023-11-10 04:50 PM] rsulfuratus: or, if that is too annoying, use born (living things) created (non-living things)
[2023-11-10 04:51 PM] rsulfuratus: died (living) destroyed (non-living)
[2023-11-10 05:02 PM] Deciusmus: yeah, lets do that
[2023-11-10 05:02 PM] Deciusmus: I don't love born/died for buildings
[2023-11-10 05:02 PM] Deciusmus: but lets do born/created and died/destroyed
[2023-11-10 05:03 PM] Deciusmus: probably better to just say:
    
    if NPC or Ruler or PC, use born
    else if no type or any other type use created
[2023-11-10 05:04 PM] rsulfuratus: yeah
[2023-11-10 05:04 PM] Deciusmus: ca you update the spec file
[2023-11-10 05:04 PM] Deciusmus: actually I will
[2023-11-10 05:16 PM] rsulfuratus: my logic for current date:
    1. if the page as a pageTargetDate, use that
    2. if there is no pageTargetDate, but you specify a date on the command line, use that
    3. if there is no pageTargetDate and you don't specific a date on the command line, use the current date in the data.json fantasy calendar info
[2023-11-10 05:19 PM] Deciusmus: mine is:
    
        get_pageEventsDate(metadata) {
    
            if (metadata.pageTargetDate) {
                return this.parse_date_to_events_date(metadata.pageTargetDate, false);
            }
    
            return this.parse_date_to_events_date(window.FantasyCalendarAPI.getCalendars()`[0]`.current, false);
        }
[2023-11-10 05:19 PM] Deciusmus: basically skipping the cmdline
[2023-11-10 05:24 PM] rsulfuratus: your specs are great, takes like 10 minutes to code each function with that plus copilot
[2023-11-10 05:25 PM] rsulfuratus: i have the page date and the regnal date reimplemented with a cleaner way to handle dates
[2023-11-10 05:25 PM] rsulfuratus: haven't tested yet
[2023-11-10 05:27 PM] Deciusmus: yeah, well, writing specs like that is what I do for a living
[2023-11-10 05:27 PM] Deciusmus: at least sometimes
[2023-11-10 05:32 PM] rsulfuratus: why do we have place, region separate in whereabouts?
[2023-11-10 05:32 PM] rsulfuratus: i guess it is to do dataview queries?
[2023-11-10 05:36 PM] rsulfuratus: would it not make more sense to just do a text query? e.g. whereabouts.home.location contains "Tokra"
[2023-11-10 05:37 PM] rsulfuratus: feel like we are not consistent about what goes in each bit (place vs region) and it would be easy enough to have just location: "Chardon, Chardonian Empire, The West Coast Region"
[2023-11-10 05:37 PM] rsulfuratus: then in code can split on commas and any subpiece gets links
[2023-11-10 05:44 PM] Deciusmus: yeah that makes sense
[2023-11-10 05:45 PM] Deciusmus: the "exact whereabouts" spec is't quite right
[2023-11-10 05:46 PM] Deciusmus: sorry
[2023-11-10 05:46 PM] Deciusmus: last known
[2023-11-10 05:53 PM] rsulfuratus: I think this is backwards: "Sets the "page exists" flag to true if the Page End Date is defined Page End Date is before the Target Date"
[2023-11-10 05:53 PM] rsulfuratus: or rather if page end date is not defined this should be true too should it not
[2023-11-10 05:53 PM] Deciusmus: yes
[2023-11-10 05:54 PM] Deciusmus: should be "not defined or "
[2023-11-10 05:54 PM] rsulfuratus: kate and i are going out to dinner so i'm not going to work on this more tonight but i should be able to finish all the python code tomorrow morning, then will test
[2023-11-10 06:18 PM] rsulfuratus: i also will probably write some code tomorrow that scans a directory, and cleans up yaml.
    1. removes home, homeRegion, origin, originRegion, location, locationRegion and sets whereabouts, also added a tag to make it easy to check files that are updated this way (they will have incorrect dates)
    2. updates whereabouts lines to current spec if they don't meet it (here probably less concern about errors, so won't tag)
[2023-11-10 06:20 PM] rsulfuratus: if we have a good metadata spec at some point this could be extended to do something like:
    1. read in file, parse yaml
    2. write out yaml based on spec, with empty values for missing things
    3. delete yaml frontmatter not in spec, but write out deleted yaml to a comment box immediately at the start of the file in case it was important
[2023-11-10 06:45 PM] Deciusmus: I might take a stab at a metadata spec
[2023-11-10 06:45 PM] Deciusmus: Although I think only thing we have well defined is NPC
[2023-11-10 06:45 PM] Deciusmus: And even there the ‚Äúfamily‚Äù / ‚Äúorganization‚Äù stuff
[2023-11-10 06:48 PM] Deciusmus: Is a bit vague
[2023-11-10 09:20 PM] Deciusmus: I pushed a proposed metadata spec

