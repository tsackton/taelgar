# Discord DM â€“ 2024-03-29

[2024-03-29 10:31 AM] rsulfuratus: think Armand is basically done. I might make a different image if I feel like it, but if not yours is fine. still needs a magic item, if you have ideas, and might switch lucky feat for resilient con
[2024-03-29 11:07 AM] Deciusmus: I'll look when I get a chance
[2024-03-29 04:10 PM] Deciusmus: there seems to be a bug in the python site export code...
     A line like this: 
    | ![[assets/ring-of-wounding.png\|240]]           | [[Campaigns/Cleenseau Campaign/Treasure/Ring of Wounding.md\|Ring of Wounding]]                         | ring  | `[Reference]`(https://www.dndbeyond.com/magic-items/8244293-ring-of-wounding)             |
    
    becomes
    
    | !`[Ring Of Wounding]`(../../../assets/ring-of-wounding.png/){width="240"}           | `[Ring of Wounding]`(`<../../Cleenseau Campaign/Treasure/Ring of Wounding.md/>`)                         | ring  | `[Reference]`(https://www.dndbeyond.com/magic-items/8244293-ring-of-wounding)             |
    
    i.e. the image and external links are fixed correctly but the internal link doesn't get slugifying (although it does not formatted)
[2024-03-29 04:33 PM] rsulfuratus: hmm
[2024-03-29 04:34 PM] Deciusmus: figured it out
[2024-03-29 04:34 PM] Deciusmus: although I don't know the fix
[2024-03-29 04:34 PM] Deciusmus: the issue is:
    
    [[Campaigns/Cleenseau Campaign/Treasure/Ring of Wounding.md|Ring of Wounding]]
[2024-03-29 04:34 PM] Deciusmus: that type of link (to the full filename) doesn't work
[2024-03-29 04:34 PM] Deciusmus: but that is what dataview generates for the "link" function
[2024-03-29 04:56 PM] rsulfuratus: this is a weird one
[2024-03-29 04:57 PM] Deciusmus: I think I have a fix
[2024-03-29 04:57 PM] rsulfuratus: i tentatively suspect windows/mac confusion
[2024-03-29 04:57 PM] Deciusmus: the issue is the ".md"
[2024-03-29 04:57 PM] Deciusmus: you have a block in export_vault
[2024-03-29 04:57 PM] Deciusmus: with the comment
     ## check to see if we have a broken obsidian path
                     # this is not the best way to do this
[2024-03-29 04:57 PM] rsulfuratus: yes that is what I'm looking at - that is where this should hit
[2024-03-29 04:57 PM] Deciusmus: the link ends with .md\
[2024-03-29 04:58 PM] Deciusmus: so the parts has as last part
    
    Silverthorwn.md\ for example
[2024-03-29 04:58 PM] Deciusmus: but that isn't in self.path_dict, because the actual file ended up in as Silverthorwn
[2024-03-29 04:59 PM] Deciusmus: no .md
[2024-03-29 04:59 PM] rsulfuratus: do you mean it ends .md, or .md\?
[2024-03-29 04:59 PM] rsulfuratus: sorrry or .md\\?
[2024-03-29 04:59 PM] Deciusmus: I believe the 2nd one
[2024-03-29 04:59 PM] rsulfuratus: where does the extra `\` come from?
[2024-03-29 04:59 PM] Deciusmus: here is the parts:
    `['Campaigns', 'Cleenseau Campaign', 'Treasure', 'Chest of the Forest Guardian.md\\']`
[2024-03-29 05:00 PM] Deciusmus: I am not sure
[2024-03-29 05:00 PM] Deciusmus: Ah
[2024-03-29 05:00 PM] Deciusmus: it is because it is in a dataview table
[2024-03-29 05:00 PM] Deciusmus: so dataview adds \ to escape the |
[2024-03-29 05:01 PM] rsulfuratus: should just be able to flip the order of the rstrip and the replace then
[2024-03-29 05:01 PM] Deciusmus: the actual line is:
    
    | ![[assets/chest-of-forest-guardian.png\|240]]   | [[Campaigns/Cleenseau Campaign/Treasure/Chest of the Forest Guardian.md\|Chest of the Forest Guardian]] | chest | `[Reference]`(https://www.dndbeyond.com/magic-items/8244307-chest-of-the-forest-guardian) |
[2024-03-29 05:01 PM] Deciusmus: the actual line is:
    
    ```| ![[assets/chest-of-forest-guardian.png\|240]]   | [[Campaigns/Cleenseau Campaign/Treasure/Chest of the Forest Guardian.md\|Chest of the Forest Guardian]] | chest | `[Reference]`(https://www.dndbeyond.com/magic-items/8244307-chest-of-the-forest-guardian) |
    ```
[2024-03-29 05:02 PM] Deciusmus: what fixed it for me was:
    
    ```-                if parts`[-1]` in self.path_dict:
    -                    alias = str(parts`[-1]`) if alias == "" else alias
    +                final_part = self.remove_trailing_backslash(parts`[-1]`)
    +                if final_part.endswith(".md"):
    +                    final_part = os.path.splitext(final_part)`[0]`
    ```
[2024-03-29 05:02 PM] Deciusmus: and then using final_part instead of parts`[-1]` in the rest of the block
[2024-03-29 05:04 PM] rsulfuratus: wait where does self.remove_trailing_backslash come from? did you add that too?
[2024-03-29 05:04 PM] Deciusmus: yes
[2024-03-29 05:04 PM] Deciusmus: it comes from chatgpt
[2024-03-29 05:04 PM] Deciusmus: ```
        def remove_trailing_backslash(self, string):
            if string.endswith("\\"):
                return string`[:-1]`
            return string
    ```
[2024-03-29 05:04 PM] rsulfuratus: rstrip does that
[2024-03-29 05:05 PM] Deciusmus: I don't see rstrip in the code though
[2024-03-29 05:05 PM] rsulfuratus: `clean_name = parts`[-1]`.replace('.md', '').rstrip("\\/")`
[2024-03-29 05:05 PM] Deciusmus: ah, sure
[2024-03-29 05:05 PM] Deciusmus: your code might be better than chat gpt's
[2024-03-29 05:06 PM] Deciusmus: I just asked it how to remove a trailing "\\"
[2024-03-29 05:06 PM] Deciusmus: chat gpt didn't know about rstrip
[2024-03-29 05:06 PM] rsulfuratus: what I'm slightly confused by is as I understand it the order shouldn't matter, replace then rstrip or rstrip then replace
[2024-03-29 05:07 PM] Deciusmus: I don't know what you are looking at
[2024-03-29 05:07 PM] rsulfuratus: so there might be something else wrong with my code
[2024-03-29 05:07 PM] rsulfuratus: `clean_name = parts`[-1]`.replace('.md', '').rstrip("\\/")`
[2024-03-29 05:07 PM] Deciusmus: Ah, wait
[2024-03-29 05:07 PM] Deciusmus: I don't think I have that version!
[2024-03-29 05:08 PM] Deciusmus: are you sure that is pushed
[2024-03-29 05:08 PM] rsulfuratus: https://github.com/tsackton/taelgar-utils/blob/b720469956a42ef2ca193c4259f8142e14d3528f/taelgar_lib/WikiLinkReplacer.py#L59
[2024-03-29 05:08 PM] Deciusmus: ahaa
[2024-03-29 05:08 PM] Deciusmus: but the issue isn't there
[2024-03-29 05:08 PM] Deciusmus: the issue is the slugification
[2024-03-29 05:09 PM] Deciusmus: wait
[2024-03-29 05:09 PM] Deciusmus: no, I am confused
[2024-03-29 05:09 PM] Deciusmus: what is taelgar-lib
[2024-03-29 05:10 PM] rsulfuratus: that is where the WikiLinkReplacer code is
[2024-03-29 05:10 PM] Deciusmus: i'm using https://github.com/tsackton/taelgarverse-site-generator/blob/main/scripts/export_vault.py
[2024-03-29 05:10 PM] rsulfuratus: yeah it imports taelgar_lib
[2024-03-29 05:10 PM] rsulfuratus: `from taelgar_lib.ObsNote import ObsNote
    from taelgar_lib.WikiLinkReplacer import WikiLinkReplacer`
[2024-03-29 05:10 PM] Deciusmus: no it doesn't?
[2024-03-29 05:11 PM] rsulfuratus: you are a ways behind I suspect
[2024-03-29 05:11 PM] Deciusmus: i'm looking at main on github
[2024-03-29 05:11 PM] Deciusmus: ah
[2024-03-29 05:11 PM] Deciusmus: you moved away from taelgarverse-site-generator entirely
[2024-03-29 05:12 PM] Deciusmus: you are using taelgar-utils
[2024-03-29 05:12 PM] Deciusmus: in fact you fixed this very bug
    https://github.com/tsackton/taelgar-utils/commit/b720469956a42ef2ca193c4259f8142e14d3528f
[2024-03-29 05:12 PM] Deciusmus: but I think I missed the cutover to taelgar-lib
[2024-03-29 05:13 PM] rsulfuratus: ah okay
[2024-03-29 05:13 PM] Deciusmus: I am still using the old code
[2024-03-29 05:13 PM] rsulfuratus: yeah we had a long convo about unbundling my taelgarverse site information from the processing code so I split out the export stuff into taelgar-utils
[2024-03-29 05:14 PM] rsulfuratus: my taelgarverse repo is set up with taelgar-utils and taelgar as submodules
[2024-03-29 05:14 PM] rsulfuratus: https://github.com/tsackton/taelgarverse
[2024-03-29 05:14 PM] Deciusmus: yes I was just looking there
[2024-03-29 05:14 PM] Deciusmus: which is how I figured this out ðŸ™‚
[2024-03-29 05:14 PM] rsulfuratus: ah I see you still have the taelgarverse-site-generator as a submodule
[2024-03-29 05:15 PM] Deciusmus: right, I never cutover in feb or whenever it was
[2024-03-29 05:15 PM] Deciusmus: I'm going to do that now
[2024-03-29 05:17 PM] rsulfuratus: my autobuild script is very smooth, might need a few tweaks for windows: https://github.com/tsackton/taelgarverse/blob/main/autobuild_website.sh
[2024-03-29 05:18 PM] Deciusmus: i have a similar autobuild batch script
[2024-03-29 05:34 PM] Deciusmus: hrm
[2024-03-29 05:34 PM] Deciusmus: I got a somewhat broken build
[2024-03-29 06:16 PM] rsulfuratus: what is broken?
[2024-03-29 06:26 PM] Deciusmus: I think I fixed it
[2024-03-29 06:26 PM] Deciusmus: Lots of little changes in where css comes from

