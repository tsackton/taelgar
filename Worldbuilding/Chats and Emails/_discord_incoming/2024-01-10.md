# Discord DM – 2024-01-10

[2024-01-10 07:30 AM] Deciusmus: The only bit I’d use in game is the flavor about debased metals during the 1550s - 1650s, so I might say have a treasure horde with thousands of coins from the reign of Bertram I which are not worth as much as it seems
[2024-01-10 07:31 AM] Deciusmus: The other bit I might use in game is words, ie “that drink is a halfbit please”. But we don’t keep track of every coin spent and everything converts to ~10 gp units ultimately for tracking
[2024-01-10 11:38 AM] rsulfuratus: A few more website thoughts after fiddling with quartz and with obsidian-export a bit.
    
    quartz is very easy to set up and do some basic customization with, it also handles obsidian-style wikilinks and file renaming to get nicer urls natively; it does not strip comments (`%%` text `%%`); the search is only adequate; it does not handle folder pages very well (requires them to be named index.md); and it is has only limited ability to handle things like timelines and tables. some formatting quirks with lists and newlines and page titles but these can probably be fixed with config options.
    
    obsidian-export basically is only useful for converting wikilinks to something else; it does not handle admonitions, comment stripping, or anything else like that
    
    material for mkdocs is more work to set up, but is ultimately a lot more customizable that quartz. however it is complicated enough i don't have a simple working test page locally, so there is more of a heavy lift to start with
[2024-01-10 11:44 AM] rsulfuratus: probably, the best workflow is something like:
    taelgar-utils (strip comments, secrets, dataview queries that will not be static-ified, clean up tags/headers/metadata as desired)
    templater export (static-ify dataview)
    quartz (produce html/layout)
[2024-01-10 11:44 AM] rsulfuratus: that would require a few tweaks to taelgar-utils to support things that quartz doesn't (primarily removing comments)
[2024-01-10 11:45 AM] rsulfuratus: then the quartz step can happen as a github action, so the website build process is:
    run taelgar-utils to create new vault in website repo
    open vault
    run exporter
    push
[2024-01-10 11:47 AM] rsulfuratus: if we instead wanted more flexible customization options with hugo/jekyll/mkdocs/whatever
    you would need to add a "fix wikilinks" step and possibly some other reformatting
[2024-01-10 11:47 AM] rsulfuratus: but this would mostly be able to be handled by obsidian-export
[2024-01-10 11:47 AM] Deciusmus: note that because quartz is JS, it would in theory be possible to run the existing scripts as quartz plugins
[2024-01-10 11:48 AM] rsulfuratus: except can you call the obsidian API outside of obsidian?
[2024-01-10 11:48 AM] rsulfuratus: that seems tricky
[2024-01-10 11:48 AM] Deciusmus: Well no. But the entire set of JS code only uses the obisidian API in 1 place
[2024-01-10 11:48 AM] Deciusmus: NameManager.getFileForTarget
[2024-01-10 11:49 AM] Deciusmus: (and dv.current() in a few places to get the "current" page, but I think it only reads metadata from the current page, so that should be handled by the quartz plugin, which passes the same conceptual thing)
[2024-01-10 11:50 AM] Deciusmus: that said, NameManager.getFileForTarget is a key function and without looking at quartz I don't know how easy it is to find a file based on a link text item
[2024-01-10 11:51 AM] rsulfuratus: it must be able to since this is how it parses and links wikilinks style text
[2024-01-10 11:51 AM] rsulfuratus: that said I'm not actually sure how valuable this would be
[2024-01-10 11:52 AM] Deciusmus: it probably isn't, really
[2024-01-10 11:52 AM] Deciusmus: honestly. because it is pretty easy to just staticify stuff
[2024-01-10 11:53 AM] rsulfuratus: you could remove the need to open obsidian for the prepare for export step but otherwise I don't think it gets you much since you still can't link the website to the main vault
[2024-01-10 11:54 AM] rsulfuratus: the only reason to go that route is if we ever move off github pages and do something like get taelgarverse.org served by a cloudfare backend that could then be set up to automatically generate separate taelgarverse.org pages based on a set of static dates
[2024-01-10 11:55 AM] Deciusmus: mostly it might be interesting if I wanted to play with more modern javascript stuff, honestly
[2024-01-10 11:55 AM] Deciusmus: I don't do a lot of node/JS functions only/etc
[2024-01-10 11:55 AM] rsulfuratus: well sure as a coding project its fine
[2024-01-10 11:55 AM] Deciusmus: But I guess I am just saying the shared Javascript architecture is a (small) benefit of Quartz
[2024-01-10 11:56 AM] rsulfuratus: well, you can add javascript to any of the static site generators
[2024-01-10 11:56 AM] Deciusmus: ah, well then
[2024-01-10 11:56 AM] Deciusmus: maybe it doesn't matter
[2024-01-10 11:57 AM] Deciusmus: Honestly the thing I care about the most is getting leaflet to work
[2024-01-10 11:57 AM] rsulfuratus: that is my biggest hesitation with committing to quartz
[2024-01-10 11:59 AM] rsulfuratus: e.g. this looks fairly possible: https://github.com/squidfunk/mkdocs-material/discussions/2498
[2024-01-10 12:01 PM] rsulfuratus: and there are dozens of repos with various implementations of leaflet in hugo or jekyll
[2024-01-10 12:04 PM] rsulfuratus: it should be theoretically possible to make a quartz plugin that runs leaflet but this would be definitely trickier
[2024-01-10 12:05 PM] Deciusmus: this is nice on mkdocs:
![[../_discord_assets/image-7FD58.png]]
[2024-01-10 12:05 PM] Deciusmus: having the bio blocks nest on the left/right of content would look a lot nicer
[2024-01-10 12:06 PM] Deciusmus: I think the taelgar_utils would have to convert obisidian-style callouts to mkdocs style though
[2024-01-10 12:06 PM] rsulfuratus: yeah or I was thinking you could also nest an image on the right of the bio block
[2024-01-10 12:07 PM] rsulfuratus: yes, if we go the mkdocs route than taelgar-utils needs to strip comments and convert callouts
[2024-01-10 12:07 PM] rsulfuratus: in that case I might also just handle link cleanup as well in taelgar-utils, which is not that hard and could then also handle path renaming to generate nicer urls without all the spaces
[2024-01-10 12:09 PM] rsulfuratus: just searched the quartz discord and github issues and there is no mention of leaflet in either, except one github comment saying supporting it was out of scope
[2024-01-10 12:11 PM] Deciusmus: mkdocs plugins look pretty straightforward as well
[2024-01-10 12:11 PM] Deciusmus: how are you currently managing stripping non-linked content? does taelgar-utils do that, or did you just publish everything?
[2024-01-10 12:12 PM] rsulfuratus: I have the obsidianhtml config set up to strip non-linked content
[2024-01-10 12:12 PM] Deciusmus: ah, right, obsidianthml is still being used
[2024-01-10 12:12 PM] rsulfuratus: yeah
[2024-01-10 01:41 PM] Deciusmus: Mkdocs really seems like a better choice honestly. I found plugins for callouts and wiki links and it has a very simple extension architecture for one off scripts via a hooks.pu
[2024-01-10 01:43 PM] Deciusmus: Ie https://github.com/JonasDoesThings/mkdocs-obsidian-hooks
[2024-01-10 01:46 PM] Deciusmus: Or https://github.com/ObsidianPublisher/mkdocs-publisher-template
[2024-01-10 01:47 PM] Deciusmus: The idea would be that taelgar-utils vanishes, it becomes some hooks on the mkdocs template
[2024-01-10 01:48 PM] Deciusmus: Only bit I don’t see an obvious way to do is (a) leaflet (b) filtering out unwanted files via something more complex than gitignore file-syntax
[2024-01-10 01:48 PM] Deciusmus: But both should be pretty straightforward
[2024-01-10 01:51 PM] Deciusmus: But the file filter would probably be pretty easy via https://github.com/mfarragher/obsidiantools
[2024-01-10 01:51 PM] Deciusmus: And the mkdocs “files” hook
[2024-01-10 01:51 PM] Deciusmus: The file hook is a python function which takes a set of files mkdoc wants to include in the site and returns a modified list
[2024-01-10 01:52 PM] Deciusmus: You could in theory just use the obsidian tools to build a graph then get all the nodes in the graph that are reachable from the index.md root
[2024-01-10 01:53 PM] Deciusmus: Would also be not hard to do things like have frontmatter:
    excludePublish: `[campaign, campaign]` or something so if either of us wanted to restrict access to pages you wouldn’t have to worry about links.
[2024-01-10 02:07 PM] rsulfuratus: yeah I basically had the same thought
[2024-01-10 02:08 PM] rsulfuratus: I have been testing some python functions with taelgar-utils but it should be trivial to lift them into mkdocs hooks
[2024-01-10 02:09 PM] rsulfuratus: i have strip comments, strip campaign info, and strip by date working fine
[2024-01-10 02:09 PM] rsulfuratus: as simple python functions that just take text
[2024-01-10 02:09 PM] Deciusmus: Right, so the idea would be to just add that to a taelgar_hooks.py with an on_markdown or whatever it is called
[2024-01-10 02:09 PM] rsulfuratus: exactly
[2024-01-10 02:09 PM] Deciusmus: this is a good example
[2024-01-10 02:09 PM] Deciusmus: https://github.com/ObsidianPublisher/mkdocs-publisher-template/blob/main/overrides/hooks/on_page_markdown.py
[2024-01-10 02:26 PM] rsulfuratus: so the workflow is going to be:
    copy files to new location in some fashion
    run export in obsidian
    push, using github actions to run python code to clean up markdown and then let mkdocs build html
[2024-01-10 02:31 PM] Deciusmus: Conceptually it would be possible to change the export-in-obsidian to generate static blocks for each registered campaign, i.e. something like
    
    `%%`Campaign:^DuFr`%%`
    info block for dumar
    `%%`End
    
    `%%`Campaign:^Cleen`%%`
    info block for cleen
    `%%`End
[2024-01-10 02:31 PM] Deciusmus: which would mean the github actions side could in theory generate 2 different sites
[2024-01-10 02:31 PM] Deciusmus: not sure if that is worthwhile
[2024-01-10 02:33 PM] rsulfuratus: I don't think that is worthwhile
[2024-01-10 02:36 PM] rsulfuratus: the one other thing to consider is slugifying links, I personally really dislike the `https://tsackton.github.io/taelgarverse/Gazetteer/Greater%20Dunmar/Garamjala%20Plateau/Garamjala%20Desert.html`
[2024-01-10 02:36 PM] rsulfuratus: with a lot of %20s in them
[2024-01-10 02:36 PM] Deciusmus: yeah
[2024-01-10 02:36 PM] Deciusmus: I would guess there is a standard plugin for that
[2024-01-10 02:38 PM] rsulfuratus: yeah it looks fairly easy
[2024-01-10 02:41 PM] Deciusmus: 
![[../_discord_assets/image-DFB8A.png]]
[2024-01-10 02:45 PM] rsulfuratus: is that mkdocs?
[2024-01-10 02:45 PM] Deciusmus: yup
[2024-01-10 02:45 PM] Deciusmus: 
Attachment (mkdocs.yml):
```yml
site_name: TaelgarVerse 1720
theme:
  name: material
markdown_extensions:
  - md_in_html
  - footnotes
  - nl2br
  - attr_list
  - sane_lists
  - meta
  - smarty
  - tables
  - def_list
  - admonition
  - pymdownx.details
  - pymdownx.superfences
plugins:
  - search  
  - callouts
  - ezlinks:
     warn_ambiguities: true
     wikilinks: true
     reference_links: false
```
[2024-01-10 02:46 PM] Deciusmus: all I did was:
    
    pip install the following
    
    mkdocs                     1.5.3
    mkdocs-callouts            1.10.0
    mkdocs-ezlinked-plugin     0.3.3
    mkdocs-material            9.5.3
    mkdocs-material-extensions 1.3.1
    
    create temp dir
    mkdocs new .
    copy vault to docs folder
[2024-01-10 02:46 PM] Deciusmus: use the mkdocs.yml above
[2024-01-10 02:47 PM] Deciusmus: mkdocs serve
[2024-01-10 02:51 PM] Deciusmus: slight bit of mess but promisig:
![[../_discord_assets/image-4984C.png]]
[2024-01-10 02:54 PM] Deciusmus: in obisidian the image has an annoying tag
![[../_discord_assets/image-A8D8E.png]]
[2024-01-10 02:59 PM] rsulfuratus: could probably have some custom css for obsidian that either hides it or makes it work
[2024-01-10 03:00 PM] Deciusmus: yeah
[2024-01-10 03:00 PM] rsulfuratus: there are other bits of annoyingness that would need to be cleaned up, e.g. want a python hook that replaces (DR:: 1748-01-01) with text
[2024-01-10 03:00 PM] Deciusmus: right
[2024-01-10 03:23 PM] rsulfuratus: at least on mac, the ezlinks plugin is kind of crappy, it is case sensitive but obsidian is not so tons of links break
[2024-01-10 03:23 PM] Deciusmus: are you using the ezlinked or ezlinks?
[2024-01-10 03:23 PM] rsulfuratus: ezlinked
[2024-01-10 03:24 PM] Deciusmus: but yes, I noticed the case sensitive issue
[2024-01-10 03:24 PM] rsulfuratus: still crappy
[2024-01-10 03:24 PM] Deciusmus: It seems to have 2 issues:
    - It can't link to a page that has the same name as the folder
    - links are case senstive
[2024-01-10 03:41 PM] rsulfuratus: so, there might be another way to run this. basically, you could have a source directory and then a hook that builds the md files in the docs directory. this is how we do a lot of my lab page (except from json + md templates)
[2024-01-10 03:42 PM] rsulfuratus: then the website directory would have taelgar main vault as a submodule
[2024-01-10 03:42 PM] rsulfuratus: building website would just be update submodule and push
[2024-01-10 03:42 PM] rsulfuratus: then we could just have custom python code to catch the various link quirks and other things
[2024-01-10 03:42 PM] rsulfuratus: and could easily slugify, etc
[2024-01-10 03:47 PM] rsulfuratus: e..g pretty easy to convert:
    [[the Traveler]] ->` `[the Traveler]`(../rel/path/to/the-traveler.md)
[2024-01-10 03:48 PM] rsulfuratus: and to convert every file to lowercase-dash-space.md
[2024-01-10 03:56 PM] Deciusmus: Right
[2024-01-10 04:04 PM] rsulfuratus: ah...hmm..might even be more straightforward. you can have a github action that checks out a repo. 
    
    so the website repo can, in theory, just be some mkdocs styling and python code, when you push it triggers:
    checkout taeglar
    run hooks to build docs
    publish
[2024-01-10 04:05 PM] rsulfuratus: to build locally you'd I think need to manually clone repo before running mkdocs serve
[2024-01-10 04:05 PM] rsulfuratus: then you'd just have like a date.yaml or something and if you want to update webiste should be as simple as bumping date and then push
[2024-01-10 04:12 PM] rsulfuratus: so I think in that structure, you'd have taelgar_export.py or whatever, which reads a json with:
    campaign
    target_date
    build_date
    
    in then creates the docs directory, stripping comments and cleaning links.
    
    the github action would be set up to run if website.json was updated, and would:
[2024-01-10 04:13 PM] rsulfuratus: 1. checkout taelgar
    2. run taelgar_export.py as a pre-build hook
[2024-01-10 04:15 PM] Deciusmus: I haven't played around with github actions really at all
[2024-01-10 04:15 PM] Deciusmus: you are thinking we'd each have a repo that has taelgar as a submodule
[2024-01-10 04:17 PM] rsulfuratus: yeah
[2024-01-10 04:18 PM] rsulfuratus: this is how we set up my lab website, https://github.com/harvardinformatics/informatics-website/blob/main/.github/workflows/gh-pages.yml
[2024-01-10 04:18 PM] rsulfuratus: it is fairly simple
[2024-01-10 04:18 PM] rsulfuratus: https://github.com/actions/checkout
[2024-01-10 04:18 PM] Deciusmus: it can't just checkout taelgar as it needs to have the static-ified version
[2024-01-10 04:19 PM] rsulfuratus: ah, hmm, yeah
[2024-01-10 04:19 PM] rsulfuratus: then you would need to do that locally
[2024-01-10 04:19 PM] rsulfuratus: basically you'd want it as a submodule
[2024-01-10 04:20 PM] rsulfuratus: so you git pull; open obsidian and staticify; then git push
[2024-01-10 04:20 PM] Deciusmus: I think it might be easier to push inside obisidian
[2024-01-10 04:20 PM] Deciusmus: there are lots of obisidan plugins that push to a git repo
[2024-01-10 04:30 PM] Deciusmus: look at https://github.com/ObsidianPublisher/obsidian-github-publisher
[2024-01-10 04:34 PM] Deciusmus: Pretty sure that's the right solution
[2024-01-10 04:35 PM] Deciusmus: You don't need to copy the vault or anything.
    Just open your existing vault.
    Run static template
    Run github publish
    Git revert to discard changes
[2024-01-10 04:36 PM] Deciusmus: the github publish cleans the files in obsidian & then pushes to a **different** github repo
[2024-01-10 04:36 PM] Deciusmus: so it doesn't touch the "real" one
[2024-01-10 04:41 PM] rsulfuratus: to me that seems more of a pain but in principle it shouldn't actually matter
[2024-01-10 04:42 PM] Deciusmus: More of a pain than what?
[2024-01-10 04:42 PM] rsulfuratus: that is, we don't have to agree on how to go from "live" vault ->` static vault
[2024-01-10 04:42 PM] Deciusmus: sure
[2024-01-10 04:42 PM] rsulfuratus: more of a pain than:
    git pull
    open vault; run export in place
    git push
[2024-01-10 04:42 PM] Deciusmus: well, the key thing about the obisidian published plugin is it pushes to github itself
[2024-01-10 04:43 PM] Deciusmus: you can't git push
[2024-01-10 04:44 PM] rsulfuratus: the setup is:
    taelgar repo
    (mike) website repo
    (tim) website repo
    
    each website repo needs a "source" directory that is a static clone of the taelgar repo, which will be parsed by export_taelgar.py or whatever
    
    how you get a static clone into the source directory shouldn't matter
[2024-01-10 04:44 PM] Deciusmus: sure
[2024-01-10 04:46 PM] rsulfuratus: the only key thing is you need:
    (a) the static content to get pushed to a specific directory in the website repo
    (b) github actions set up to build mkdocs with the taelgar_export hook when the static content is updated
[2024-01-10 04:46 PM] Deciusmus: but obisidian publisher materializes dataview queries
[2024-01-10 04:46 PM] Deciusmus: https://github.com/msackton/taelgar-publish-test/blob/taelgar-1-10-2024/Arcus.md
[2024-01-10 04:46 PM] Deciusmus: (not dataviewjs, unforuntately)
[2024-01-10 09:42 PM] rsulfuratus: i fiddled around a fair bit with some python. conceptually it definitely feels like it will be quite possible to get an mkdocs site working but there are a bunch of fiddly details to figure out and debug. 
    
    the basic protocol of static source ->` python hook ->` website though feels like it should work, regardless of how the static source is generated
    
    dealing with slugification of urls and converting wikilinks is a huge pain, i can kind of understand why all the existing implementations are kind of buggy
[2024-01-10 09:44 PM] Deciusmus: The plug-in I suggested above is kinda crap after all. It has all these nice features but they don’t really work
[2024-01-10 09:45 PM] rsulfuratus: i can't say i'm super surprised
[2024-01-10 09:45 PM] Deciusmus: I was starting to look at just updating my template code. Obsidian has a “get file” api
[2024-01-10 09:46 PM] Deciusmus: I think it would actually be fairly easy to:
    Use a regex to get [[]]
    Split on |
    Call obsidian.getLinkpath or whatever to get the full filename to the link
    Output md link
[2024-01-10 09:46 PM] Deciusmus: Could just do it in the same loop that outputs the static template
[2024-01-10 09:47 PM] rsulfuratus: https://github.com/ozntel/obsidian-link-converter
[2024-01-10 09:51 PM] Deciusmus: The other bit would be converting anything where the final dest matches the folder to folder/index.md
[2024-01-10 09:52 PM] Deciusmus: Then folder notes work nicely - as long as some script converts matches to index.md
[2024-01-10 10:30 PM] Deciusmus: I didn’t get a chance to try it out tonight but I might take a stab at having the “prep-export” modify links tomorrow depending on how busy I am at work.

