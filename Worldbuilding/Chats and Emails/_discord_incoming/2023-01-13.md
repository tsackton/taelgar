# Discord DM – 2023-01-13

[2023-01-13 12:02 AM] rsulfuratus: the adding new metadata fields needs some debugging, it does not appear to work
[2023-01-13 12:05 AM] rsulfuratus: if I have a yaml section that is just:
    ```
    ---
    type=NPC
    ---
    ```
[2023-01-13 12:06 AM] rsulfuratus: sometimes I get "unable to determine file type" error, and sometimes I get this: 
    ```
    ---
    type: NPC
    affiliations:
    `<% tp.user.generateHeader(tp) %>`
    ```
[2023-01-13 12:07 AM] rsulfuratus: but for notes that already have metadata it works great to insert and update new template
[2023-01-13 12:12 AM] rsulfuratus: there has to be some kind of race condition, because some of the time it will delete a random line instead of just the template
[2023-01-13 07:25 AM] Deciusmus: I may play with it a bit later today
[2023-01-13 07:25 AM] Deciusmus: I actually think separating the regen header from the metadata is the right thing to do
[2023-01-13 07:37 AM] Deciusmus: So I was thinking three templates:
    - regen header block, does nothing if not a recognized type
[2023-01-13 07:37 AM] Deciusmus: - quick-set metadata, uses the folder scheme to set defaults, never prompts
[2023-01-13 07:38 AM] Deciusmus: - set metadata, prompts for things it can’t figure out
[2023-01-13 07:38 AM] Deciusmus: - new file template, runs the metadata set and then adds the header block
[2023-01-13 07:39 AM] Deciusmus: (That’s 4)
[2023-01-13 07:39 AM] rsulfuratus: that makes sense to me
[2023-01-13 07:41 AM] rsulfuratus: presumably the quick-set metadata and the set metadata both also clean up yaml, injecting missing frontmatter
[2023-01-13 07:55 AM] Deciusmus: right
[2023-01-13 07:55 AM] Deciusmus: I pushed a regen header template
[2023-01-13 07:56 AM] Deciusmus: It seems pretty robust. There are some file-edit race conditions so rarely if you JUST edited a file and then run the template it can mess up changes. Basically I think that the tp.file.contents is sometimes a bit stale and then things get wonky. It's best to not be TOO fast.
[2023-01-13 07:57 AM] Deciusmus: The regen header will fail if there is no type in the yaml, but if the type is set it assumes you have some kind of header for the type
[2023-01-13 08:45 AM] Deciusmus: yes, that is the idea
[2023-01-13 08:47 AM] Deciusmus: One thing I was wondering is whether it would be better to have the metadata in folders, i.e. rather than in the JSON, what if each folder could have a _metadata.md
[2023-01-13 08:49 AM] rsulfuratus: not really a huge fan of that
[2023-01-13 08:50 AM] rsulfuratus: feels like it adds a lot of clutter and auto-filling metadata is not actually a big advantage. realistically the main things you can autofill are species and ancestry, and maybe homeRegion
[2023-01-13 08:53 AM] rsulfuratus: I think you might pre-invent a lot more NPC detail for your game than I do for mine - most commonly NPCs come into existence during play and then I backfill information later, so auto-setting stuff isn't that useful. and often I don't want to invent too much before the NPC exists, so if I'm doing session prep I would tend to leave a lot of fields blank anyway
[2023-01-13 08:56 AM] Deciusmus: What about a single file that defines the basics that are blank?
[2023-01-13 08:56 AM] Deciusmus: Ie rather than the list in the json
[2023-01-13 08:56 AM] rsulfuratus: what is the advantage to having it in a md file in a folder?
[2023-01-13 08:56 AM] Deciusmus: It’s shared between us
[2023-01-13 08:57 AM] Deciusmus: And it is easier to do something like have the sembaran royalty have a ruler template
[2023-01-13 08:58 AM] rsulfuratus: hmm
[2023-01-13 08:58 AM] Deciusmus: I could also do something like have full folder matches for type
[2023-01-13 08:58 AM] Deciusmus: In the json
[2023-01-13 08:58 AM] rsulfuratus: I would probably set it up where there is a shared config file (metadata.json) that lives in .obsidian but we can add to the .gitignore
[2023-01-13 09:00 AM] rsulfuratus: for type, I would do the following:
    1) if there is type already in the yaml, great, go from that
    2) if not, and if the folder matches a known auto-generated path in the json config, set based on that
    3) otherwise, prompt with a drop down menu to fill type
[2023-01-13 09:01 AM] rsulfuratus: this is actually where prompts might be useful - setting up complicated rules to try to guess type won't always get it right (for example, there are organizations in the People directory that shouldn't get NPC type, and both Bulidings and Places live in Gazetteer)
[2023-01-13 09:02 AM] rsulfuratus: better to match exact paths, so you can do something like set the sembaran royalty path to speed up adding headers for the 30 or so notes you have
[2023-01-13 09:03 AM] rsulfuratus: but for generic use, if you are just adding one note, a prompt is fine. and if you don't like prompts it is easy to just insert type, e.g. we could make a template for new-NPC, new-Item etc that would just set type = X, tags = `[stub]` or something
[2023-01-13 09:04 AM] Deciusmus: I could do path regex es
[2023-01-13 09:05 AM] Deciusmus: Ie have the structure be :
    Type ->` list of folder reflexes
[2023-01-13 09:05 AM] rsulfuratus: yeah that would work
[2023-01-13 09:06 AM] rsulfuratus: I think a prompt if it can't figure it out would be nice as well though if it isn't too complicated.
[2023-01-13 09:06 AM] Deciusmus: That is super easy
[2023-01-13 09:08 AM] Deciusmus: So we’d have a metadata.json (shared) that defines the folder->`type and type->` frontmatter
[2023-01-13 09:08 AM] Deciusmus: A taelgarconfig (not shared) that defines the campaign prefix, dv-path, and folder ->` default values
[2023-01-13 09:09 AM] rsulfuratus: yes, that sounds great
[2023-01-13 09:09 AM] Deciusmus: The basic new note template would fill type, insert front matter, and prompt for type is not able to determine
[2023-01-13 09:09 AM] Deciusmus: (And add the header block)
[2023-01-13 09:10 AM] rsulfuratus: yes
[2023-01-13 09:10 AM] Deciusmus: Then I might make a prompting-version of that which prompts for many things
[2023-01-13 09:11 AM] rsulfuratus: right, the new note template could have a "plain" and a "prompt-heavy" version
[2023-01-13 09:12 AM] rsulfuratus: I mean as long as the text output is not changed (so we aren't constantly git reverting each other) we can use different workflows
[2023-01-13 09:12 AM] Deciusmus: Another question— if the note is untitled should it prompt for name
[2023-01-13 09:12 AM] rsulfuratus: yes that it very useful
[2023-01-13 09:22 AM] rsulfuratus: languages might be a useful thing to add to the NPC template
[2023-01-13 09:23 AM] rsulfuratus: also I have been "overloading" affliations for things like dwarven clan, thuhr, halfling family, orc horde
[2023-01-13 09:24 AM] rsulfuratus: but one could imagine breaking that into actual affiliations (mostly limited to things that are organizations; this would probably include thuhr but not clan/family) and some generic family/clan/etc
[2023-01-13 09:24 AM] rsulfuratus: could also use ancestry for some of this
[2023-01-13 09:34 AM] Deciusmus: I was thinking for NPCs "family" might be a nice tag
[2023-01-13 09:34 AM] Deciusmus: for houses of rulers, dwarf clans, etc
[2023-01-13 09:35 AM] rsulfuratus: right. I was thinking about this because I wanted to have a dataview query to pull up all the charmhearts on the charmhearts page, for example
[2023-01-13 09:59 AM] rsulfuratus: fyi when I have been adding the new header, if there is location information I've be putting it on a separate line below the header, like:
![[../_discord_assets/image-94D0D.png]]
[2023-01-13 09:59 AM] rsulfuratus: that way it won't get messed up by header regenerations
[2023-01-13 09:59 AM] rsulfuratus: once we add location to the header we can delete those lines
[2023-01-13 10:02 AM] rsulfuratus: for items, a magical (T/F or yes/no) tag might be nice
[2023-01-13 10:28 AM] Deciusmus: I just pushed a few bugfixes
[2023-01-13 10:28 AM] Deciusmus: FYI
[2023-01-13 10:32 AM] rsulfuratus: not related to this, but I've been playing with the obsidian leaflet plugin - don't think it is really translatable to the web so not using it too much for public facing maps, but it is really easy to just turn an image zoomable and linkable for session prep
[2023-01-13 10:47 AM] Deciusmus: ok... fixing some more bugs
[2023-01-13 10:48 AM] Deciusmus: there are race conditions between the cached data and the on disk data
[2023-01-13 10:48 AM] Deciusmus: the tp.xxx content is not accurate 100% of the time if you've just modified the file
[2023-01-13 10:48 AM] Deciusmus: so I need to move away from tp.`<blah>` to app.vault.adapter.read
[2023-01-13 10:48 AM] Deciusmus: etc
[2023-01-13 10:49 AM] Deciusmus: this means my scripts ALWAYS work on the on-disk version of the file. That means if you make change and then run the script immediately afterward, it is possible that obsidian won't have saved the file to disk before the script runs, and so it might not see you most recent change
[2023-01-13 10:49 AM] Deciusmus: In general it shouldn't happen but I can recreate it in testing by moving fast enough
[2023-01-13 10:50 AM] rsulfuratus: so the main issue I guess would be that if you hit the rebuild header immediately after updating metadata, you might lose your updated metadata?
[2023-01-13 10:51 AM] rsulfuratus: one thing I noticed is that you get a popup "file modified by external source, automatically merging" at least most (all) of the time when you are overwriting your most recent edits
[2023-01-13 10:52 AM] rsulfuratus: so at least you potentially get a warning that something is off if you do hit it
[2023-01-13 10:55 AM] Deciusmus: my bugfixes should help make that popup go away
[2023-01-13 10:56 AM] Deciusmus: but I don't think you will even generally lose your updated metadata as obsidian merges sensibly
[2023-01-13 10:59 AM] Deciusmus: ah
[2023-01-13 11:00 AM] Deciusmus: just save the file before running stuff helps
[2023-01-13 11:00 AM] Deciusmus: i do ctl-s, alt-t
[2023-01-13 11:00 AM] Deciusmus: (where alt-t is my hotfix for the template)
[2023-01-13 11:02 AM] rsulfuratus: there is a plugin called QuickAdd that lets you create macros
[2023-01-13 11:03 AM] rsulfuratus: could easily make a: save note, insert template, reload template macro
[2023-01-13 11:29 AM] rsulfuratus: also, I think I am inclined to move away from a "Ruins and Lairs" folder and just use tags/headers.
[2023-01-13 12:31 PM] rsulfuratus: one more metadata thought - putting D&D beyond links in metadata for magic items could be nice, then you could generate a `[Mechanics]`(dndbeyondlink) link in the header
[2023-01-13 12:33 PM] Deciusmus: yeah
[2023-01-13 12:34 PM] Deciusmus: we are going to new york this weekend and I have a lot of stuff to do for work before our flight, so haven't looked at any of this; but likely to spend my time on the flight/airport working on this
[2023-01-13 12:35 PM] rsulfuratus: the replace header template makes things very fast for just replacing the old headers with the new headers (and it is kind of fun to see how old all your NPCs are now)
[2023-01-13 12:36 PM] rsulfuratus: getting the metadata cleanup stuff will be great but also the main point will be to take the old metadata and insert new stuff, so can iterate on it over time
[2023-01-13 12:36 PM] Deciusmus: yes
[2023-01-13 12:36 PM] rsulfuratus: I have to prep for Monday's session over the weekend (and might be running a game for Isaac too) so I'm not likely to mess around with javascript much for a while
[2023-01-13 12:37 PM] rsulfuratus: so if you are largely working on templates and scripts offline won't be an issue
[2023-01-13 12:37 PM] Deciusmus: Right
[2023-01-13 12:39 PM] Deciusmus: Just to summarize:
    
    * The header stuff is working well; the regen part, which is the key bit for fixing old files is pretty much done
    
    * We want a script that "cleans and creates" metadata as per the earlier conversation -- basically a way to 
    (1) quickly set metadata on a file that has no metadata at all and is just some notes about an npc written in-game or ported from onenote/gdrive
    (2) when writing a file from scratch, provide a way to quickly initialize the metadata
    (3) provide a way to update/standardize metadata as we think of new fields to add
[2023-01-13 12:40 PM] Deciusmus: I'm going to assume for the frontmatter update script the three key usecases are:
    
    * Totally new file (empty & untitled)
    * Minimal file (right npc name, maybe 1-2 sentences, no metadata)
    * Kinda-updated file with some metadata but perhaps missing some pieces
[2023-01-13 12:41 PM] Deciusmus: The goal for totally new file is to figure out the type and name (via prompts) and then initi.
    
    The goal for minimal file is add the metadata and header without prompts preserving the header
[2023-01-13 12:41 PM] Deciusmus: The goal for kinda-updated is to add in the new metadata
[2023-01-13 12:41 PM] Deciusmus: I think for all of those, I will focus on no-prompting. So the template will only ever prompt for name (if untitled) and type (if it can't figure it out)
[2023-01-13 12:42 PM] rsulfuratus: yeah I think that all makes sense
[2023-01-13 12:42 PM] Deciusmus: I might then for my own amusement write a "populate metadata" template that prompts for each piece of missing metadata
[2023-01-13 12:43 PM] Deciusmus: In particular, I like the ablity to have an "Age" prompt calculate the born period, as I often have a sense of "this npc should be about 45" and just just type 42 or 45 but doing the math for "what year should they have been born" is harder
[2023-01-13 12:44 PM] rsulfuratus: one question I guess is if the metadata update script should insert (blank) yaml lines for strictly optional stuff - either something like yearOverride (mostly a debugging tool, so probably no), or the optional things to change the endPrefix, endStatus, etc in the age stuff
[2023-01-13 12:45 PM] rsulfuratus: don't want yaml to get too out of control but might make sense to organize it a bit with comments
[2023-01-13 12:46 PM] rsulfuratus: I am going to write a doc that outlines all the yaml used in the header generation code for reference, so we can think about this
[2023-01-13 01:37 PM] rsulfuratus: metadata table pushed fyi
[2023-01-13 02:00 PM] Deciusmus: I think it is best to only populate "key" fields as blank.
[2023-01-13 02:01 PM] Deciusmus: I dont think we need name as distinct from title btw
[2023-01-13 02:01 PM] Deciusmus: do we really need to set the name for an Inn or something?
[2023-01-13 02:01 PM] Deciusmus: I guess maybe
[2023-01-13 02:01 PM] Deciusmus: actually, I guess it is a good idea
[2023-01-13 02:04 PM] Deciusmus: For now I'm going to setup the metadata stuff to add anything that is flagged as core in your file but not the optional
[2023-01-13 02:06 PM] Deciusmus: I think a few of the not-impl would be sensible to be core:
    
    * Whereabouts if the default is just populated from home seems reasonable to have for all npcs. the scripting could ignore the location block if whereabouts == home
    * family (for rulers and npcs) although often not set seems worth having in the yaml as it could frequently be set
[2023-01-13 02:09 PM] rsulfuratus: in the not-yet-implemented list, I would include as core whereabouts and family as you mention, and also:
    - location, locationRegion for buildings and places
    - player, campaign for PCs
    
    I am not sure if Item headers will ultimately be that useful, but if you are including them
[2023-01-13 02:09 PM] rsulfuratus: - currentOwner
    - ddbLink
[2023-01-13 02:12 PM] rsulfuratus: That would give you the minimal amount of stuff to generate some initial headers for places, pcs, buildings, and items and see what is useful.
    
    places would be just location/locationRegion stuff; unless we separate out Places and Settlements population is too tricky I think
    
    PCs would be kinda like NPCs but without any location information and with player/campaign information
    
    items would be ddbLink, owner, and created/destroyed if those exist. I think maker is so rarely known/invented that it is probably not worth it for now
[2023-01-13 02:13 PM] rsulfuratus: I would also consider setting default tags to : type/unsorted if no tags exist
[2023-01-13 02:14 PM] rsulfuratus: probably with Ruler as NPC/unsorted instead of Ruler/unsorted. possibly not bothering for places/buildings. possibly setting PCs to PC/campaign instead of PC/unsorted
[2023-01-13 02:17 PM] Deciusmus: for tags I was basically thinking:
    
    NPC/unsorted
    PC/campaign
[2023-01-13 02:17 PM] Deciusmus: oh, and session notes should be a type
[2023-01-13 02:17 PM] Deciusmus: a session note header with real and game dates would be nice
[2023-01-13 02:17 PM] Deciusmus: fc-date and fc-end are used by fantasy calendar
[2023-01-13 02:18 PM] Deciusmus: so are good to use for the dates of events
[2023-01-13 02:18 PM] Deciusmus: `*`dates of recent/in-game events
[2023-01-13 02:18 PM] Deciusmus: here's my session note frontmatter:
    
    ```
    fc-calendar: Taelgar Calendar
    fc-date: 1719-10-19
    fc-end: 1719-10-21
    fc-category: Cleenseau Campaign
    real-date: 2023-01-08
    tags: `[session-note, cleenseau-campaign]`
    ```
[2023-01-13 02:18 PM] rsulfuratus: yeah session notes as a type would be great
[2023-01-13 02:19 PM] Deciusmus: I might change real-date to realDate (but can't change the fc-xxx)
[2023-01-13 02:19 PM] Deciusmus: and add a campaign tag
[2023-01-13 02:19 PM] rsulfuratus: I was playing around with that a bit
[2023-01-13 02:20 PM] Deciusmus: I mean, I have the advantage of not porting anything from old fomrats
[2023-01-13 02:20 PM] Deciusmus: but I found that breaking stuff up into small events and then tagging dates is really nice
[2023-01-13 02:20 PM] Deciusmus: so for example I have:
![[../_discord_assets/image-B6005.png]]
[2023-01-13 02:21 PM] Deciusmus: each of those events are tagged with an fc-date and so show up on my calendar
[2023-01-13 02:21 PM] rsulfuratus: yeah I saw that
[2023-01-13 02:21 PM] Deciusmus: I also have a  Background Events folder that is not published to web
[2023-01-13 02:21 PM] rsulfuratus: it is a lot of work to go back and do that for 63 sessions worth of material
[2023-01-13 02:21 PM] Deciusmus: It is almost certainly not worthwhile
[2023-01-13 02:21 PM] Deciusmus: I was going to say I also have a Background Events with stuff that is happening that the PCs dont know about
[2023-01-13 02:21 PM] Deciusmus: that I don't publish to the web
[2023-01-13 02:22 PM] Deciusmus: but that way if say I know that bandits will attack the town in 5 days I can see it in my calendar
[2023-01-13 02:22 PM] Deciusmus: so it makes keeping track of what is going on in game much easier because I can just look at the fantasy calendar in play
[2023-01-13 02:23 PM] rsulfuratus: yeah, I have a massive onenote table that has both historical and future events and also npc movements, campaign events, misc other things happening in the world.
[2023-01-13 02:23 PM] rsulfuratus: one of the things that got me looking at obsidian in the first place was how utterly annoying that is
[2023-01-13 02:24 PM] Deciusmus: Right. Using the fantasy calendar and fc-xxx tags works really well for the small number of events i have so far
[2023-01-13 02:24 PM] rsulfuratus: yeah it would be way better but going back to make a note for each day etc is time consuming
[2023-01-13 02:25 PM] rsulfuratus: although actually since it is just markdown if I could get my onenote spreadsheet into csv I could write a short python program that would auto-generate a note for each date in the csv file
[2023-01-13 02:25 PM] rsulfuratus: hmmm
[2023-01-13 02:27 PM] rsulfuratus: I assume fantasy calendar is automatically creating events from frontmatter?
[2023-01-13 02:27 PM] Deciusmus: I was thinking it actually be pretty easy to write a script to parse Friday, Jan 8th, 2021; in Taelgar, evening April 15th through morning April 16th)
[2023-01-13 02:27 PM] Deciusmus: You have to turn it on in settings
[2023-01-13 02:27 PM] rsulfuratus: yeah I could do that too
[2023-01-13 02:28 PM] Deciusmus: But if you turn it on it will do it
[2023-01-13 02:34 PM] rsulfuratus: btw renamed all my session notes to Session NUM (DuFr) so shouldn't have link collisions
[2023-01-13 02:54 PM] Deciusmus: cool
[2023-01-13 08:17 PM] Deciusmus: Productive flight. I’ll try to push something later. Basically implemented everything we talked about earlier. Just missing some prompting stuff

