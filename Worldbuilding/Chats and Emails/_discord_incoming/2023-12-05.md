# Discord DM – 2023-12-05

[2023-12-05 07:55 AM] rsulfuratus: pushed a bunch of bugfixes last night. have another busy day today so might not do much, but I don't feel any particular ownership over any remaining bugs so fix whatever you want if you feel like it.
[2023-12-05 07:55 AM] rsulfuratus: I also moved the get party meeting stuff to a new EventManager class, in preparation for thinking about event-style metadata a bit more, but probably won't do much on that front for a while
[2023-12-05 07:56 AM] rsulfuratus: probably still a few lingering bugs as I test more pages, will add more possibly buggy pages to the PR comments as I find them
[2023-12-05 10:46 AM] Deciusmus: I pushed fixes for those bugs
[2023-12-05 11:10 AM] Deciusmus: A few other things:
    
    1. We should tweak some of the default text to better take advantage of these features, but I would wait for that to merge
    2. There is still an issue with link text in chains. If you make the place - place link text = "", then you get
![[../_discord_assets/image-B2799.png]]
[2023-12-05 11:10 AM] Deciusmus: but if you make it "in" you get:
![[../_discord_assets/image-8A331.png]]
[2023-12-05 11:23 AM] Deciusmus: Also messing around a bit the "r" filter is fiddly
[2023-12-05 11:24 AM] Deciusmus: it would probably be nicer if "r" meant "don't show regions except the first one"
[2023-12-05 11:27 AM] Deciusmus: For example, Wave Dancer in 1720 shows
    
    Last known location: (empty)
    
    Because the default filter is r, and the last known location is Eastern Green Sea.
    
    It can be fixed with
![[../_discord_assets/image-AC5E6.png]]
[2023-12-05 11:27 AM] Deciusmus: but it seems annoying to have to set the startFilter on every region location
[2023-12-05 11:28 AM] Deciusmus: and sometimes it gets fiddly, i.e. on Akan, you don't want to see the whole chain (plains north east of Kawara, Eastern Dunmar, Dunmar, Central Lowlands...)
[2023-12-05 11:30 AM] Deciusmus: another option would be to have f mean "always show first"
[2023-12-05 11:30 AM] Deciusmus: sorry, F
[2023-12-05 11:30 AM] Deciusmus: f = only first
    F = always first
[2023-12-05 11:31 AM] Deciusmus: i.e. so Fr shows the first even if it is a region
[2023-12-05 11:31 AM] rsulfuratus: with regions specifically, another option would be to just be a little more judicious about "region" as opposed to "subregion" or something else
[2023-12-05 11:31 AM] Deciusmus: true
[2023-12-05 11:31 AM] Deciusmus: although that doesn't help the "Eastern Green Sea" wave dancer example
[2023-12-05 11:32 AM] rsulfuratus: F as skip first is a little pointless with the slice now, though, so it might be useful to repurpose
[2023-12-05 11:33 AM] Deciusmus: yeah, that is what I was thinking
[2023-12-05 11:37 AM] rsulfuratus: I just got out of a meeting and have 20 minutes, I'm going to check a few more pages but I think we could probably merge at this point if there are no more obvious bugs
[2023-12-05 11:37 AM] Deciusmus: yeah, I just did the same
[2023-12-05 11:39 AM] Deciusmus: I have a few page fixes to push but no code fixes
[2023-12-05 11:40 AM] Deciusmus: Is there a reason Apolloyon had:
    
    ```
     whereabouts:
     - {type: home, end: 1059, location: Drankor}
    -- {type: away, start: 1053}
     - {type: away, start: 1060}
    ```
[2023-12-05 11:41 AM] rsulfuratus: I wanted the created location for the Scepter of Command to be unknown
[2023-12-05 11:41 AM] Deciusmus: it causes the Scepter of Command to lose the "in Drankor"
[2023-12-05 11:41 AM] Deciusmus: ha, ok
[2023-12-05 11:41 AM] Deciusmus: that was the main reason Scepter of COmmand was on the test case pag
[2023-12-05 11:41 AM] Deciusmus: so I was checking for tha
[2023-12-05 11:42 AM] rsulfuratus: yeah the test case files need a bit of cleanup some of them are probably not needed
[2023-12-05 11:42 AM] Deciusmus: Cloak of Rainbows covers the case
[2023-12-05 11:42 AM] Deciusmus: (i.e. an item created by someone who's past location was known but current isn't)
[2023-12-05 11:45 AM] rsulfuratus: oh, that reminds me. The Chalice of the Runepriest is in the test case to remind that we should ideally find a solution to the blank case demonstrated by the chalice where having no pageDated of affiliations output causes this weird gap between (unique chalice) and the whereabouts
[2023-12-05 11:46 AM] Deciusmus: I was planning on getting rid of the individual "get_xxxx" and instead just having a single "output header box contents"
[2023-12-05 11:47 AM] Deciusmus: at some point
[2023-12-05 11:47 AM] rsulfuratus: yeah that would be better
[2023-12-05 11:47 AM] rsulfuratus: but doesn't need to happen for this pr
[2023-12-05 11:48 AM] Deciusmus: no, definitely not
[2023-12-05 11:48 AM] rsulfuratus: oh one other thing - the various merges means we have getPartyMeeting in both whereabouts and the new EventManager class
[2023-12-05 11:48 AM] Deciusmus: I pushed a bunch of fixes to individual pages, mostly setting displayDefaults like linkText that were wrong (i.e. Dunmar Fellowship should be "by" not "with")
[2023-12-05 11:48 AM] Deciusmus: once this PR merges I'm going to delete all the unused code
[2023-12-05 11:49 AM] Deciusmus: Also your casing change is not quite right
[2023-12-05 11:49 AM] Deciusmus: its fine to merge but it isn't going to do the right thing if you want say "initial upper"
[2023-12-05 11:49 AM] Deciusmus: it will generate:
    
    The prefix of Place
[2023-12-05 11:49 AM] Deciusmus: rather than
    The prefix of place
[2023-12-05 11:50 AM] Deciusmus: For title case it works fine, because title case is the same regardless
[2023-12-05 11:50 AM] rsulfuratus: what does the current code generate for that case?
[2023-12-05 11:51 AM] Deciusmus: the prefix is uncased
[2023-12-05 11:51 AM] rsulfuratus: I think: "the prefix of Place"?
[2023-12-05 11:51 AM] Deciusmus: yeah
[2023-12-05 11:51 AM] Deciusmus: well, depends
[2023-12-05 11:51 AM] rsulfuratus: that was the case I was trying to fix, "part of The Great War" annoyed me
[2023-12-05 11:52 AM] Deciusmus: I mean the easy fix is change the prefix to Part of
[2023-12-05 11:52 AM] rsulfuratus: but ideally it should be "Part of the Great War" not "Part of The Great War"
[2023-12-05 11:52 AM] rsulfuratus: but then you get "A battle, Part of the Great War"
[2023-12-05 11:52 AM] rsulfuratus: (if you have `<subtypeof(,)>` `<(part of)partof:u>`)
[2023-12-05 11:52 AM] Deciusmus: the right fix is to have the prefix and suffix passed into name manager
[2023-12-05 11:53 AM] Deciusmus: the prefix is basically link text
[2023-12-05 11:53 AM] rsulfuratus: but not everything with a prefix is a name
[2023-12-05 11:53 AM] rsulfuratus: but yeah that is probably generally better
[2023-12-05 11:54 AM] Deciusmus: but everything that should support casing format strings should either go through the casing formatter or the name formatter
[2023-12-05 11:54 AM] rsulfuratus: right, that's true
[2023-12-05 11:54 AM] Deciusmus: i.e. the simplest fix would be to just change :
    
    ```    #getFormattedCaseString(value, token) {
            // this is something that can never be meaningfully linked
            // and never has an article
            // but which might need casing rules
    
            const { NameManager } = customJS;
    
            // this probably just returns itself, but...
            let name = { name: value, linkText: "", indefiniteArticle: "", definiteArticle: "", linkTarget: undefined }
    
            return NameManager.formatName(name, token.format)
        }
    ```
[2023-12-05 11:54 AM] Deciusmus: so set linkText to token.prefix
[2023-12-05 11:55 AM] Deciusmus: (suffix doesn't work, but usually suffixes don't have casing rules)
[2023-12-05 11:56 AM] Deciusmus: it would be pretty easy to change name manager to take a suffix as well
[2023-12-05 11:56 AM] Deciusmus: but actually ignore that
[2023-12-05 11:57 AM] Deciusmus: you'd have to set linktext to prefix and add "q" to the format string
[2023-12-05 11:57 AM] Deciusmus: its probably better for name manager to have an explicit prefix and suffix
[2023-12-05 11:57 AM] rsulfuratus: I'm going to leave it for now
[2023-12-05 11:57 AM] Deciusmus: anyway the fix you have for right now is fine
[2023-12-05 11:57 AM] Deciusmus: it isn't like subtle casing bugs are a big deal
[2023-12-05 11:58 AM] rsulfuratus: having the initial lowercase annoys me a lot more than a extra capitalized The before a placename
[2023-12-05 11:59 AM] rsulfuratus: I am merging the PR now, then will be busy most of the rest of the afternoon
[2023-12-05 12:01 PM] rsulfuratus: we have a lot of stale branches, unless you object I'm going to delete everything except new-whereabouts, which might still have some unmerged bugfixes; can also leave feature/families-and-kingdoms if it has anything you want
[2023-12-05 12:03 PM] Deciusmus: you can delete familes and kingdoms
[2023-12-05 12:04 PM] Deciusmus: I have a meeting @ 1, but depending on whether I feel like doing code reviews for work or not, might work on this a bit
[2023-12-05 12:04 PM] Deciusmus: I'm going to implement the F rule and change defaults
[2023-12-05 12:04 PM] rsulfuratus: sounds great
[2023-12-05 12:04 PM] Deciusmus: to include F
[2023-12-05 01:56 PM] rsulfuratus: we are building a new website for my lab and currently discussing an auto-generated "About" page with little image boxes for each person with autogenerated summary text based on a yaml or json object.....probably not going to suggest we just use my existing javascript token parser but....
[2023-12-05 01:58 PM] rsulfuratus: on the other hand, maybe I can steal the code one of my staff is writing to auto-generate html snippets to make like "People of X" pages with clickable images for taelgarverse
[2023-12-05 02:36 PM] Deciusmus: I'd love the ability to have
    image: blah.png
    
    in the frontmatter
    
    and have that generate a nice little box
[2023-12-05 02:37 PM] Deciusmus: dataview can insert HTML
[2023-12-05 03:20 PM] rsulfuratus: https://obsidian-publisher.netlify.app/plugin/
[2023-12-05 03:21 PM] rsulfuratus: I'm not sure if this actually works but claims to support dataview
[2023-12-05 03:21 PM] Deciusmus: I looked at it
[2023-12-05 03:21 PM] Deciusmus: It runs within obisidian
[2023-12-05 03:21 PM] Deciusmus: it works by using the obsidian "renderashtml" api to render each page as html, so the output looks exactly like your vault looks
[2023-12-05 03:30 PM] rsulfuratus: we are using material for mkdocs for my group website and it has a lot of flexibility that our current setup doesn't have, and makes a much nicer website. so I think my preference is not to rely on the obsidian html renderer which gives up a ton of control
[2023-12-05 03:31 PM] Deciusmus: yeah, I agree
[2023-12-05 03:31 PM] rsulfuratus: but i'm not interested in writing the code to convert obsidian markdown to mkdocs markdown
[2023-12-05 03:31 PM] rsulfuratus: so hoping to find something that can do that and replace obsidianhtml
[2023-12-05 03:31 PM] rsulfuratus: anything dynamic we want rendered on the website would rely on using an export-style dataview command to push static content to the export version of the vault
[2023-12-05 03:32 PM] rsulfuratus: which I think is probably fine
[2023-12-05 03:33 PM] Deciusmus: yes. It is quite easy to do that, via dv.markdownTable
[2023-12-05 03:34 PM] Deciusmus: it is a bit of a pain if you want arbitrary dataview
[2023-12-05 03:34 PM] Deciusmus: but in general, I think 95% of the use cases is going to be very specific types of queries that are build in javascript anyway
[2023-12-05 03:34 PM] Deciusmus: i.e. an events table
[2023-12-05 03:34 PM] rsulfuratus: right
[2023-12-05 03:34 PM] Deciusmus: why not just use the md ->` md parts of obsidian html?
[2023-12-05 03:35 PM] Deciusmus: or does it convert straight to html?
[2023-12-05 03:35 PM] rsulfuratus: it does run some markdown cleaning to convert things like wikilinks but the code is a bit squirelly and is a bit of a kludge
[2023-12-05 03:35 PM] rsulfuratus: plus no longer maintained
[2023-12-05 03:36 PM] rsulfuratus: I'd prefer something I understand enough that I can fork it and keep it running if needed
[2023-12-05 03:37 PM] rsulfuratus: it also converts the wrong things - it is actually fairly easy to support wikilinks in mkdocs, for example, so converting links is not needed. but stripping code blocks is nice, which obsdianhtml doesn't do
[2023-12-05 03:38 PM] Deciusmus: can't mkdocs strip codeblocks?
[2023-12-05 03:38 PM] rsulfuratus: yeah it should be able to
[2023-12-05 03:39 PM] rsulfuratus: it actually may not require any conversion to use obsidian straight with mkdocs with the right plugins
[2023-12-05 03:39 PM] Deciusmus: When I researched this a while ago, a lot of people were using the tools of their prefered markdown ->` html toolchain, rather than something for obsidian specifically
[2023-12-05 03:39 PM] rsulfuratus: right
[2023-12-05 03:39 PM] Deciusmus: I was looking at someone's workflow that used jekyll
[2023-12-05 03:40 PM] Deciusmus: and they got leaflet and mermaid codeblocks to work by just having jekyll plugins that converted the obsidian codeblocks to jekyll codeblocks
[2023-12-05 04:03 PM] Deciusmus: Here's a separate question.... part of chains...
    
    I think we should redefine part of to mean:
    
    * a chain of like-typed things that this thing is part of
    
    so organizations can be part of other organizations 
    items can be part of other items
    but organizations cant be part of places
[2023-12-05 04:04 PM] Deciusmus: events can be part of other events
[2023-12-05 04:04 PM] Deciusmus: etc
[2023-12-05 04:04 PM] Deciusmus: Once we have fully removed partOf: to mean whereabout: in places, it might be interesting to see if it would be useful to allow a place to be "part of" a place and use that to define politcal relationships
[2023-12-05 04:05 PM] Deciusmus: but at the moment I was thinking about cleaning up how part of chains are parsed as it is the last "hacky" thing
[2023-12-05 05:26 PM] rsulfuratus: yeah i think that makes sense
[2023-12-05 05:27 PM] rsulfuratus: to use partOf as political affiliations we'd need to allow them to be dated, I think
[2023-12-05 05:30 PM] rsulfuratus: I actually think the concept of places might benefit from being informally separated into:
    - structures / settlements / etc
    - geographic locations
    - political units
[2023-12-05 05:30 PM] rsulfuratus: they are all places, and I don't think it is worth defining them strictly
[2023-12-05 05:31 PM] rsulfuratus: but for example it might be nice to have Guildhome (ward) be partOf Tollen
[2023-12-05 05:33 PM] rsulfuratus: it would allow something like a general page on Tollender culture separate from the city of Tollen, and then both Tollen and Western Cymea could be partOf the "Tollender" page
[2023-12-05 05:33 PM] rsulfuratus: but a person in a city in western Cymea wouldn't show up as "Currently in the Palanca Hills, Western Cymea, Tollen" which doesn't make sense
[2023-12-05 05:36 PM] rsulfuratus: I think it would also be useful to implement a "with" whereabout type and also expect that "home" and "away" can only be locations. you can be "with" a person or an organization or an item
[2023-12-05 05:39 PM] rsulfuratus: if I start working on anything soon, it will probably be events and dates. with the token parser it would be really easy to just normalize all dates as "days since time began" internally and then we can have a dr vs cy formatter token
[2023-12-05 05:41 PM] rsulfuratus: i'd also like to convert all elven born dates to just ka, and then parse a table to get CY year each ka started to calculate ages
[2023-12-05 05:42 PM] rsulfuratus: it would be a little complicated to figure out the input, but it might just be worth having any date be able to be in an object representation as well, and the default conversion be dr. but if you want an elf with 
    `born: { date: 26, unit: ka }`
    you can
[2023-12-05 05:43 PM] rsulfuratus: but `born: 1712` still works find because it defaults to DR
[2023-12-05 05:44 PM] rsulfuratus: my main hesitation is that it messes up dataview queries and forces dataviewjs because any date-based metadata needs to be run through normalizeDate
[2023-12-05 05:49 PM] Deciusmus: I am cleaning up dates now in prep for that
[2023-12-05 05:51 PM] Deciusmus: true. I think the basic goal at the moment is to get clean partOf for orgs and items (if you wanted phase stone: partof vindistrjarna, i.e.) and events. Then do some data quality cleanup to get rid of old partOf for places and move them to whereabouts, then see what might be useful
[2023-12-05 06:29 PM] Deciusmus: it is much easier to work with dates in taelgar than the real world
[2023-12-05 07:21 PM] rsulfuratus: I mostly have to do work tonight, but I might start messing around with date conversions. i don't necessarily want to figure out what the final normalized date structure should be or anything like that. my initial goal would be to write a set of functions that take an integer (in days since time began) and return a formatted string in ka/dwarven/DR and possibly other formats
[2023-12-05 07:23 PM] rsulfuratus: i might also mess around with the reverse, taking the string representation of a DR or CY date (e.g., YYYY-MM-DD), or a integer ka, and converting to days since time began
[2023-12-05 07:23 PM] rsulfuratus: i am going to start a feature/date-conversion branch
[2023-12-05 07:23 PM] rsulfuratus: but not sure if i'll do much of this tonight as I do have a few hours of real work to do
[2023-12-05 07:25 PM] Deciusmus: I did about half of this already
[2023-12-05 07:26 PM] rsulfuratus: I'm actually more interested in formalizing / canonizing the calendar systems themselves than the coding. actually not totally straightforward since years don't line up
[2023-12-05 07:30 PM] rsulfuratus: did you push that anywhere?
[2023-12-05 07:32 PM] Deciusmus: no, i went to eat dinner
[2023-12-05 07:34 PM] Deciusmus: just pushed to  feature/date-refactor
[2023-12-05 07:44 PM] Deciusmus: This is the part I did. My actual goal is to be able to show ages as something less than a year if needed
[2023-12-05 07:47 PM] Deciusmus: So i was starting with the idea that a date in a taelgar is just a number of days since creation
[2023-12-05 08:38 PM] rsulfuratus: added a CY export
[2023-12-05 08:43 PM] rsulfuratus: still double-checking calculations
[2023-12-05 08:44 PM] Deciusmus: I just pushed a fix to the "figure out the month" logic
[2023-12-05 08:44 PM] Deciusmus: last days of month didn't work
[2023-12-05 08:44 PM] Deciusmus: i.e. the last day of nov is 11/30 not 12/0
[2023-12-05 08:44 PM] Deciusmus: but also it doesn't seem to be calculating correctly on actual pages but haven't looked into why
[2023-12-05 08:45 PM] rsulfuratus: I'm just checking conversion math with jsfiddle.net
[2023-12-05 08:48 PM] rsulfuratus: you still have a day 0 issue, 365 days after creation is 1/0/2 not 12/31/1
[2023-12-05 08:51 PM] Deciusmus: if you want to test in obsidian, btw, this is the easiest way:
    
    ```dataviewjs
    const {DateManager} = customJS
    
    dv.paragraph(DateManager.normalizeDate(dv.current().born))
    ```
[2023-12-05 08:51 PM] Deciusmus: on some random page
[2023-12-05 08:53 PM] rsulfuratus: I think the issue is only with how years turn over
[2023-12-05 08:54 PM] rsulfuratus: 364 days after creation is 12/30/1
[2023-12-05 08:54 PM] rsulfuratus: 365 is 1/0/2
[2023-12-05 08:55 PM] Deciusmus: right, its this
    
            let year = Math.floor(convertedDays / 365) + 1
[2023-12-05 08:55 PM] rsulfuratus: but DR`<->`CY conversion seems to work
[2023-12-05 08:55 PM] Deciusmus: because 365/365 generates 1 not 0
[2023-12-05 08:55 PM] Deciusmus: I need use math.ceiling
[2023-12-05 08:55 PM] Deciusmus: and not add the one
[2023-12-05 08:55 PM] rsulfuratus: e.g. 3/17/1748 DR is 1/1/5881 CY which is correct
[2023-12-05 08:56 PM] rsulfuratus: yeah that fixes it
[2023-12-05 08:58 PM] Deciusmus: I pushed a fix
[2023-12-05 08:58 PM] Deciusmus: also fixed a stupid case missing a break, so now it sems to be working
[2023-12-05 08:58 PM] Deciusmus: except now that I got rid of all jsDates, ages are calculated in days
[2023-12-05 08:59 PM] Deciusmus: but that's what I wanted an age formatter in token parser
[2023-12-05 09:00 PM] rsulfuratus: right. i'd default to years if days >` 365*2, months otherwise
[2023-12-05 09:01 PM] rsulfuratus: hmm actually if the age difference is exactly 365 days that probably means DR_start == DR_end
[2023-12-05 09:02 PM] Deciusmus: I'd save that for approximate dates
[2023-12-05 09:02 PM] Deciusmus: and the moment I was going to do exactly what you say
[2023-12-05 09:02 PM] rsulfuratus: yeah makes sense
[2023-12-05 09:02 PM] Deciusmus: but where months = 30 day units
[2023-12-05 09:09 PM] rsulfuratus: I think dwarves should have 10 months of 35 days each (divided into 5 weeks of 7 days each)
[2023-12-05 09:10 PM] rsulfuratus: then, three 5-day intercalary "months"
[2023-12-05 09:11 PM] rsulfuratus: or maybe 5 3-day
[2023-12-05 09:11 PM] rsulfuratus: actually five 3-day intercalary periods is better. between every other month you have a 3-day transition
[2023-12-05 09:12 PM] Deciusmus: sounds reasonable
[2023-12-05 09:12 PM] Deciusmus: the age calculation is annoying. If you have bare years, it is one day off
[2023-12-05 09:12 PM] rsulfuratus: so the whole thing is super regular. The first day of the year is also always the same day of the week because you have exactly 35 weeks in a year
[2023-12-05 09:14 PM] rsulfuratus: you should probably only ever pass it normalized strings, no? 1748-01-01 is correct
[2023-12-05 09:14 PM] rsulfuratus: as far as I can tell anyway
[2023-12-05 09:15 PM] rsulfuratus: just set day = 1 if not day
[2023-12-05 09:15 PM] rsulfuratus: in getDaysSinceCreation
[2023-12-05 09:16 PM] rsulfuratus: if you just give it a year you are missing one from `days += ((year - 1) * 365) + day`
[2023-12-05 09:16 PM] Deciusmus: no, I think the issue in the age calculation
[2023-12-05 09:17 PM] Deciusmus: rather, there were 2 bugs
[2023-12-05 09:17 PM] Deciusmus: 1) I wasn't respecting the isEnd logic for bare dates, i.e. born: 1714
[2023-12-05 09:18 PM] Deciusmus: that I just pushed a fix for
[2023-12-05 09:18 PM] Deciusmus: BTW, I like dwarven year being super regular
[2023-12-05 09:18 PM] Deciusmus: but no real opinions on the actual structure
[2023-12-05 09:23 PM] Deciusmus: The issue with age is that:
    (a) bare years for born get 1-1-year and for died get 12-31-year
    (b) someone born on Jan 1st 1000 who died on Dec 31st 1002 was in fact only 1 year and 364 days old
    (c) but it seems a bit annoying to show their age as 23 months rather than 2 years
[2023-12-05 09:24 PM] rsulfuratus: just round up instead of down for months and convert to years once you hit 24 months
[2023-12-05 09:25 PM] rsulfuratus: days/(365/12) = months
[2023-12-05 09:26 PM] rsulfuratus: or like Math.ceil(days/(365/12))
[2023-12-05 09:27 PM] rsulfuratus: then if >`24, Math.round(months/12)
[2023-12-05 09:27 PM] rsulfuratus: >`= 24
[2023-12-05 09:28 PM] Deciusmus: yeah, but then you get the wrong value if you have exact dates
[2023-12-05 09:29 PM] rsulfuratus: but do you really care if you display 23 months as 2 years?
[2023-12-05 09:30 PM] Deciusmus: no, nevermnd
[2023-12-05 09:34 PM] Deciusmus: it all works fine
[2023-12-05 09:35 PM] Deciusmus: the actual issue is that I needed to divide by 30.4 not 30
[2023-12-05 09:35 PM] Deciusmus: i.e. 
    return Math.floor(value/30.4) + " months"
[2023-12-05 09:36 PM] Deciusmus: any opinion on what it should show if the age is actually exactly 0?
[2023-12-05 09:37 PM] rsulfuratus: if you are dividing by a float anyway why not just 365/12?
[2023-12-05 09:37 PM] Deciusmus: yeah that's what you suggested actually and works fine
[2023-12-05 09:37 PM] rsulfuratus: if age is exactly 0 I would not display it
[2023-12-05 09:38 PM] rsulfuratus: that implies something that has a start date specified to the day and either no end or end on the same day
[2023-12-05 09:39 PM] Deciusmus: yeah, it looks a bit weird
[2023-12-05 09:39 PM] Deciusmus: 
![[../_discord_assets/image-AA150.png]]
[2023-12-05 09:40 PM] rsulfuratus: probably not worth worrying about honestly, there probably isn't anything that actually has an age of 0
[2023-12-05 09:41 PM] rsulfuratus: maybe round it up to "1 day"
[2023-12-05 09:42 PM] Deciusmus: the main case would be if we ever did something like show how long someone was at a stop
[2023-12-05 09:42 PM] rsulfuratus: right, in that case you want to round up to 1 day
[2023-12-05 09:42 PM] rsulfuratus: so that is probably a good default and anything else can wait for approx date formatting
[2023-12-05 09:42 PM] Deciusmus: yeah
[2023-12-05 09:43 PM] Deciusmus: any opinions on whether there should be format strings for dates?
[2023-12-05 09:43 PM] Deciusmus: I mean, for ages
[2023-12-05 09:43 PM] Deciusmus: haven't gotten to dates
[2023-12-05 09:43 PM] rsulfuratus: for exact ages, no
[2023-12-05 09:44 PM] rsulfuratus: or, at least not right now until we think of a need
[2023-12-05 09:44 PM] Deciusmus: ok, all that is pushed
[2023-12-05 09:44 PM] rsulfuratus: for dates, I definitely would like a "force year only"
[2023-12-05 09:44 PM] Deciusmus: it seems to work pretty well
[2023-12-05 09:46 PM] rsulfuratus: should be pretty easy to have a CY/DR for dates too, although it will get complicated the more display options we have
[2023-12-05 09:48 PM] Deciusmus: btw any objections to me mergint those 2 prs
[2023-12-05 09:48 PM] rsulfuratus: no, that's fine
[2023-12-05 09:49 PM] rsulfuratus: although did you push any changes to the name formatter on #27?
[2023-12-05 09:49 PM] rsulfuratus: it looks like you just parse `k` but don't do anything with it
[2023-12-05 09:49 PM] rsulfuratus: or is that the point I guess
[2023-12-05 09:49 PM] Deciusmus: correct
[2023-12-05 09:49 PM] Deciusmus: that is the point
[2023-12-05 09:50 PM] Deciusmus: I was just finding it hard to read:
    
    ````<partof:;t>````
    
    to get title case for the first item but not the rest
[2023-12-05 09:50 PM] Deciusmus: ````<partof:k;t>```` is a lot nicer
[2023-12-05 09:50 PM] rsulfuratus: right
[2023-12-05 09:51 PM] rsulfuratus: I guess I was thinking in context of names you usually have `<name:q;t>` or something
[2023-12-05 09:51 PM] rsulfuratus: but partof doesn't have any natural format you would usually apply
[2023-12-05 09:51 PM] Deciusmus: right, that is where it came up
[2023-12-05 09:51 PM] rsulfuratus: or `<name:q;Q>` for origin
[2023-12-05 09:52 PM] rsulfuratus: although with this change you could also just do `<name:q;>` for origin since blank (but not null) firstFormat is retained
[2023-12-05 09:52 PM] Deciusmus: yes
[2023-12-05 09:55 PM] Deciusmus: D K C and Y are all free. I'd suggest date formats are:
    
    Y = year only
    D = DR
    C = CY
    K = (future) ka
[2023-12-05 09:55 PM] Deciusmus: default is D
[2023-12-05 09:55 PM] rsulfuratus: I was actually thinking it might be worth something like {DR}, {CY}, {KA}, etc
[2023-12-05 09:56 PM] rsulfuratus: just because I'd like to output Dunmari events in dynastic years, for example
[2023-12-05 09:56 PM] Deciusmus: right
[2023-12-05 09:56 PM] Deciusmus: that makes sense
[2023-12-05 09:57 PM] rsulfuratus: shouldn't be too bad to parse something like that
[2023-12-05 09:57 PM] Deciusmus: the suggestion is that {any letters} = valid format string but not filter?
[2023-12-05 09:57 PM] rsulfuratus: yeah
[2023-12-05 09:57 PM] rsulfuratus: you'd want to split it out of the filterformat string before splitting on `;` I think
[2023-12-05 09:59 PM] rsulfuratus: but that is relatively easy regex parsing
[2023-12-05 10:01 PM] rsulfuratus: I don't think there is every a case where it makes sense for date formats to separately apply to parts of a chain
[2023-12-05 10:01 PM] Deciusmus: sure, and anyway, we don't have date chains
[2023-12-05 10:01 PM] rsulfuratus: to simplify the filter checkers in other functions I'd pull date formats specifically into token.dateFormat and remove them
[2023-12-05 10:02 PM] rsulfuratus: so they aren't part of format strings and name formatter doesn't have to worry about letters in {}
[2023-12-05 10:02 PM] rsulfuratus: `*`format checkers
[2023-12-05 10:03 PM] rsulfuratus: perhaps you could just directly pass token.dateFormat to the date display function
[2023-12-05 10:04 PM] Deciusmus: one way to think of this is that we currently have 4 data formats:
    
    * lists (whereabouts, part of, affliations)
    * names + other name like strings
    * age
    * dates
    
    (plus untyped/unformatable raw strings)
[2023-12-05 10:04 PM] rsulfuratus: FWIW one could image date chains in events, e.g. died during the battle of urlich pass during the Great War
[2023-12-05 10:04 PM] rsulfuratus: although perhaps that is more of a partOf chain than a date chain
[2023-12-05 10:04 PM] Deciusmus: that is a part of chain
[2023-12-05 10:05 PM] Deciusmus: you could do that almost trivially right now by just changing the partOf to be a type like { parent: xxx, format: yyy } and then passing the entire metadata of the file as part of the returned partOf object
[2023-12-05 10:05 PM] Deciusmus: in fact it would already work
[2023-12-05 10:06 PM] Deciusmus: because the token parser does this
    
        results.push(this.formatDisplayString(item.format ?? "`<name:" + formatStr + ">`", {}, targetDate, item))
[2023-12-05 10:06 PM] Deciusmus: for all list-types
[2023-12-05 10:06 PM] Deciusmus: so if the partOf code returned an the full metadata + a format object, you could set the format of a line to include a date
[2023-12-05 10:07 PM] Deciusmus: but of course, I'm not sure if that makes sense, as you probably would want to decide the format string from the source
[2023-12-05 10:07 PM] Deciusmus: anyway, not going to fiddle now
[2023-12-05 10:08 PM] Deciusmus: What I was going to suggest is that there is an argument that the token format should be parsed by the type that is using it
[2023-12-05 10:09 PM] rsulfuratus: could be something to think about. it does get a lot harder to remember though
[2023-12-05 10:10 PM] rsulfuratus: we could get more tokens if we required a;b;c to be a = format, b=firstformat c=filter or something
[2023-12-05 10:10 PM] rsulfuratus: or a|b;c where |b is optional
[2023-12-05 10:12 PM] rsulfuratus: eventually we'll run out of separators but the filter/format string only techincally has to avoid ():`<>` and space
[2023-12-05 10:12 PM] Deciusmus: any reason not to merge the date stuff?
[2023-12-05 10:13 PM] Deciusmus: are you working on dwarven calendar?
[2023-12-05 10:13 PM] Deciusmus: the refactor to days seems pretty stable
[2023-12-05 10:13 PM] rsulfuratus: no I'm working on tracking down where all the people who have left my group in the past 5 years ended up for an "alumni" page
[2023-12-05 10:13 PM] rsulfuratus: go ahead and merge
[2023-12-05 10:14 PM] rsulfuratus: can change dwarven calendar export later, just need to have a different month function
[2023-12-05 10:38 PM] Deciusmus: I'm about to go to bed, I was just cleaning up my name manager suffix/prefix stuff
[2023-12-05 10:38 PM] rsulfuratus: i'm going to add a (somewhat messy for now) dwarven calendar export
[2023-12-05 10:38 PM] rsulfuratus: it is much easier than DR since the number of days in the month doesn't matter
[2023-12-05 10:38 PM] rsulfuratus: it won't be formatted because it doesn't have the fantasy calendar formatter
[2023-12-05 10:39 PM] Deciusmus: One question...
    What do you expect this to generate : ````<(part of )partof:t>````
    
    Given a part of chain like: 
    The Battle of Something ->` The War of Something ->` The Epic Clash Against Something
[2023-12-05 10:39 PM] Deciusmus: Should it genreate:
    
    Part of the Battle of Someting, The War of Something, The Epic Clash Against Something
    
    or should it generate
    
    Part of The Battle of Something, The War of Something, The Epic Clash Against Something
[2023-12-05 10:40 PM] Deciusmus: that is, is the prefix considered "part of" the first element, and thus the "the" in the first element doesn't get upper case (the same way The Book of the Shadows) doesn't have the 2nd the uppered
[2023-12-05 10:40 PM] Deciusmus: or is the prefix its own element for title case purposes
[2023-12-05 10:40 PM] rsulfuratus: the second looks more natural to me
[2023-12-05 10:41 PM] rsulfuratus: it isn't "Part of the Battle", it is Part of "The Battle"
[2023-12-05 10:41 PM] Deciusmus: Right. So in general, the prefix should be considered its own "part" as far as title casing goes
[2023-12-05 10:41 PM] rsulfuratus: yes
[2023-12-05 10:43 PM] Deciusmus: Hrm. Should the prefix ever be title cased?
[2023-12-05 10:43 PM] Deciusmus: Maybe the prefix should only participate in initial upper rules
[2023-12-05 10:43 PM] rsulfuratus: probably the only formatter you really want to apply to prefix is the conditional upper case (when first)
[2023-12-05 10:43 PM] rsulfuratus: jinx
[2023-12-05 10:43 PM] rsulfuratus: actually might not be worth handling it with the name formatter
[2023-12-05 10:44 PM] rsulfuratus: although you probably already have
[2023-12-05 10:44 PM] rsulfuratus: basically it is just a "if initial upper, take it out of the token format and give it to the prefix"
[2023-12-05 10:44 PM] rsulfuratus: otherwise prefix is not formatted
[2023-12-05 10:44 PM] rsulfuratus: or actually I guess if you have an all lower case give it to prefix as well
[2023-12-05 10:47 PM] rsulfuratus: you could just do like:
    `token.prefix = token.format.replace(U, "") ? #format(token.prefix) : token.prefix`
[2023-12-05 10:50 PM] Deciusmus: I moved it to name manager and I'll push a PR in a minute but I'm not actually sure it was a good idea
[2023-12-05 10:50 PM] Deciusmus: because we might want prefixes and suffixes on other things, i.e. age or dates
[2023-12-05 10:50 PM] Deciusmus: It is probably better to simply manipulate the format string, as you suggest
[2023-12-05 11:07 PM] Deciusmus: Hrm. Well it’s my bed time but I think all the approaches are wrong. I’m not sure I want to spend a lot of time on casing though
[2023-12-05 11:08 PM] rsulfuratus: yeah I wouldn't
[2023-12-05 11:09 PM] Deciusmus: The right answer though is probably to delete title casing entirely. It isn’t useful because all of the pages are the correct interior casing anyway
[2023-12-05 11:09 PM] Deciusmus: It’s really just whether you want to have lower case, keep case, or initial upper case
[2023-12-05 11:28 PM] rsulfuratus: I added a displayCY property to normalized date, which is the string "CY YYYY-MM-DD"
[2023-12-05 11:29 PM] Deciusmus: Really we should add format functions to the date object and remove display entirely
[2023-12-05 11:30 PM] Deciusmus: But that’s a nice start
[2023-12-05 11:30 PM] rsulfuratus: yes
[2023-12-05 11:30 PM] rsulfuratus: not sure how to display the intercalary days, still working on that

