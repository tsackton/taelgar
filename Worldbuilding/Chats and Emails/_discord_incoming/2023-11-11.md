# Discord DM â€“ 2023-11-11

[2023-11-11 08:51 AM] rsulfuratus: there are a few issues with the whereabouts spec i think
[2023-11-11 08:53 AM] rsulfuratus: first, on home/origins - are we assuming that origin is a separate yaml entry, not part of whereabouts? otherwise, i don't see how it is possible for there ever to be a origin whereabout without a home whereabout
    ```
       # An origin location is defined as
        # Value: the origin whereabout
        # Output: origin whereabout is defined and whereabouts with type home >` 1 or the origin whereabout is defined and there is no home whereabout
    ```
[2023-11-11 08:54 AM] Deciusmus: You donâ€™t have a home where about if you have a home with an end
[2023-11-11 08:54 AM] rsulfuratus: ah right, okay
[2023-11-11 08:54 AM] Deciusmus: I did change the logic when I was implementing to say just donâ€™t show origin of origin and home are the same
[2023-11-11 08:55 AM] Deciusmus: So basically origin = first home; home = last valid home. 
    
    Show both if they are different
    Only show home if they are the same
[2023-11-11 08:56 AM] Deciusmus: First = first in the list; last = last in the list but filtered by start / end
[2023-11-11 08:56 AM] rsulfuratus: right, okay, so if you want a traveler with a defined origin but no home, you can just create type=home, start=undefined, end=born (or any arbitrary time `< current date)
[2023-11-11 08:56 AM] Deciusmus: Right
[2023-11-11 08:57 AM] rsulfuratus: the other was the checking for home/origin value identity but that is easy to implement
[2023-11-11 08:57 AM] Deciusmus: Right - given the move to a single location value I just checked locations are equal
[2023-11-11 08:58 AM] rsulfuratus: also, is it correct to assume a whereabouts must have a location and type but everything else is optional?
[2023-11-11 08:59 AM] rsulfuratus: (technically an away location with no dates will work strangely/not at all, i guess)
[2023-11-11 09:01 AM] Deciusmus: Away locations should have a start. Home locations donâ€™t need dates.
[2023-11-11 09:01 AM] Deciusmus: Location is not required at all, if there is no location it should render as unknown
[2023-11-11 09:02 AM] Deciusmus: So if someone is traveling in unknown parts you can just set away ; start date
[2023-11-11 09:02 AM] Deciusmus: Iâ€™m not sure if the spec implies that
[2023-11-11 09:02 AM] rsulfuratus: ah okay
[2023-11-11 09:03 AM] Deciusmus: I suppose it might be nice if a home location with no location rendered as blank
[2023-11-11 09:03 AM] Deciusmus: Then you could do:
    Type home: location = some origin
    Type home; # not sure where they live now
[2023-11-11 09:05 AM] rsulfuratus: for my parsing, though, i'm now just doing the following:
    1. type must exist, throw an error if you have whereabouts line that has no type (currently allows for non-home or non-away types, but these will never be output)
    2. value is constructed from location (preferred) or "place, region" (if no location), and set to "Unknown" if doesn't exist
    3. if type is away, a start date must exist, and an error is thrown if it doesn't exist
[2023-11-11 09:09 AM] Deciusmus: Although I think Iâ€™d leave location blank on the parse side and set to unknown on output only
[2023-11-11 09:14 AM] rsulfuratus: all  dview functions except the get event date are now implemented in python - testing now so will have to debug for a bit before output works
[2023-11-11 09:19 AM] Deciusmus: I haven't actually implemented the get_Current yet ðŸ˜„
[2023-11-11 09:19 AM] Deciusmus: but plan to at some point this weekend
[2023-11-11 09:19 AM] Deciusmus: I also think there are some subtlies with home whereabouts that are not captured in the spec
[2023-11-11 09:19 AM] Deciusmus: I changed the code to exclude the origin whereabout as the home whereabout if there were other home whereabouts in the file
[2023-11-11 09:20 AM] Deciusmus: so for example the spec, if you have:
    - type home, no dates, location A
    - type home, end date = 1720, location = B
    
    Will report in 1721, a home of A instead of an origin of A and no home
[2023-11-11 09:22 AM] rsulfuratus: my code won't, because i count the number of homes and report origin if homes >` 1
[2023-11-11 09:23 AM] rsulfuratus: so in this case i'd report origin and home
[2023-11-11 09:23 AM] rsulfuratus: because home A is assumed to be current
[2023-11-11 09:23 AM] Deciusmus: right but you should just report Origin
[2023-11-11 09:23 AM] Deciusmus: ---
    created: 1399
    destroyed: 1399-11-06
    pageTargetDate: 1399-11-07
    whereabouts:
    - {type: home, location: Or Place }
    - {type: home, location: Home Place }
    - {type: away, start: 1399-11-20, end: 1399-12-15, location: P1 }
    - {type: away, start: 1399-11-27, end: 1399-12-11, location: P2 }
    - {type: away, start: 1399-11-28, location: P3 }
    - {type: away, start: 1399-12-30, location: P4 }
    - {type: home, start: 1400, end: 1500, location: Home23 }
    ---
[2023-11-11 09:23 AM] Deciusmus: is my test
[2023-11-11 09:24 AM] Deciusmus: ---
    created: 1399
    destroyed: 1399-11-06
    pageTargetDate: 1399-11-07
    whereabouts:
    - {type: home, location: Or Place }
    - {type: home, end: 1399-11-05, location: Home Place }
    - {type: away, start: 1399-11-20, end: 1399-12-15, location: P1 }
    - {type: away, start: 1399-11-27, end: 1399-12-11, location: P2 }
    - {type: away, start: 1399-11-28, location: P3 }
    - {type: away, start: 1399-12-30, location: P4 }
    - {type: home, start: 1400, end: 1500, location: Home23 }
    ---
[2023-11-11 09:24 AM] Deciusmus: sorry that
[2023-11-11 09:24 AM] Deciusmus: should report:
    
    Originally from: Or Place
    
    and nothing else
[2023-11-11 09:24 AM] rsulfuratus: i don't think your example has enough information to determine whether location A is origin, with no home, or whether location A is current home, with no origin
[2023-11-11 09:25 AM] rsulfuratus: unless we assume homes have to be entered in chronological order even without dates
[2023-11-11 09:25 AM] rsulfuratus: the data you describe could have been created from someone adding the new home to the top of the yaml, not the bottom
[2023-11-11 09:25 AM] Deciusmus: Right but I think the implication of the spec was that origin is the first home in the file
[2023-11-11 09:26 AM] Deciusmus: No matter what
[2023-11-11 09:26 AM] rsulfuratus: ah, okay
[2023-11-11 09:26 AM] Deciusmus: And  "home" is the *last* valid home in the file
[2023-11-11 09:27 AM] Deciusmus: If I delete the location: Or Place (but keep the end date on the home) it should report:
    
    orginally from: home place 
    if you are after the end date
    
    and
    based in: home place
    if you are before the end date
[2023-11-11 09:28 AM] rsulfuratus: so home is last valid home in the file, but if home_count >` 1 and origin == home then home is unknown
[2023-11-11 09:28 AM] Deciusmus: right
[2023-11-11 09:28 AM] Deciusmus: whereabouts if home_count = 1, then home = origin and we output only home
[2023-11-11 09:28 AM] rsulfuratus: i think the spec gets the correct home and origin but it is just a question of deciding which to output depending on value and home count
[2023-11-11 09:30 AM] rsulfuratus: if home_count == 1:
    home = True and origin = False if home value is defined, otherwise origin = True and home = False
[2023-11-11 09:30 AM] rsulfuratus: logic is if home_count == 1, should always just output home unless home has an end date, implying no current home
[2023-11-11 09:31 AM] rsulfuratus: by definition if home_count == 1, origin and home must have the same value if both defined, so don't need to check
[2023-11-11 09:32 AM] rsulfuratus: if home_count >` 1, we need to check if home and origin have the same value. 
    
    if they have the same value, that means the only valid home is the origin, so we output origin True and home True but set home value to "Unknown"
    
    if they have a different value, then we have a valid home and an origin, so set both to True and leave values unchanged
[2023-11-11 09:33 AM] Deciusmus: So I have a js function get_homeWhereabouts in the metadataUtils which returns the "home whereabouts" per the spec and then I make output decisions later
[2023-11-11 09:34 AM] Deciusmus: I updated that js function to return "undefined" if the home count >` 1 and the home has no start or end date
[2023-11-11 09:34 AM] Deciusmus: that might be wrong though
[2023-11-11 09:34 AM] rsulfuratus: i return a dict with value, output for each of current, home, origin, last known
[2023-11-11 09:34 AM] rsulfuratus: where value is location and output is logical
[2023-11-11 09:35 AM] rsulfuratus: (also has date so we can report last known date)
[2023-11-11 09:35 AM] Deciusmus: actually I didn't follow the spec for home at all
[2023-11-11 09:36 AM] Deciusmus: Right, I want to distinguish between "the home whereabout" and "I should output the home whereabout" because I want to write an Dataview table generator that shows everyone who's home is in a place
[2023-11-11 09:37 AM] Deciusmus: So I want the home to be "correctly" undefined if there home is not in the place,
[2023-11-11 09:37 AM] Deciusmus: Same for origin
[2023-11-11 09:37 AM] Deciusmus: So basically, I want my underlying JS code to return both home and origin if they are the same, and then my output code distinguishes
[2023-11-11 09:46 AM] Deciusmus: I never show "Home: unknown" - always blank if it isn't known
[2023-11-11 09:51 AM] rsulfuratus: can you push your testing notes?
[2023-11-11 09:53 AM] Deciusmus: yeah
[2023-11-11 09:53 AM] Deciusmus: pushed
[2023-11-11 09:53 AM] Deciusmus: afk for a while
[2023-11-11 10:52 AM] rsulfuratus: I believe the python code I just pushed is all working correctly per the specs + discussion
[2023-11-11 10:52 AM] rsulfuratus: in the _Testing folder I added a testout folder, which is the output of the script with inline dview (`$=) replaced by plain markdown
[2023-11-11 10:53 AM] rsulfuratus: i think the logic is all correct, but if you see something weird let me know
[2023-11-11 10:53 AM] rsulfuratus: generated with ` python3 convert_markdown.py -c ../.obsidian -d ../_Testing -o testout --dview ` run in the _scripts directory
[2023-11-11 10:53 AM] rsulfuratus: help available via `python3 convert_markdown.py -h`
[2023-11-11 10:54 AM] rsulfuratus: requires python >` 3.6 and tested on python 3.10
[2023-11-11 11:02 AM] rsulfuratus: so far the filter option to remove `%%`^Date: and `%%`^Campaign blocks works, as does the dview convert. the yaml cleanup is not yet implemented
[2023-11-11 11:03 AM] Deciusmus: I'm looking at tweaking how the Javascript get_CurrentWhereabouts works a bit
[2023-11-11 11:05 AM] Deciusmus: Because I want to have two different concepts:
    (a) the current location of someone - is either (a) home or (b) exact or (c) unknown but never undefined
    (b) the output of the "get_CurrentWhereabouts" which uses "is same" to decide what do to
[2023-11-11 11:07 AM] Deciusmus: So I was going to propose a tweak to the get_currentwhereabouts which is basically to say:
    
    Get current location (as per the spec)
    Get home location (as per the spec)
    Get last known location (as per the spec)
    
    Output:
    
    if (current == home) return ""
    
    if (last known)  output last known
    output current
[2023-11-11 11:08 AM] Deciusmus: Wait that isn't correct.
    
    We don't output last know if current is known
[2023-11-11 11:08 AM] rsulfuratus: my code has four things: last known, exact, home, and origin
[2023-11-11 11:08 AM] Deciusmus: So the logic is
    
    if (current == home) output nothing & exit
    if (current.location is deifned) output current & exit
    if (current.location is not defined) output last known + current: unknown
[2023-11-11 11:09 AM] Deciusmus: My code doesn't care about exact
[2023-11-11 11:09 AM] rsulfuratus: yeah this is basically what i do
[2023-11-11 11:09 AM] rsulfuratus: but this might be slightly cleaner
[2023-11-11 11:09 AM] rsulfuratus: but not going to rewrite unless my implementation introduces bugs
[2023-11-11 12:16 PM] Deciusmus: I'm heading out for a hike in a bit, but one slight wrinkle
[2023-11-11 12:16 PM] Deciusmus: Belagor testing page has this:
    
    lastSeenByParty: 
     - { date: 1748-9-30, prefix: DuFr }
    whereabouts:
         - { start: "", end: 1600, location: Ainumarya, type: home } #end is approx
         - { start: 1733-01-01, location: "Elderwood", type: away }
         - { start: 1748-08-15, location: "Te'kula village, Elderwood", type: away}
[2023-11-11 12:16 PM] Deciusmus: the current code assumes that  location: "Te'kula village, Elderwood" is good only for 1748-08-15
[2023-11-11 12:17 PM] Deciusmus: so my "last seen by party" code generates "unknown"
[2023-11-11 12:18 PM] rsulfuratus: hmmm
[2023-11-11 12:19 PM] rsulfuratus: so one option would be to treat this as a data entry problem, and just require an extra away line in that header
[2023-11-11 12:19 PM] rsulfuratus: e.g.,
    - { start: "", end: 1600, location: Ainumarya, type: home } `#end` is approx
    - { start: 1733-01-01, location: "Elderwood", type: away }
    - { start: 1748-08-15, end 1748-09-29, location: "Te'kula village, Elderwood", type: away}
    - { start: 1748-09-30, location: "Te'kula village, Elderwood", type: away}
[2023-11-11 12:20 PM] rsulfuratus: that properly codes that we know he was in the village from 8-15 to 9-30 but don't know where he is after that
[2023-11-11 12:21 PM] rsulfuratus: in this case as well, because there is no valid home, we could just set the end to 09-30 and leave off the last line
[2023-11-11 12:22 PM] rsulfuratus: i think it is simplest to treat the whereabouts as a list of known locations, and consider it a data entry error if lastSeenByParty generates an unknown line
[2023-11-11 12:23 PM] rsulfuratus: there are going to be very few of these and it will be easy to correct because we know that last seen by party unknown must be an error
[2023-11-11 12:25 PM] rsulfuratus: alternatively, you could add an explicit "unknown future" tag that, when present, treats end as unknown for the purposes of determining if someone returned home after the end of the whereabouts line
[2023-11-11 12:25 PM] rsulfuratus: but i think it is probably simpler to just stick with the logic of "defined end = returned home, undefined end = unknown future" and just duplicate away lines as needed
[2023-11-11 12:37 PM] Deciusmus: Yeah, that's the conclusion I came to as well
[2023-11-11 12:37 PM] Deciusmus: The code I wrote will generate:
    
    last seen by party @ date: unknown
[2023-11-11 12:37 PM] Deciusmus: which I think is accurate per the spec and clear enough signal that something is wrong
[2023-11-11 12:41 PM] rsulfuratus: one last thing about setting metadata - I'm thinking adding default values to startPrefix, startStatus, endPrefix, endStatus, and preExistError in my metadata cleanup code, which would mean we could simplify the get_PageDatedValue function and be more flexible about not needing to define values for any possible type there (e.g., if we to add a created: 1700 to an organization and have it say "started: DR 1700")
[2023-11-11 12:42 PM] rsulfuratus: this would mean proliferation of file properties in obsidian, and would mean needing to set up templates to auto-generate default metadata for each type
[2023-11-11 12:42 PM] rsulfuratus: but personally i think it is a lot cleaner and more flexible to rely on yaml frontmatter for these things
[2023-11-11 12:43 PM] rsulfuratus: and if i'm already going to reformat existing notes, may as well?
[2023-11-11 12:46 PM] Deciusmus: It just means when creating a new note you have a lot of work
[2023-11-11 12:46 PM] Deciusmus: I'm not against it but we need a template for a new note that sets it all
[2023-11-11 12:46 PM] rsulfuratus: that is why it only works with templates
[2023-11-11 12:46 PM] Deciusmus: Oh I missed that line
[2023-11-11 12:47 PM] Deciusmus: Yeah, I agree
[2023-11-11 12:47 PM] Deciusmus: Honestly, maybe we should get rid of born/died and just use created/destroyed for everything
[2023-11-11 12:49 PM] rsulfuratus: eh, not sure it matters too much, there is a lot of people vs non-people setup anyway so moving created/destroyed to 'core' doesn't change much
[2023-11-11 01:02 PM] Deciusmus: Sure
[2023-11-11 01:02 PM] Deciusmus: Although one note, I think the preexist error is not important
[2023-11-11 01:02 PM] Deciusmus: Iâ€™d hardcode it to something
[2023-11-11 01:02 PM] Deciusmus: It doesnâ€™t really need to vary for different pages
[2023-11-11 01:08 PM] Deciusmus: I am actually leaving to go to the fells nowâ€¦ but I pushed what should be working template for the header and js for current and home whereabouts
[2023-11-11 01:10 PM] Deciusmus: If I have time I want to 
    - fix event table
    - create a table of everyone in a certain place at a certain time
    - everyone who lives in a certain place at a certain type
    - everyone from a certain place
[2023-11-11 01:11 PM] Deciusmus: I also have some ideas around replacing the npc tags with something more friendly to programmatic manipulation so that I could create a table of all the npcs in Cleenseau the party knows about or has meet
[2023-11-11 01:12 PM] rsulfuratus: can't you just use tag != NPC/Clee/unknown?
[2023-11-11 01:14 PM] Deciusmus: Yeah probably. Havenâ€™t looked in detail. Iâ€™m just not sure the benefit of tags for that kind of thing
[2023-11-11 01:14 PM] rsulfuratus: yeah tags could change later if we have better things to do with them. i use them to sort npcs to work on, e.g., I have a table of npc/dufr/major and not status/uptodate
[2023-11-11 01:17 PM] Deciusmus: Finally I was thinking about gazeetteer and thinking it might be nice to have a â€œparentLocationâ€ so that it would be easier to find places inside places and so on. Although maybe that can be derived by folder structure
[2023-11-11 04:04 PM] Deciusmus: So.. A few changes I am playing with, curious as to your thoughts:
    
    1. Introduce "parentLocation" frontmatter tag and when getting a location, walk up the tree acculmulating. Currently I am only doing it when the input string has no comma.
    
    So for example get_Location("Taviose") tries to get the file for Taviose, if it finds it, it gets the file for Taviose's parent location and so on. And then it outputs
    
    Tavoise, Barony of Averil, Sembara
    
    It will only go up 2 levels
[2023-11-11 04:04 PM] Deciusmus: 
![[../_discord_assets/image-30BBC.png]]
[2023-11-11 04:05 PM] Deciusmus: I find it very nice to be able to type bare strings for locations, i.e. just "Cleenseau" or "Tollen" or "Tokra" or whatever
[2023-11-11 04:06 PM] rsulfuratus: so, that seems nice, but with my current python code will be impossible to implement. all i track is the metadata of the current file and the names of all files in the dir+subdirs
[2023-11-11 04:07 PM] rsulfuratus: you are presuambly able to do this fairly easily because you can get the tags for an arbitrary file with dataview api
[2023-11-11 04:08 PM] rsulfuratus: theoretically it could be possible to run my code on all files, get a dict of file ->` metadata, and then write a loc lookup function
[2023-11-11 04:08 PM] Deciusmus: well, the raw obisidan API, but yes
[2023-11-11 04:08 PM] Deciusmus: let fm = window.app.metadataCache.getFileCache(file).frontmatter
[2023-11-11 04:09 PM] Deciusmus: but you shouldn't need to do that. it doesn't need to be fast
[2023-11-11 04:09 PM] Deciusmus: Just write a function that takes a file path and returns the value of the parentLocation from the file path
[2023-11-11 04:09 PM] Deciusmus: i.e. by reading the file's yaml
[2023-11-11 04:10 PM] rsulfuratus: ah hmm there is this:
    https://github.com/mfarragher/obsidiantools
[2023-11-11 04:12 PM] rsulfuratus: right now I don't have a separate function to read frontmatter, i just grab it when i read the file
[2023-11-11 04:15 PM] Deciusmus: Right you'd have to extract your file loading code. Or just use obsidian tools which looks like it would give you the same basic API obsidian has
[2023-11-11 04:16 PM] rsulfuratus: yeah, the obsidian tools has a get frontmatter and get source text so i could dump all my parsing text...and also has a get plain text which would be quite useful for generating material to input into chatgpt
[2023-11-11 04:17 PM] rsulfuratus: might refactor to use that which would make a lot of things easier. if it reads inline tags could even make event stuff manageable
[2023-11-11 04:19 PM] Deciusmus: inline tags are a dataview feature not an obsidian feature, I think
[2023-11-11 04:19 PM] rsulfuratus: yeah there is an open issue in the obsidiantools repo marked as enhancement to implement dataview....
[2023-11-11 04:33 PM] rsulfuratus: i'm working on metadata cleanup and am almost ready to deploy
[2023-11-11 04:34 PM] rsulfuratus: however, noticing an issue, when we encoded origin as start=born-01-01 and home as start=born-01-02
[2023-11-11 04:35 PM] rsulfuratus: if you remove the start=born-01-01, things work correctly
[2023-11-11 04:35 PM] rsulfuratus: i could check to see if the start=born for metadata cleanup and remove start in that case
[2023-11-11 04:36 PM] rsulfuratus: but wondering if there is a reason why that would cause problems elsewhere
[2023-11-11 04:43 PM] Deciusmus: I'm not sure what you mean
[2023-11-11 04:44 PM] Deciusmus: You mean, would removing start from lines that have start = born-01-01 or start=born-01-02 ?
[2023-11-11 04:44 PM] rsulfuratus: if start == born-01-01 set start to ""
[2023-11-11 04:44 PM] Deciusmus: yeah that makes sense to
[2023-11-11 04:44 PM] Deciusmus: `*`to me
[2023-11-11 04:48 PM] Deciusmus: we are about to go out for dinner, but the other thing I was thinking about was clarifying the types of files and metadata spec...
    
    It would be useful to have a template for creating / adding yaml to each type of file...
    
    (a) PC
    (b) NPC
    (c) Ruler
    (d) Event
    (e) Item
    (f) Building
    (g) Location
    (h) Organization
    (i) Holiday
[2023-11-11 04:49 PM] Deciusmus: maybe "Timeline"
[2023-11-11 04:51 PM] rsulfuratus: my metadata cleanup code is kind of hacky but the way it works is creates a blank metadata with all the expected values for a type, then parses the actual metadata into the expected values based on various rules, then exports the new metadata with empty values for those without info
[2023-11-11 04:51 PM] rsulfuratus: it is pretty easy to change and run with different types and metadata specs
[2023-11-11 04:51 PM] rsulfuratus: right now i'm going to clean up at least the people directory because of how messy the whereabouts is
[2023-11-11 04:52 PM] rsulfuratus: but it would be fairly easy to change the code to clean up to any arbitrary spec
[2023-11-11 04:52 PM] rsulfuratus: and also would be easy to write a function to guess type based on folder, json, or something else
[2023-11-11 04:54 PM] Deciusmus: I think it is probably better to have:
    
    An obisidian template the creates a specific metadata for a type
    An obsidian template (in javascript using templater) that figures out type based on folder and inserts
    A Python script that cleans up existing data
[2023-11-11 04:54 PM] Deciusmus: So when you have a blank page you can just do
    
    ALT-N or whatever and it inserts the probably right YAML for the folder
    
    Or you can run the specific template you want
    Or if we change stuff we can rerun the python script to cleanup
[2023-11-11 04:55 PM] rsulfuratus: right, yes, the python script is just for wholesale cleanup of entire folders
[2023-11-11 06:04 PM] rsulfuratus: pushed a branch with massive metadata cleanup
[2023-11-11 06:05 PM] rsulfuratus: mostly affects people as things with undefined type just get copied over

