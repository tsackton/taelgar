# Discord DM ‚Äì 2023-11-14

[2023-11-14 11:08 AM] rsulfuratus: spent a bit of time this morning doing a bit of manual cleanup. there are still a handful of yaml lines that, for some unexplained reason, got output in "long form" but I don't think this is worth debugging in my python code. at some point we might consider https://platers.github.io/obsidian-linter/ if we really want to enforce strict yaml rules
[2023-11-14 11:10 AM] rsulfuratus: i am pretty busy this afternoon but might work on python code tonight - i think it would make sense to merge the metadata_cleanup PR, since right now my git history is a mess and all my python coding commits are intermingled with metadata cleaning commits, which is bad form but hard to resolve without just merging to main and starting a new python branch to clean up python functions
[2023-11-14 11:10 AM] rsulfuratus: (alternatively I might work on actual content tonight, we'll see)
[2023-11-14 11:15 AM] Deciusmus: Yeah
[2023-11-14 11:15 AM] Deciusmus: Happy for you to do that
[2023-11-14 11:16 AM] Deciusmus: Im just done with a series of meetings and have a kinda dead 40 min til my next thing so I might muck around with JavaScript a bit
[2023-11-14 11:16 AM] Deciusmus: I pushed a few small changes to your metadata branch and spot checked it
[2023-11-14 11:16 AM] Deciusmus: So looks reasonable to merge
[2023-11-14 11:16 AM] rsulfuratus: i'll merge PR now, have to fix few merge conflicts but should be minor
[2023-11-14 11:17 AM] rsulfuratus: would be nice to make the template generator get info from tags since we don't have type anymore, would make it faster to regenerate headers
[2023-11-14 11:18 AM] Deciusmus: Yeah I can fix that
[2023-11-14 11:19 AM] Deciusmus: I was mucking about with whereabouts because I‚Äôm trying to get a solid :
    
    - give me a list of all people who are in place X at time Y
[2023-11-14 11:20 AM] Deciusmus: And I think the concept of current / home / origin / last know is not quite right
[2023-11-14 11:23 AM] Deciusmus: But I‚Äôll take a few min to look at cleaned up template stuff
[2023-11-14 11:23 AM] Deciusmus: Do you use the ‚Äúregenerate front matter‚Äù template or just the regen header / insert header ones ?
[2023-11-14 11:24 AM] rsulfuratus: I just use the header templates
[2023-11-14 11:24 AM] Deciusmus: I was going to delete the front matter one as it is confusing and not up to date
[2023-11-14 11:43 AM] Deciusmus: Ok:
    
    Template1 : Regenerate Header
    Purpose: Deletes the header block and inserts the generate header template
    
    Condition: File must have at least one tag, must not have a tags containing "stub"
    
    Make sense?
[2023-11-14 11:44 AM] rsulfuratus: why not allow header regeneration for stubs? a lot of things i would tag stub are things with just header info
[2023-11-14 11:44 AM] rsulfuratus: but could use a different tag for that i guess
[2023-11-14 11:44 AM] rsulfuratus: maybe stub = nothing
[2023-11-14 11:45 AM] rsulfuratus: wip = basic info but needs text
[2023-11-14 11:45 AM] rsulfuratus: i would say must have at least one non-status tag
[2023-11-14 11:45 AM] Deciusmus: you mean at least one tag that doesn't start status ?
[2023-11-14 11:45 AM] rsulfuratus: yes
[2023-11-14 11:48 AM] rsulfuratus: the idea being you shouldn't be able to regenerate headers for notes with just:
    ---
    tags: `[status/stub]`
[2023-11-14 11:50 AM] Deciusmus: ---
    tags: `[status/stub]`
    ---
    
    no header
    
    ---
    tags: `[person, status/stub]`
    ---
    
    gets a header
[2023-11-14 11:58 AM] Deciusmus: to what extent do you think the header should look nice if there is very minimal info?
[2023-11-14 11:59 AM] Deciusmus: i.e. it is easier to code if we always generate the 
    
    `[!info]`+ Biographical Summary
    
    bit even if there is nothing else to do (for people, I mean)
[2023-11-14 12:02 PM] rsulfuratus: here is my attempt at a new whereabouts spec:
    
    A whereabouts entry consists of four parts: 
    - a type, which can be home or away
    - a start, which is any date, an empty string, or a null/None value
    - an end, which is any date, an empty string, or a null/None value
    - a location, which is any string, which can be empty, or a null/None
    
    A whereabouts entry must have a type.
    A whereabouts entry with a type of away must have a start that is a valid date.
    
    To calculate a whereabouts result requires a whereabouts metadata and a target date. The target date is usually the current date, but can be overwritten with yaml frontmatter (e.g. pageTargetDate). Functions to calculate whereabouts locations assume they will always be passed a metadata object from which whereabouts can be extracted, and a target date. If there is a pageTargetDate in the metadata, this will override the target date passed to the function. 
    
    Given a whereabouts and a target date two additional values are calculated - imputed start and imputed end
    for type home, the imputed start is equal to the earliest possible date, and the imputed end is equal to the target date
    for type away, imputed start is always equal to start, which must be provided. if start is YYYY or YYYY-MM, imputed start should be the earliest valid month/day
    for type away, imputed end is always equal to imputed_start
[2023-11-14 12:02 PM] rsulfuratus: 1. An origin whereabouts is defined as the earliest 'home' location, where earliest is defined as the smallest imputed start.
    If multiple home locations have the same date, the lexigraphically first home is considered the origin whereabouts.
    
    2. A home whereabouts is defined as the valid home location with the shortest duration between imputed start and target date.
    A valid home location is a home location where imputed end >`= target date
    If there are multiple valid home locations with equal duration between imputed start and target date, the lexigraphically last home is considered the home whereabouts.
    
    3. A current whereabouts is defined as the valid current location with the shortest duration. 
    A valid current location is determined by the following algorithm:
    - if there are no away lines in the whereabouts, the only valid current location is the home location
    - if there are away lines, the list of valid current locations is the set of away locations where imputed start `<= target_date `<= imputed_end
    - if the list of valid current locations is empty, then the current whereabouts is set to unknown if real end is undefined, and home otherwise
    - if the list of valid current locations is not empty, then the current whereabouts is set to the valid location with the shortest duration (imputed_end - imputed_start)
[2023-11-14 12:02 PM] rsulfuratus: 4. A last know whereabouts is defined as the valid current location with the shortest duration, defined as imputed_end - target_date. A known location cannot be unknown
    A known location is determined by the following algorithm:
    - if the current whereabouts is not unknown, the last known whereabouts is the current whereabouts, and the last known date is the target date
    - if the current whereabouts is unknown, by definition there must be away lines, and there must be away lines with undefined real ends. in this scenario, to determine the last known location:
        - the last known location is the away lines where imputed_start `<= target_date and with the shortest duration between imputed_end and target_date 
        - if there are multiple valid last known locations, the one with the shortest duration (imputed_end - imputed_start) is preferred
        - if there are multiple valid last known locations with the same duration, the one lexigraphically last in the file is preferred
        - the last known date is defined as the imputed_end of the last known location
[2023-11-14 12:02 PM] rsulfuratus: this doesn't do anything about died - need to think about how to handle that
[2023-11-14 12:04 PM] Deciusmus: We need better threaded chats üôÇ
[2023-11-14 12:05 PM] Deciusmus: Want to read that but trying to finish the header spec...
[2023-11-14 12:06 PM] Deciusmus: For the header, I have basically:
    
    # `<name>`
    >` Biographical Info
    >` species (ancestry), pronouns
    >` get_pageDatedValue (ka for elves)
    >` >` origin
    >` >` home
    >` >` last seen by party
    >` >` current whereabouts
[2023-11-14 12:08 PM] rsulfuratus: that seems good to me
[2023-11-14 12:08 PM] Deciusmus: where:
    (a) name block is always generated
    (b) page dated value is always generated (it should return blank if there are no dates for the page)
    (c) origin home etc are generated for any page that has whereabouts
    (d) species line doesn't show the bits that are not in frontmatter
[2023-11-14 12:11 PM] Deciusmus: Alternatively, maybe I should only output page dated if the tag indicates it is a person, place, item, or organization
[2023-11-14 12:13 PM] rsulfuratus: i'd leave pageDated for everything - if we eventually want to do something like add a date for events, e.g. just 
    # Name
    DR 567 - 677
[2023-11-14 12:13 PM] rsulfuratus: also, we should add pronuciation if it is not blank
[2023-11-14 12:14 PM] rsulfuratus: although I guess for events that might not need to be dynamic
[2023-11-14 12:15 PM] rsulfuratus: so maybe better to only output for person, place, item, organization. or you could just check to see if born/created/died/destroyed is not null and only output if there are values for at least one of those
[2023-11-14 12:15 PM] Deciusmus: Where should pronunciation go?
[2023-11-14 12:15 PM] Deciusmus: # name
    (pro)
    Bio
    
    or
[2023-11-14 12:15 PM] Deciusmus: #name
    bio
    (pro)
[2023-11-14 12:15 PM] rsulfuratus: I'd do:
    
    # Name
    *(pronuncidation)*
    
    Biographical Info
    species (ancestry), pronouns
    get_pageDatedValue (ka for elves)
    >` origin
    >` home
    >` last seen by party
    >` current whereabouts
[2023-11-14 12:15 PM] rsulfuratus: I like to see that right at the top of the page
[2023-11-14 12:16 PM] rsulfuratus: i wouldn't put it in the info box actually
[2023-11-14 12:17 PM] Deciusmus: 
![[../_discord_assets/image-D3004.png]]
[2023-11-14 12:18 PM] rsulfuratus: yeah I like that
[2023-11-14 12:18 PM] Deciusmus: 
![[../_discord_assets/image-8EF51.png]]
[2023-11-14 12:18 PM] Deciusmus: if it is not a person
[2023-11-14 12:20 PM] Deciusmus: 
![[../_discord_assets/image-D9DFC.png]]
[2023-11-14 12:20 PM] Deciusmus: 
![[../_discord_assets/image-668C9.png]]
[2023-11-14 12:21 PM] rsulfuratus: that all looks great
[2023-11-14 12:22 PM] Deciusmus: So for unknown types I output ONLY the H1 and pronunciation line
[2023-11-14 12:22 PM] rsulfuratus: yes
[2023-11-14 12:23 PM] rsulfuratus: for other common types, I'd do something like:
    1. for locations, output pageDated and "a `<placeType>` in `<partOf1>`, `<partOf2>`. also maybe output popuation if not blank, like age for pageDated. there might be other summary information for places that could be useful, but not positive
[2023-11-14 12:24 PM] rsulfuratus: 2. for items, output pagedDated and some kind of summary from magical, unique (for items that are unique or that represent a type), `[mechanics]`(ddbLink), maker, owner
[2023-11-14 12:25 PM] rsulfuratus: at the moment almost none of these are filled in so items is kind of low priority IMO
[2023-11-14 12:25 PM] rsulfuratus: locations is more interesting because it is quite fast to fill in location metadata by hand and a lot of locations are stubs that could benefit from simple orientation information
[2023-11-14 12:28 PM] rsulfuratus: organizations probably don't really need much tbh, i don't have anything set for any organizations yet and founded/disbanded dates are generally not actually that important (especially because they can be a little ambiguous). probably a historical tag to indicate "was primarily active long ago and isn't a "current day" organization" is better
[2023-11-14 12:30 PM] Deciusmus: 
![[../_discord_assets/image-913D4.png]]
[2023-11-14 12:31 PM] rsulfuratus: i would delete the starting "a'" from "a `<placeType>` in `<partOf>`" - reads better to me to not have it than to have incorrect a vs an
[2023-11-14 12:32 PM] rsulfuratus: but otherwise looks good that is a super minor thing
[2023-11-14 12:32 PM] Deciusmus: I was about to just fix a vs an
[2023-11-14 12:32 PM] rsulfuratus: that is also fine
[2023-11-14 12:32 PM] Deciusmus: if no placeType it is
    
    a place in
[2023-11-14 12:32 PM] Deciusmus: if no part of the whole thing is skipped
[2023-11-14 12:33 PM] Deciusmus: partOf is  up to 3 items, if Sembara was partOf something it wouldn't keep going
[2023-11-14 12:33 PM] Deciusmus: if the target place doesn't have a page, it is not linked and no chain, i.e.
![[../_discord_assets/image-0611A.png]]
[2023-11-14 12:34 PM] Deciusmus: not sure where to put population
[2023-11-14 12:34 PM] rsulfuratus: I would consider having the partOf chain be:
    1, 2, N-1 instead of 1, 2, 3, if len(chain) >` 3
[2023-11-14 12:34 PM] rsulfuratus: probably irrelevant now
[2023-11-14 12:35 PM] rsulfuratus: but if you have an inn in a ward in a city in a subdistrict in a subregion in a kingdom in a region
[2023-11-14 12:35 PM] rsulfuratus: you probably want inn in ward, city, kingdom
[2023-11-14 12:35 PM] Deciusmus: its hard to know what "kingdom" is though
[2023-11-14 12:35 PM] rsulfuratus: but we might need to see how the partOf stuff develops before deciding
[2023-11-14 12:36 PM] rsulfuratus: so probably best to keep up to 3 for now and see how it ends up looking
[2023-11-14 12:36 PM] Deciusmus: yeah
[2023-11-14 12:40 PM] Deciusmus: 
![[../_discord_assets/image-90A15.png]]
[2023-11-14 12:44 PM] rsulfuratus: i would appreciate if the created/destroyed obey the displayDefaults metadata, as I'd like to change things to e.g. founded, settled, burnt down, abandoned, forged, etc
[2023-11-14 12:44 PM] Deciusmus: the template just outputs a call to get_PageDatedValue
[2023-11-14 12:45 PM] Deciusmus: haven't fixed that to use the new displayDefaults
[2023-11-14 12:45 PM] rsulfuratus: ah okay, so just need to fix that got it
[2023-11-14 12:45 PM] Deciusmus: but it will do whatever it used to do
[2023-11-14 12:55 PM] rsulfuratus: i fixed that, should work now
[2023-11-14 12:55 PM] rsulfuratus: just pushed
[2023-11-14 12:55 PM] rsulfuratus: have a meeting in 5 min and then busy for the rest of the afternoon but might work on whereabouts tonight if you have thoughts
[2023-11-14 02:01 PM] rsulfuratus: pushed a bit of whereabouts stuff to the Whereabouts and Location Specification, now busy for most of the afternoon but might check discord occasionally if you have comments on whereabouts
[2023-11-14 03:48 PM] rsulfuratus: pronunciation generator: https://chat.openai.com/g/g-tNTZcpOFV-phonetic-navigator
[2023-11-14 03:48 PM] rsulfuratus: 
![[../_discord_assets/image-25FDA.png]]
[2023-11-14 04:04 PM] rsulfuratus: I hit my usage limit on chatGPT so can't tinker any more but it should generally be working. you can give more than one language. going to try to add taelgar languages are a certain point (e.g., Galadriel, Elvish would be ->` Galadriel, Quenya or Sindarin; Apollyon, Drankorian ->` Apollyon, Greek or Latin, etc)
[2023-11-14 04:22 PM] Deciusmus: >` To calculate a whereabouts result requires a whereabouts metadata and a target date. The target date is usually the current date, but can be overwritten with yaml frontmatter (e.g. pageTargetDate). Functions to calculate whereabouts locations assume they will always be passed a metadata object from which whereabouts can be extracted, and a target date. If there is a pageTargetDate in the metadata, this will override the target date passed to the function. 
    
    From a specification perspective this isn't true. I might want to get the whereabouts at the last met by party date, for example. In which case the page date shouldn't override that.
    
    From a specification standpoint I would just say "whereabouts has a target date" and leave it at that. The python function should require an input target date and fail if it isn't passed
[2023-11-14 04:23 PM] Deciusmus: >` Given a whereabouts and a target date two additional values are calculated - imputed start and imputed end
    >` for type home, the imputed start is equal to the earliest possible date, and the imputed end is equal to the target date
    >` for type away, imputed start is always equal to start, which must be provided. if start is YYYY or YYYY-MM, imputed start should be the earliest valid month/day
    >` for type away, imputed end is always equal to imputed_start
    
    I think that the imputed end is not target date. I would say that:
    for type = home, the imputed_start is the minimum date and the imputed_end is the maximum date
    for type = away, the start is required, and the imputed_end is the imputed_start
[2023-11-14 04:25 PM] Deciusmus: >` for type away, imputed start is always equal to start, which must be provided. if start is YYYY or YYYY-MM, imputed start should be the earliest valid month/day
    >` for type away, imputed end is always equal to imputed_start
    
    Question - if you have something with type: away and start: 1602, does that imply away for ALL of 1602? I think yes. Which would mean that the imputed_end for YYYY is YYYY-12-31 and for YYYY-MM is YYYY-MM-lastDayOfMM
[2023-11-14 04:26 PM] Deciusmus: It seems weird otherwise that someone with a 
    type: away, start: 1602, location: Sembara is considered "in sembara" only on 01-01-1602
[2023-11-14 04:28 PM] Deciusmus: >` An origin whereabouts is defined as the earliest 'home' location, where earliest is defined as the smallest imputed start.
    
    Agree here
[2023-11-14 04:28 PM] Deciusmus: >` A home whereabouts is defined as the valid home location with the shortest duration between imputed start and target date.
    
    Agree here.
[2023-11-14 04:32 PM] Deciusmus: >` An origin whereabouts is defined as the earliest 'home' location, where earliest is defined as the smallest imputed start.
    
    Actually wait, this isn't right. The origin location is simply the first location that has type = home and no start.
    
    I want to be able to say:
    
    type: home, start: 1700, location: Cleenseau # date is approx
    
    To represent someone with definitely no origin, i.e. where I know they didn't come from Cleenseau
[2023-11-14 04:33 PM] Deciusmus: This is distinguished from:
    
    type: home, location: Cleenseau
    
    which indicates they should be considered as "from" Cleenseau
    
    vs
    
    type: home, location: Embry
    type: home, location: Cleenseau
    
    for someone who is from Emby and now lives in Cleenseau
[2023-11-14 04:42 PM] Deciusmus: >` A current whereabouts is defined as the valid current location with the shortest duration.
    >` A valid current location is determined by the following algorithm:
    >` if there are no away lines in the whereabouts, the only valid current location is the home location
    >` if there are away lines, the list of valid current locations is the set of away locations where imputed start `<= target_date `<= imputed_end
    >` if the list of valid current locations is empty, then the current whereabouts is set to unknown if real end is undefined, and home otherwise
    >` if the list of valid current locations is not empty, then the current whereabouts is set to the valid location with the shortest duration (imputed_end - imputed_start)
    
    I don't think this is quite right. I think what you do is calculate the valid location (imputed start `<= target date `<= imputed end) where the start is closest to the target date, just like for home. 
    
    But instead of imputed_end = end ?? start for type = away and imputed_end = end ?? max for home, you use imputed end = end ?? max date for both.
    
    That gets you the "best match location". Then, either
    (a) this location is type home - use it as current, last known is none
    (b) this location is type away and has a real end - use it as current, last known is none
    (c) this location is type away and has an undefined real end - 
    then, if the target date == start date, use it as current, last known is none
    otherwise, use it as last known, current as none
[2023-11-14 04:51 PM] rsulfuratus: I updated some things in the _MOC/Templates/Whereabouts and Location Specification
[2023-11-14 04:53 PM] rsulfuratus: >` Question - if you have something with type: away and start: 1602, does that imply away for ALL of 1602? I think yes. Which would mean that the imputed_end for YYYY is YYYY-12-31 and for YYYY-MM is YYYY-MM-lastDayOfMM
    
    yes, this is automatic in my code, as I have a clean_date function that takes a possibly incomplete date and returns either start (earliest valid) or end (latest valid). start/born always calculated as earliest valid, end/died always calculated as latest valid, unless this needs to be overridden for some reason
[2023-11-14 04:54 PM] Deciusmus: It's all even simpler. You need:
    
    filter_whereabouts
    Given a whereabout list, a target date, and optional valid type this will return the whereabouts in the file order from the whereabout list that
    (a) are valid (imputed start `<= target `<= imputed end && type matching if type specified)
    (b) have the smallest possible target - start from amongst the valid items
[2023-11-14 04:56 PM] Deciusmus: origin = filter(target, "home").first()
    if (origin.start) origin = undefined.
    
    home = filter(target, "home").last()
    
    current = filter(target, none).last()
    lastKnown = current
    if (!current.end && current.start != target)  current = undefined
    else lastKnown = undefined
[2023-11-14 04:58 PM] Deciusmus: The only thing that doesn't work with the above is that if that you will end a last known = unknown in some cases when you should get a real last known
[2023-11-14 05:00 PM] Deciusmus: You would need to end up with  second check:
    
    if (!lastKnown && !current) filter checking only for whereabouts in the past, and take the one where the end date is closed to target, i.e. where end - target is smallest
[2023-11-14 05:00 PM] Deciusmus: that gives you your last known
[2023-11-14 05:01 PM] Deciusmus: Smallest duration is wrong; we want latest start date
[2023-11-14 05:02 PM] rsulfuratus: right, the trick is to correctly calculate imputed start and imputed end for all entries, and then just do the filter
[2023-11-14 05:02 PM] Deciusmus: right, but actually imputed start is always earliest date and end latest date
[2023-11-14 05:03 PM] Deciusmus: the actual trick is to allow "away" with no end to be found by the filter and then realize (because it has no end) that it isn't a valid "current" location
[2023-11-14 05:04 PM] rsulfuratus: for example, a line with:
    - { type: home, location: home } 
    - { type: away, start = 1535, location: trip }
    
    should return as 
    orgin: home
    home: home
    current: home if target_date `< 1535; trip if target_date == 1535, unknown if target_date >` 1535
    lastknown: home if target_date `< 1535, trip if target_date >`= 1535
[2023-11-14 05:06 PM] rsulfuratus: there is also complication of unknown origin, e.g. 
    - born: 1560
    - whereabouts: 
      - { type: home, start: 1570, location: home }
[2023-11-14 05:06 PM] rsulfuratus: oops
[2023-11-14 05:06 PM] Deciusmus: Yes. So the "filter" will return trip.
    Then this:
    
    if (!current.end && current.start != target)  current = undefined
    else lastKnown = undefined
    
    will fix current.
    
    Then you need to realize that because you have no last known and no current, we need to see if there is a valid date in the past that we could use instead of last known.
    
    So we look for a valid whereabouts in the past and pick the most recent one. home and trip are both valid in the past, but trip is more recent
[2023-11-14 05:07 PM] Deciusmus: Actually ignore that, in that case, we do have a valid last known
[2023-11-14 05:07 PM] Deciusmus: we get in trouble when the home ends and the trip ends
[2023-11-14 05:08 PM] Deciusmus: { type: home, location: home, end  = 1535 }
    { type: away, start = 1535, end = 1537, location: trip }
    
    in that case in 1538, we have no valid locations left. So what's our last known? We have to go hunt for something in the past
[2023-11-14 05:11 PM] rsulfuratus: how would your algorithm handle this if the current date is 1450:
    
    ```yaml
    born: 
    { type: home, start: 1475, end: 1499, location: first home}
    { type: home, start: 1500, end: , location: home}
    ```
[2023-11-14 05:11 PM] rsulfuratus: I guess just return unknown for everything because there are no valid whereabouts?
[2023-11-14 05:11 PM] rsulfuratus: (which should be the correct behavior IMO)
[2023-11-14 05:12 PM] Deciusmus: yup
[2023-11-14 05:12 PM] Deciusmus: the list is empty of valids so everything is unknown
[2023-11-14 05:12 PM] rsulfuratus: but this (which could be considered a data entry error) will I think trip it up:
    ```yaml
    born: 1450
    { type: home, start: 1475, end: , location: home}
    { type: home, start: , end: , location: origin}
    ```
[2023-11-14 05:15 PM] rsulfuratus: my thinking was:
    - pageStart = born or date.min if not born
    - imputed_start = start or pageStart if not start
    - imputed_end = end or imputed_start if not end and type == away; end or date.max if not end and type == home
[2023-11-14 05:15 PM] Deciusmus: no, you don't need any of that
[2023-11-14 05:16 PM] Deciusmus: the imputed starts and ends are meaningless. you just want to assume if there is no start the start is minDate and if no end the end is maxDate
[2023-11-14 05:16 PM] rsulfuratus: in your code I don't think you can have a home with an unknown origin, for example
[2023-11-14 05:16 PM] Deciusmus: then you apply business logic, so to speak, on the result of the match
[2023-11-14 05:16 PM] rsulfuratus: how would you specify origin = unknown, home = home
[2023-11-14 05:17 PM] Deciusmus: { type: home, location: home, start: `<any date>` }
[2023-11-14 05:17 PM] Deciusmus: or, alternatively, start: `<any date after birth>`
[2023-11-14 05:21 PM] rsulfuratus: puzzling over this
[2023-11-14 05:21 PM] Deciusmus: it doesn't quite work for origin
[2023-11-14 05:21 PM] Deciusmus: because it won't pick things in the past
[2023-11-14 05:21 PM] Deciusmus: that's actually the key point, different between "current" vs "current or past"
[2023-11-14 05:25 PM] rsulfuratus: right, so for current dates (home/current location), you never care about anything except picking the valid date and then converting to unknown for current if !end
[2023-11-14 05:26 PM] Deciusmus: right
[2023-11-14 05:27 PM] rsulfuratus: origin is a bit tricker, you need to know where you were when you were born, or the earliest home location you have recorded if you don't know when you were born
[2023-11-14 05:28 PM] rsulfuratus: but actually I think you can just ask for the valid date with target date = born if defined, or date.min if not
[2023-11-14 05:29 PM] Deciusmus: I mean, origin isn't really tricky if we assume all origins have start = empty or start = before born
[2023-11-14 05:29 PM] Deciusmus: as long as the start is equal to or before born, origin is the first home with targetDate = born (and if not found, first home with target date = dateMin)
[2023-11-14 05:31 PM] rsulfuratus: right but I want to be able to code someone as:
    born: 1677
    - { type: home, start: 1700, location: Chardon } #start is approx
[2023-11-14 05:32 PM] Deciusmus: they don't have an origin because start: 1700 is in the future
[2023-11-14 05:32 PM] rsulfuratus: i guess that would work with your as long as start is equal or before born
[2023-11-14 05:32 PM] rsulfuratus: right exactly I want them to be origin unknown
[2023-11-14 05:33 PM] rsulfuratus: >` I mean, origin isn't really tricky if we assume all origins have start = empty or start = before born
    
    this was confusing
[2023-11-14 05:34 PM] rsulfuratus: you can have an unknown origin if you 
    a: have the first line of the whereabouts be { type: home, location: }
    b: have a defined born date, and no home locations that have start `<= born
[2023-11-14 05:34 PM] rsulfuratus: but I think this is what you said
[2023-11-14 05:35 PM] Deciusmus: Yes
[2023-11-14 05:50 PM] Deciusmus: As an aside, I pushed a bunch of template stuff
[2023-11-14 05:51 PM] Deciusmus: look in _testing\headertests
[2023-11-14 05:51 PM] Deciusmus: has the "max" of each type
[2023-11-14 05:51 PM] Deciusmus: you can see what various bits look like by commenting out parts of the yaml
[2023-11-14 05:55 PM] rsulfuratus: ```python
    def filter_whereabouts(whereabouts, target_date, type=None):
        """
        Takes a whereabouts list of dicts, a target date, and optionally a type
        Returns all valid whereabouts for the specified type on the target date
        """
    
        target_date = clean_date(target_date)
    
        valid_whereabouts = `[]`
    
        for entry in whereabouts:
            if type is not None and entry`['type']` != type:
                continue
            else:
                #valid type, or no type specified
                start_date = clean_date(entry`['start']`)
                end_date = clean_date(entry`['end']`, end=True)
                if start_date `<= target_date `<= end_date:
                    valid_whereabouts.append(entry)
    
    
        return valid_whereabouts
    ```
[2023-11-14 05:55 PM] rsulfuratus: writing another function to do the actual selecting of a valid whereabouts
[2023-11-14 05:56 PM] rsulfuratus: will need a little tweaking to work for origin and last known I think
    and forgot the
    ```
                start_date = clean_date(entry`['start']`) if "start" in entry else date.min
                end_date = clean_date(entry`['end']`, end=True) if "start" in entry else date.max
    ```
[2023-11-14 06:03 PM] Deciusmus: you need the option of allowing dates in the past
[2023-11-14 06:12 PM] rsulfuratus: should a function return "unknown" or None/null
[2023-11-14 06:14 PM] Deciusmus: null
[2023-11-14 06:14 PM] Deciusmus: But actually I implemented in Javascript as well for fun and there are lots of little issues
[2023-11-14 06:14 PM] Deciusmus: Basically the line
    
    { type: home, location: origin }
    
    causes lots of headaches
[2023-11-14 06:15 PM] Deciusmus: because it is always valid
[2023-11-14 06:15 PM] rsulfuratus: right, but that is the desired behavior isn't it?
[2023-11-14 06:15 PM] Deciusmus: whats the correct current location for this:
    
    ---
    pageTargetDate: 1500
    whereabouts:
    - { type: home, location: origin }
    - { type: home, end: 1499, location: home }
    ---
[2023-11-14 06:16 PM] rsulfuratus: origin
[2023-11-14 06:16 PM] Deciusmus: ok
[2023-11-14 06:16 PM] Deciusmus: that's easy then
[2023-11-14 06:16 PM] Deciusmus: and whats the right home?
[2023-11-14 06:16 PM] Deciusmus: also origin?
[2023-11-14 06:16 PM] rsulfuratus: yes
[2023-11-14 06:17 PM] rsulfuratus: origin, however, is tricky for that one
[2023-11-14 06:17 PM] rsulfuratus: i guess you just take the lexically first
[2023-11-14 06:17 PM] rsulfuratus: so its fine
[2023-11-14 06:17 PM] rsulfuratus: origin is always origin
[2023-11-14 06:17 PM] Deciusmus: what's the right answers for this?
    ---
    pageTargetDate: 1501
    whereabouts:
    - { type: home, location: origin }
    - { type: home, start: 1401, end: 1499, location: home }
    - { type: away, start: 1500, location: trip }
    ---
[2023-11-14 06:18 PM] rsulfuratus: current: unknown
    last know: trip
    origin: origin
    home: origin
[2023-11-14 06:19 PM] Deciusmus: so basically you expect that we should be setting end:  on the origin line if you want it to not be valid
[2023-11-14 06:20 PM] rsulfuratus: not necessarily. 
    pageTargetDate: 1501
    whereabouts:
    - { type: home, location: origin }
    - { type: home, start: 1401, end: , location: home }
    - { type: away, start: 1500, location: trip }
    
    should report 
    origin: origin
    home: home
    current: unknown
    last known: trip
[2023-11-14 06:20 PM] rsulfuratus: and:
    pageTargetDate: 1501
    whereabouts:
    - { type: home, location: origin }
    - { type: home,  location: home }
    - { type: away, start: 1500, location: trip }
[2023-11-14 06:20 PM] rsulfuratus: should report the same
[2023-11-14 06:21 PM] rsulfuratus: basically, I don't think we should assume that file order takes precedent over validness, it is only used to break ties
[2023-11-14 06:21 PM] Deciusmus: right
[2023-11-14 06:21 PM] Deciusmus: So if you set an END date on home, you better also set an END date on origin
[2023-11-14 06:21 PM] Deciusmus: is the real message
[2023-11-14 06:21 PM] Deciusmus: i.e. 
    
    Guy X came from Chardon, lives in Cleenseau, left Cleenseau in 1719 for parts unknown
[2023-11-14 06:22 PM] rsulfuratus: yes, for that person you need to set end on the Chardon line
[2023-11-14 06:22 PM] Deciusmus: you need to, at the point you are setting end: 1719 on the Cleenseau home line also need to set an end: xxx on the Chardon line, but it could be end: born if you want
[2023-11-14 06:23 PM] Deciusmus: ```
               let originDate = DateManager.parse_date_to_events_date(metadata.born, false) ?? DateManager.parse_date_to_events_date("0001-01-01", false)
                let normalized = metadata.whereabouts.map(f =>` this.getNormalizedWhereabout(f))
               
                let homes = this.filterWhereabouts(normalized, "home", targetDate, false)
                let origins = this.filterWhereabouts(normalized, "home", originDate, false)
               
                whereaboutResult.home = homes.last()
                whereaboutResult.origin = origins.first()
    
                if (whereaboutResult.origin.startDate) whereaboutResult.origin = undefined
    
                let current = this.filterWhereabouts(normalized, undefined, targetDate, false).last()
            
                if (current) {
                    if (targetDate.sort `<= current.awayEnd.sort) {
                        // this away is truely valid
                        whereaboutResult.current = current
                        whereaboutResult.lastKnown = undefined;
                    } else {
                        // this away is our best guess as to location, but we are not still there
                        whereaboutResult.current = undefined
                        whereaboutResult.lastKnown = current;
                    }
    
                    return whereaboutResult
                }
    
                // this means we don't have a current whereabout - everything is in the past
                whereaboutResult.lastKnown = this.filterWhereabouts(normalized, undefined, targetDate, true).last()                   
    ```
[2023-11-14 06:23 PM] Deciusmus: is my working code
[2023-11-14 06:23 PM] rsulfuratus: Guy X came from Chardon, lives in Cleenseau, left Cleenseau in 1719 to go back to Chardon could be:
    - { type: home, location: Chardon }
    - { type: home, start 1700, end 1719, location: Cleenseau }
[2023-11-14 06:24 PM] Deciusmus: where filter whereabouts is:
    
    ```
        get_distance_to_target(item, target) {    
            if (item.logicalEnd.sort `< target.sort) { 
                return target.jsDate - item.logicalEnd.jsDate
            }
            else return target.jsDate - item.logicalStart.jsDate
        }
    
        filterWhereabouts(whereaboutsList, type, target, allowPast) {
            let candidateSet = whereaboutsList.filter(w =>` (!type || w.type == type) && (w.logicalStart.sort `<= target.sort)).filter(w =>` allowPast || target.sort `<= w.logicalEnd.sort)
            let soonestPossible =   Math.min(...candidateSet.map(w =>`  this.get_distance_to_target(w, target)))           
            return candidateSet.filter(w =>`  this.get_distance_to_target(w, target) == soonestPossible)
        }
    ```
[2023-11-14 06:24 PM] rsulfuratus: oof I hate reading javascript code especially after working in python
[2023-11-14 06:24 PM] Deciusmus: yeah
[2023-11-14 06:24 PM] Deciusmus: I gotta go deal with dinner anyway
[2023-11-14 06:36 PM] rsulfuratus: could maybe add affiliations to people notes?
[2023-11-14 06:36 PM] rsulfuratus: might be too much clutter
[2023-11-14 06:36 PM] Deciusmus: Yeah, maybe ‚Äúmember of: ‚Äú
[2023-11-14 06:37 PM] Deciusmus: Just not sure whether to put it before the dated stuff or after
[2023-11-14 06:37 PM] Deciusmus: I could do it below the pronoun line
[2023-11-14 06:38 PM] rsulfuratus: that is where I'd put it
[2023-11-14 06:38 PM] Deciusmus: I added ‚ÄúrulerOf‚Äù to rulers
[2023-11-14 06:38 PM] Deciusmus: It might also be worth mapping family
[2023-11-14 06:39 PM] rsulfuratus: if you want to get really fancy, you'd parse organization frontmatter and have separate report for family/clan vs other
[2023-11-14 06:39 PM] Deciusmus: Something like:
    Ruler of (kingdom) of (family)
    Member of : (a), (b), (c)
[2023-11-14 06:40 PM] Deciusmus: Or for non rulers
    
    Of (family)
    Member of: (ab), (c)
[2023-11-14 06:40 PM] rsulfuratus: yeah
[2023-11-14 06:40 PM] Deciusmus: Not sure if I like it
[2023-11-14 06:40 PM] Deciusmus: But I might play around after dinner
[2023-11-14 06:41 PM] rsulfuratus: might also try:
    Person, Of Family
[2023-11-14 06:41 PM] rsulfuratus: at least for rulers, e.g., 
    Queen Some NPC of the House of HouseName
[2023-11-14 06:42 PM] rsulfuratus: might be overkill for non-rulers, e.g. 
    Ander of the Charmhearts
[2023-11-14 06:43 PM] rsulfuratus: would prefer just 
    Name Family
[2023-11-14 06:43 PM] rsulfuratus: that is assuming we use metadata for family instead of affiliations - not sure which is best
[2023-11-14 07:12 PM] Deciusmus: Name Family is tricky because I don‚Äôt love the link in the header
[2023-11-14 07:12 PM] Deciusmus: I also think we should add partOf to organizations
[2023-11-14 07:13 PM] Deciusmus: So I could have 
    Army Garrison of Cleenseau - partOf - Army of the West - partOf - Sembaran Army
[2023-11-14 07:13 PM] Deciusmus: And I might change rulerOf to leaderOf and also use it for my organizations
[2023-11-14 07:16 PM] Deciusmus: Was also thinking orgType - and use that to find if something is a family or not
[2023-11-14 07:18 PM] Deciusmus: It‚Äôs easier on the organization page to just have a 
    
    # Members
    Dataview query that gets everyone with affialiation contains this.file
[2023-11-14 08:39 PM] rsulfuratus: yeah
[2023-11-14 08:39 PM] rsulfuratus: definitely think partOf makes sense for orgs
[2023-11-14 08:40 PM] rsulfuratus: I wrote a python function that converts DR to CY
[2023-11-14 08:40 PM] rsulfuratus: putting my python date code in dateFunctions.py
[2023-11-14 08:40 PM] rsulfuratus: all of them take strings and can return strings instead of datetime objects
[2023-11-14 08:41 PM] Deciusmus: I'm not sure how to use a DR to CY
[2023-11-14 08:41 PM] Deciusmus: because... I need to know the source date
[2023-11-14 08:41 PM] Deciusmus: I think we should get rid of get_home vs get_current for whereabouts
[2023-11-14 08:41 PM] Deciusmus: so the template is just a single get_whereabouts
[2023-11-14 08:42 PM] rsulfuratus: what i was actually doing is trying to figure out how to go DR to CY, which is more useful, since you can't have negative dates
[2023-11-14 08:42 PM] rsulfuratus: at least with python date objects
[2023-11-14 08:42 PM] rsulfuratus: so the idea is all comparisons are done internally in dwarven years, and then converted back to DR for display
[2023-11-14 08:42 PM] rsulfuratus: but actually it was just to see if I could come up with a reasonable calculator
[2023-11-14 08:43 PM] Deciusmus: I'd like to be able to do 1111 DR vs 3333 CY in display but haven't quite figured it out
[2023-11-14 08:44 PM] rsulfuratus: 
![[../_discord_assets/image-3ECF9.png]]
[2023-11-14 08:44 PM] rsulfuratus: ```python
    def dr_to_cy(value):
            """
            Takes as input a date in DR format and returns a date in CY format
            Dwarven calendar (CY) is 365 days from March 17 - March 16. Day 1 is March 17, Day 365 is March 16 of the following year
            DR "date 1" begins on January 1st, 4133 CY
            So Jan 1, 1 DR is Day 289 of CY 4133. 
            Mar 17, 1 DR is Day 1 of CY 4134
    
            A DR date from Jan 1 to Mar 16 is CY 4133-DR-1, and the CY day is 365 - (Mar 16 - DR day)
            A DR date from Mar 17 to Dec 31 is CY 4134-DR-1, and the CY day is DR day - Mar 16
            """
            year,month,day = clean_date(value, return_string=True).split('-')
            if int(month) `< 3 or int(month) == 3 and int(day) `< 17:
                cy_day = str(365 - (date(1,3,16)-date(1,int(month),int(day))).days)
                cy_date = datetime.strptime("2001" + "-" + cy_day, "%Y-%j").strftime("%Y-%m-%d")
                cy_year = 4133 + int(year) - 1
                return date(cy_year, int(cy_date.split('-')`[1]`), int(cy_date.split('-')`[2]`))
            else:
                cy_day = str((date(1,int(month),int(day))-date(1,3,16)).days)
                cy_date = datetime.strptime("2001" + "-" + cy_day, "%Y-%j").strftime("%Y-%m-%d")
                cy_year = 4132 + int(year)
                return date(cy_year, int(cy_date.split('-')`[1]`), int(cy_date.split('-')`[2]`))
        
    ```
[2023-11-14 08:45 PM] rsulfuratus: oh wait its off by a year
[2023-11-14 08:46 PM] rsulfuratus: `cy_year = 4132 + int(year)` should be `cy_year = 4133 + int(year)`
[2023-11-14 08:54 PM] Deciusmus: Dead person:
![[../_discord_assets/image-EFDCE.png]]
[2023-11-14 08:54 PM] rsulfuratus: negative numbers only work with plain years:
[2023-11-14 08:54 PM] rsulfuratus: 
![[../_discord_assets/image-49684.png]]
[2023-11-14 08:54 PM] rsulfuratus: how do you calculate killed location?
[2023-11-14 08:54 PM] rsulfuratus: just current for died date?
[2023-11-14 08:54 PM] Deciusmus: it is the "current" location of where they died
[2023-11-14 08:54 PM] Deciusmus: 
![[../_discord_assets/image-99D18.png]]
[2023-11-14 08:55 PM] Deciusmus: more specifically, the whereabouts logic just returns a "current" for the target date, but it doesn't know if the person is dead or alive
[2023-11-14 08:55 PM] Deciusmus: So the current location means at that date, the person was there. But the script knows they are dead, so switches to killed
[2023-11-14 08:56 PM] rsulfuratus: i guess it would be fairly silly to worry about the situation where a body is moved after they die
[2023-11-14 08:56 PM] rsulfuratus: you wouldn't track that with whereabouts anyway
[2023-11-14 08:57 PM] Deciusmus: right
[2023-11-14 09:01 PM] Deciusmus: if the person was killed without a current location:
![[../_discord_assets/image-1B9D8.png]]
[2023-11-14 09:02 PM] Deciusmus: that is where the "Valit" whereabout has no end date (whereas the previous example it had an end date >` target)
[2023-11-14 09:03 PM] Deciusmus: slightly annoyingly, the logic doesn't quite work for people killed in the past
[2023-11-14 09:05 PM] Deciusmus: aha, but if the page is dead I can just used the death date for whereabouts
[2023-11-14 09:05 PM] Deciusmus: works great
[2023-11-14 09:26 PM] Deciusmus: Should I push this to main? I have deleted get_CurrentWhereabouts and get_HomeWhereabouts and replaced with a new get_Whereabouts
[2023-11-14 09:26 PM] Deciusmus: So we will need to rerun template on all files to get back to good state
[2023-11-14 09:26 PM] rsulfuratus: yes, that's fine. it will break headers but easy to fix
[2023-11-14 09:26 PM] Deciusmus: I have an affiliations thing working as well and family
[2023-11-14 09:27 PM] rsulfuratus: main issue might be exports will be quite bad
[2023-11-14 09:27 PM] Deciusmus: based on orgType: family in the organization page
[2023-11-14 09:27 PM] Deciusmus: i.e. if you have
    
    affiliations: `[a, b]`
    
    and a has orgType: family
    
    we parse that as the family. If there are multiple familes we take the first
[2023-11-14 09:28 PM] Deciusmus: 
![[../_discord_assets/image-FF012.png]]
[2023-11-14 09:31 PM] Deciusmus: pushed
[2023-11-14 09:35 PM] Deciusmus: I might spend some time in a bit fixing real data, so if you want to take a minute to make sure you are happy with the templates would be good
[2023-11-14 09:35 PM] Deciusmus: although not hard to recreate
[2023-11-14 09:38 PM] rsulfuratus: do you have test data?
[2023-11-14 09:38 PM] rsulfuratus: for whereabouts
[2023-11-14 09:39 PM] rsulfuratus: also at least on my computer the template code needs to output an extra newline
[2023-11-14 09:39 PM] Deciusmus: yeah I was output to fix that
[2023-11-14 09:40 PM] rsulfuratus: Alban has a bug
[2023-11-14 09:40 PM] rsulfuratus: '_scripts/view/get_Whereabouts.js'.
    
    TypeError: Cannot read properties of undefined (reading 'startDate')
[2023-11-14 09:44 PM] rsulfuratus: looks like you don't accept full dates for home starts?
[2023-11-14 09:45 PM] Deciusmus: it should
[2023-11-14 09:45 PM] Deciusmus: that bug is that if there is no origin it doesn't work
[2023-11-14 09:45 PM] rsulfuratus: Dataview: Failed to execute view '_scripts/view/get_Whereabouts.js'.
    
    TypeError: Cannot read properties of undefined (reading 'startDate')
[2023-11-14 09:45 PM] rsulfuratus: for Casian as well
[2023-11-14 09:46 PM] rsulfuratus: both fixed by deleted MM-DD from start
[2023-11-14 09:46 PM] Deciusmus: fix pushed
[2023-11-14 09:47 PM] Deciusmus: deleting  the dates from start actually changes the underlying logic and makes the first line eligible to be an origin
[2023-11-14 09:47 PM] Deciusmus: i.e with 
    born: 1722
    whereabouts:
    - {type: home, start: 1722-01-02, end: '', location: 'Chardon, Chardonian Empire'}
    
    Casian doesn't have an origin, as Chardon is >` birth date
[2023-11-14 09:47 PM] rsulfuratus: right but it is okay to not have an origin
[2023-11-14 09:47 PM] Deciusmus: but 
    
    - {type: home, start: 1722, end: '', location: 'Chardon, Chardonian Empire'}
    
    Chardon is a valid origin
[2023-11-14 09:48 PM] Deciusmus: Yes, but that was the bug
[2023-11-14 09:48 PM] Deciusmus: Just a missing null check
[2023-11-14 09:48 PM] Deciusmus: I pushed a fix
[2023-11-14 09:48 PM] rsulfuratus: ```yaml
    whereabouts:
    - {type: home, start: '', end: '', location: 'Luminatia, Chardonian Empire'}
    - {type: away, start: 1748-03-11, end: '', location: ''}
    ```
[2023-11-14 09:48 PM] rsulfuratus: generates nothing
[2023-11-14 09:49 PM] Deciusmus: what page is that
[2023-11-14 09:49 PM] rsulfuratus: Claudio
[2023-11-14 09:50 PM] rsulfuratus: adding location: unknown to the last line generates
![[../_discord_assets/image-3EAF2.png]]
[2023-11-14 09:59 PM] Deciusmus: what are you expecting the above to output?
[2023-11-14 09:59 PM] rsulfuratus: i am expected same output if location: "" or if location: "unknown"
[2023-11-14 10:00 PM] rsulfuratus: either both should just report "Based in Luminatia" or both should report "Based, Last known: unknown, Current: unknown"
[2023-11-14 10:00 PM] rsulfuratus: probably the latter
[2023-11-14 10:01 PM] rsulfuratus: or perhaps no last known
[2023-11-14 10:01 PM] Deciusmus: The lack of "Based in Luminatia was just a bug
[2023-11-14 10:01 PM] Deciusmus: I was forgetting to return anything if there was no last known and also no current
[2023-11-14 10:01 PM] Deciusmus: Or rather, if there WAS a last known but without a location
[2023-11-14 10:02 PM] Deciusmus: But then the question is:
    what is the output if the current or last known whereabout does not have a location
[2023-11-14 10:02 PM] Deciusmus: Outputing "last known: unknown" seems pointless
[2023-11-14 10:02 PM] Deciusmus: But presumably you added the away line for a reason
[2023-11-14 10:02 PM] Deciusmus: I guess maybe Current location: unknown is the right thing to output here?
[2023-11-14 10:03 PM] rsulfuratus: this is the dad of the boy you talked to on the sending stone
[2023-11-14 10:03 PM] rsulfuratus: he left home, but no one knows where
[2023-11-14 10:03 PM] Deciusmus: right
[2023-11-14 10:03 PM] rsulfuratus: but he might return so just putting an end on home is not quite right
[2023-11-14 10:04 PM] Deciusmus: Right. I think 
    
    Based in: xxx
    Current location: Unknown 
    
    is correct
[2023-11-14 10:07 PM] Deciusmus: The core whereabout function was returning the right thing... a last known whereabout with location = null
[2023-11-14 10:08 PM] Deciusmus: but I think the right thing to do is basically treat location: "" as the same as location: unknown, except it won't output the last known whereabouts
[2023-11-14 10:09 PM] Deciusmus: fix pushed
[2023-11-14 10:13 PM] rsulfuratus: i'd consider getting rid of the "Last" in "Last met", and instead just capitolize the first letter of whatever is in type for campaign info
[2023-11-14 10:13 PM] rsulfuratus: then you can have:
![[../_discord_assets/image-2623B.png]]
[2023-11-14 10:14 PM] rsulfuratus: fausto has an organization bug
[2023-11-14 10:15 PM] rsulfuratus: 
![[../_discord_assets/image-8A899.png]]
[2023-11-14 10:15 PM] rsulfuratus: same with Galen
[2023-11-14 10:15 PM] rsulfuratus: anyone with more than one organization looks like there is a bug in the display
[2023-11-14 10:16 PM] Deciusmus: I was just looking at that
[2023-11-14 10:17 PM] rsulfuratus: this might be a little much as far as informaiton goes:
![[../_discord_assets/image-7BC84.png]]
[2023-11-14 10:18 PM] rsulfuratus: but i guess there is nothing obvious to remove
[2023-11-14 10:20 PM] Deciusmus: Pushed a fix for the Fausto bug
[2023-11-14 10:20 PM] Deciusmus: the actual issue is that the affiliation link was to a non-existent file
    
    (The Society of the Open Scroll, rather than Society of the Open Scroll)
[2023-11-14 10:21 PM] Deciusmus: Change the affiliation block to a pointer to an actual file and it will work
[2023-11-14 10:21 PM] Deciusmus: but also I pushed a fix
[2023-11-14 10:28 PM] rsulfuratus: 
![[../_discord_assets/image-6C43D.png]]
[2023-11-14 10:28 PM] rsulfuratus: whereabouts: 
    - { type: "away", start: "", end: 1750, location: Mirror of Soul Trapping }
[2023-11-14 10:31 PM] rsulfuratus: I'm going to bed now, generally I think these look great
[2023-11-14 10:31 PM] rsulfuratus: a few small bugs still but seems very smooth
[2023-11-14 10:32 PM] rsulfuratus: still have the issue of export - it would really help to have a bunch of yaml that you test on that I can verify behaves the same
[2023-11-14 10:32 PM] rsulfuratus: probably not going to touch that until this weekend, we'll see
[2023-11-14 10:32 PM] Deciusmus: whereabouts with type away and no start date is defined as invalid
[2023-11-14 10:32 PM] Deciusmus: per the spe
[2023-11-14 10:32 PM] Deciusmus: maybe that's wrong, but thats why the failure
[2023-11-14 10:33 PM] rsulfuratus: right, of course
[2023-11-14 10:34 PM] rsulfuratus: that might be one where it is easier to just use a fudged start
[2023-11-14 10:34 PM] rsulfuratus: end is fudged too obviously
[2023-11-14 10:34 PM] Deciusmus: I mean, if I delete my assertion it works fine
[2023-11-14 10:35 PM] Deciusmus: 
![[../_discord_assets/image-23652.png]]
[2023-11-14 10:35 PM] rsulfuratus: maybe there is no reason away must have a start
[2023-11-14 10:35 PM] Deciusmus: yeah I think with the new algo it makes no sense to assert on it or require it
[2023-11-14 10:35 PM] Deciusmus: because lack of start just means start = earliest possible date
[2023-11-14 10:36 PM] Deciusmus: which is fine, for Revaka (who doesn't have a born date) you just want to report her in the mirror of soul trappin for all dates
[2023-11-14 10:36 PM] rsulfuratus: right
[2023-11-14 10:38 PM] rsulfuratus: it is probably not worth recoding stuff, but there is some logic in having a third type that is not home but behaves like home, that is lets you have indefinte start/end
[2023-11-14 10:38 PM] rsulfuratus: e.g. for Revaka, you'd ideally want just:
    - { type: "something", start:, end:, location: mirror }
[2023-11-14 10:39 PM] rsulfuratus: it is just like home but reports "Current location" instead of "Based in"
[2023-11-14 10:39 PM] rsulfuratus: or you could just use home/away, but add an optional display variable
[2023-11-14 10:39 PM] Deciusmus: But type: away with no start date does report Current location
[2023-11-14 10:40 PM] rsulfuratus: e.g., 
    - { type: "home", start, end, location: mirror, display: "Trapped in: " }
[2023-11-14 10:40 PM] Deciusmus: Ah, instead of Current location
[2023-11-14 10:40 PM] Deciusmus: is that worth it?
[2023-11-14 10:40 PM] rsulfuratus: type away with no start and no end doesn't work
[2023-11-14 10:40 PM] Deciusmus: that is true, you need a fudged end
[2023-11-14 10:41 PM] rsulfuratus: it is probably easily to add an optional displayDefaults for homeString that overwrites the normal logic
[2023-11-14 10:42 PM] Deciusmus: eh, type: away with no start and end works now üôÇ
[2023-11-14 10:43 PM] rsulfuratus: not for me
[2023-11-14 10:43 PM] Deciusmus: I haven't pushed the fix
[2023-11-14 10:44 PM] rsulfuratus: ah
[2023-11-14 10:44 PM] Deciusmus: The logic is just to say that an away with no start or end is just like a home with no start or end -- it is valid for all time
[2023-11-14 10:44 PM] Deciusmus: but because there is no home, you get "current" instead of "home"
[2023-11-14 10:45 PM] rsulfuratus: i still think it is clearer to have a way to overwrite the default text
[2023-11-14 10:46 PM] Deciusmus: pushed
[2023-11-14 10:46 PM] Deciusmus: I actually like the type: away no date. It models nicely the idea of someone who is
    (a) somewhere
    (b) for an undefined and therefore infinite period of time
    (c) but it isn't there home
[2023-11-14 10:47 PM] Deciusmus: It is different from away with a start and no end, which implies traveling. This version (no start, no end) implies some permanent non-home state
[2023-11-14 10:52 PM] rsulfuratus: why doesn't this generate a correct location for last seen by party?
    - {type: home, start: '', end: '', location: unknown}
    - {type: home, start: 1733-01-02, end: '', location: 'Tollen, Western Green Sea'}
![[../_discord_assets/image-EB19E.png]]
[2023-11-14 10:56 PM] Deciusmus: Hrm
[2023-11-14 10:56 PM] Deciusmus: Not sure. Not at my computer anymore so can‚Äôt easily look
[2023-11-14 10:57 PM] Deciusmus: The second home should be the current whereabout at dec 30 1748
[2023-11-14 10:58 PM] Deciusmus: There might be some bug in how the template handles current vs home but it shouldn‚Äôt care about home
[2023-11-14 10:58 PM] rsulfuratus: doesn't really matter right now
[2023-11-14 10:59 PM] rsulfuratus: i have to put this aside for a bit, have two sessions worth of session notes to write from two different games plus a massive battle to prep
[2023-11-14 10:59 PM] Deciusmus: Yeah that makes sense
[2023-11-14 10:59 PM] rsulfuratus: before i do any work on the python end of things I need to develop a really robust set of testing whereabouts
[2023-11-14 11:00 PM] rsulfuratus: it is easy to test the functions in a notebook but really annoying to test against actual obsidian notes
[2023-11-14 11:01 PM] rsulfuratus: i got chatgpt to convert your whereabouts code to python which actually looks fairly reasonable.
[2023-11-14 11:01 PM] rsulfuratus: i looked at just using it directly but the date stuff makes that a real pain
[2023-11-14 11:01 PM] rsulfuratus: (e..g with that javascript-to-python bridge)
[2023-11-14 11:02 PM] Deciusmus: I think my code handles string dates just fine
[2023-11-14 11:02 PM] rsulfuratus: no, i mean, i'd have to load all your DateManager stuff too, because it is too embedded in the whereabouts to use the whereabouts and not the Datamanager
[2023-11-14 11:03 PM] Deciusmus: Ah. I could trivially merge those though

