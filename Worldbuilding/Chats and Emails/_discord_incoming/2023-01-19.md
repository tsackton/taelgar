# Discord DM â€“ 2023-01-19

[2023-01-19 01:11 PM] rsulfuratus: do you know lua at all?
[2023-01-19 02:00 PM] Deciusmus: not really
[2023-01-19 02:00 PM] Deciusmus: I fixed the undefined born bug
[2023-01-19 02:00 PM] Deciusmus: in javascript, new Date(1) means 1901
[2023-01-19 02:00 PM] Deciusmus: ðŸ˜¦
[2023-01-19 02:00 PM] Deciusmus: you have to do
    date.setFullYear(1)
[2023-01-19 02:01 PM] Deciusmus: there were also some weird timezone issues so I changed the date comparisions to just generate normalized strings (YYYYMMDD) and lexically compare them
[2023-01-19 02:04 PM] rsulfuratus: awesome
[2023-01-19 02:06 PM] rsulfuratus: I was looking at a pandoc workflow to push obsidian md to gdrive  for e.g. party treasure, but ideally want to convert links to taelgarverse; there is a way to write pandoc filters using lua which should be able to do that
[2023-01-19 02:08 PM] rsulfuratus: also just pushed a commit that adds type to all notes in people - need to think about organizations a bit but just for now added type = Organization to families, dynasties/ruling houses, organizations, basically anything that refers to a collection of more than one person
[2023-01-19 06:18 PM] rsulfuratus: there are a few bugs in the lastSeenByParty code:
    1) this syntax doesn't seem to work, as far as I can tell: `metadata`["lastSeenByParty_" + config.campaignPrefix]`;`
    2) this `lastSeen = metadata.whereabouts.findLast(s =>` compare_dates(s.date,lastSeenByPartyDate) `<= 0);` assumes the lastSeenByParty date will be js, not yaml, so you get a `TypeError: jsDate.getUTCFullYear is not a function` bug when you hit that code
[2023-01-19 06:56 PM] Deciusmus: fixed that
[2023-01-19 06:56 PM] Deciusmus: this does work: metadata`["lastSeenByParty_" + config.campaignPrefix]`
[2023-01-19 06:56 PM] Deciusmus: the bug was that my template passed the config data as configData rather than config so the config.campaignPrefix was always undefined
[2023-01-19 07:08 PM] rsulfuratus: great, works now
[2023-01-19 07:08 PM] rsulfuratus: after playing around with locations for a bit, a few comments:
[2023-01-19 07:09 PM] rsulfuratus: 1) first, it really fun to have this info and runs the risk of spending too much time making up backstory for minor character as they travel around the world, but that's okay and part of the appeal
[2023-01-19 07:11 PM] rsulfuratus: 2) I think it would be useful to have a parameter to get_Whereabouts that turns off the checks for identity, and just displays all dates that exist, for a few NPCs where I want to see whether they are actually from where they live now
[2023-01-19 07:11 PM] rsulfuratus: (that is, there is a difference between "I've decided Kaeso was born in Chardon" and "I don't know where Kaeso was born"
[2023-01-19 07:12 PM] rsulfuratus: currently that information cannot be seen in the header for two reasons: first because if home = origin then only home is displayed, and second because origin is just the first date you find, and home is the most recent non-excursion
[2023-01-19 07:13 PM] rsulfuratus: ideally origin should be where you are when you are born, and undefined otherwise,
[2023-01-19 07:14 PM] rsulfuratus: 3) I think I would probably always have the last seen by party display, even if it matches home. I'm not going to bother setting the metadata unless I can about when/where the party last saw this person, so it is useful to display it if it exists no matter what
[2023-01-19 07:50 PM] Deciusmus: Easy to change party. What about a get_AllWhereabouts that just outputs everything?
[2023-01-19 08:06 PM] Deciusmus: Add:
    
      "whereaboutsSettings": {
        "alwaysShowPartyLocation": true
      }
[2023-01-19 08:07 PM] Deciusmus: to your taelgarConfig.json
[2023-01-19 08:07 PM] Deciusmus: and pull
[2023-01-19 08:10 PM] rsulfuratus: I am going to mess around for 20 minutes with making origin only set if the first date is the same as the born date, instead of just grabbing the first date after born to be the origin. in the situation where born is not set, origin implies 0001-01-01, anything else implies unknown origin
[2023-01-19 08:34 PM] Deciusmus: 
![[../_discord_assets/image-FEFF6.png]]
[2023-01-19 08:35 PM] rsulfuratus: the full location history could get long though for some people
[2023-01-19 08:35 PM] Deciusmus: I don't love having the location block have "unknown" origin for all the random folks for who it isn't set
[2023-01-19 08:36 PM] rsulfuratus: it shouldn't display unknown
[2023-01-19 08:36 PM] Deciusmus: I'm not quite picturing what you are trying to do then
[2023-01-19 08:36 PM] Deciusmus: Ah
[2023-01-19 08:36 PM] rsulfuratus: if origin == home, display both. if first date is not born date, that location is home, not origin
[2023-01-19 08:37 PM] rsulfuratus: I have the display both working the same way you did, with a config option in taelgar json
[2023-01-19 08:37 PM] Deciusmus: the full location history is just  a separate template:
    
    `<% tp.user.locationHistory(tp) %>`
[2023-01-19 08:37 PM] Deciusmus: you can add it if you want
[2023-01-19 08:38 PM] rsulfuratus: ah, nice. that is great
[2023-01-19 08:38 PM] rsulfuratus: ```
     "whereaboutsSettings": {
        "alwaysShowPartyLocation": true,
        "alwaysShowOrigin" : true,
        "alwaysShowLocation": true
      }
    ```
[2023-01-19 08:39 PM] rsulfuratus: this should work with what I just pushed. there is still some off-by-one bug with born dates that have month/day (might just revert that, the only NPC I care about is Jumi for this)
[2023-01-19 08:40 PM] rsulfuratus: also still need to fix the situation where all days are excursions and not equal to birth date so no home and no origin, but the current setup doesn't display party seen location unless home exists, so trying to fix that too
[2023-01-19 08:41 PM] Deciusmus: 
![[../_discord_assets/image-291E6.png]]
[2023-01-19 08:42 PM] Deciusmus: No fancy auto-replace of the block
[2023-01-19 08:43 PM] Deciusmus: but you can just select it and re-run the location-history template
[2023-01-19 08:43 PM] rsulfuratus: that's fine, it is easy to delete and rerun
[2023-01-19 08:43 PM] rsulfuratus: might want to put that anywhere in a note
[2023-01-19 08:43 PM] Deciusmus: right
[2023-01-19 08:43 PM] Deciusmus: or even inside a `%%`SECRET`%%` or `%%`Campaign`%%` block
[2023-01-19 08:43 PM] Deciusmus: at the moment it doesn't stop with the current year, although it probably should
[2023-01-19 08:43 PM] Deciusmus: that is, not show locations >` the current fantasy cal date
[2023-01-19 08:44 PM] Deciusmus: but honestly, not much point as it isn't dynamic
[2023-01-19 08:44 PM] rsulfuratus: yeah that doesn't seem necessary, can always manually delete future dates if needed
[2023-01-19 08:44 PM] Deciusmus: right, but then pushing will get silly
[2023-01-19 08:44 PM] rsulfuratus: ah, true
[2023-01-19 08:45 PM] Deciusmus: its better to just add the `%%` blocks to strip from export if needed
[2023-01-19 08:45 PM] rsulfuratus: yeah
[2023-01-19 08:45 PM] Deciusmus: you didn't push anything btw
[2023-01-19 08:45 PM] Deciusmus: or if you did it wasn't to main
[2023-01-19 08:45 PM] rsulfuratus: just pushed
[2023-01-19 08:45 PM] rsulfuratus: was trying to fix a few remaining bugs first
[2023-01-19 08:52 PM] Deciusmus: I guess the idea of the change is the convention would be to use xxx-01-02 as the date for "unknown origin, here's home"
[2023-01-19 08:53 PM] rsulfuratus: yes, exactly. which is what your frontmatter converter already does when home is set and origin is blank
[2023-01-19 08:54 PM] Deciusmus: right ok
[2023-01-19 08:54 PM] Deciusmus: so the main difference is that it will now show origin date for people even if the same as based
[2023-01-19 08:54 PM] rsulfuratus: if "alwaysShowOrigin" : true is set in the config
[2023-01-19 08:55 PM] rsulfuratus: otherwise it will show origin only if different from based
[2023-01-19 08:56 PM] Deciusmus: right
[2023-01-19 08:56 PM] Deciusmus: it would be nice to skip current location for dead people
[2023-01-19 08:57 PM] Deciusmus: and change Based in to Lived in
[2023-01-19 08:57 PM] rsulfuratus: I often set current location to deceased, place died, region died for dead people
[2023-01-19 08:58 PM] Deciusmus: My use case at the moment is Sembaran royalty
[2023-01-19 08:58 PM] rsulfuratus: ah. right. my use case is people you have killed
[2023-01-19 08:58 PM] Deciusmus: I have 15+ of them, and mostly don't care to set the locations, but there are a small number where I care that they came from somewhere
[2023-01-19 08:59 PM] Deciusmus: right. People who died in an active campaign, the actual date of death rather than just year is nice
[2023-01-19 08:59 PM] Deciusmus: but for example, I have Jane of Tollen. Who is notable for coming from Tollen
[2023-01-19 08:59 PM] Deciusmus: It would be nice if I could just set originally from
[2023-01-19 09:00 PM] Deciusmus: But honestly, maybe having a "historical:" tag or something that changes behavior would be better
[2023-01-19 09:00 PM] rsulfuratus: yes that should be easy when I get what I'm working on working
[2023-01-19 09:00 PM] Deciusmus: Which is to say... I don't know if it actually makes sense to change current location for dead people, as your way is nice for true NPCs
[2023-01-19 09:01 PM] rsulfuratus: yeah I kind of like location being unaffected by alive/dead status
[2023-01-19 09:01 PM] Deciusmus: It might be better to have a historical: true yaml element (or a tag or HistoricalPerson) that just changes behavior a bit
[2023-01-19 09:01 PM] Deciusmus: for example, doesn't bother with whereabouts and just uses the old home/origin tags
[2023-01-19 09:02 PM] Deciusmus: alternatively, maybe it is a type: HistoricalNPC
[2023-01-19 09:02 PM] Deciusmus: or type: HistoricalPerson
[2023-01-19 09:02 PM] rsulfuratus: historicalPerson as a type might be a good idea
[2023-01-19 09:03 PM] Deciusmus: then supports whereabouts can be set false
[2023-01-19 09:03 PM] Deciusmus: and it just falls back to the old home/homeregion stuff
[2023-01-19 09:03 PM] Deciusmus: I've been messing around with Wikipedia style royalty boxes
[2023-01-19 09:04 PM] Deciusmus: 
![[../_discord_assets/image-D65D2.png]]
[2023-01-19 09:04 PM] rsulfuratus: ooh that is nice
[2023-01-19 09:04 PM] Deciusmus: I like having predecessor and successor so I can click through and make sure I didn't overlap reigns or have someone have a child at 12 or 82
[2023-01-19 09:04 PM] rsulfuratus: okay here is a javascript question for you - we have all these comparisons lastSeen.place == home.place  etc that assume a home place exists, but one doesn't have to if all locations are excursions
[2023-01-19 09:05 PM] Deciusmus: I think you can do:
    
    if (home == undefined) let home = {}
[2023-01-19 09:05 PM] Deciusmus: then home.place will evaluate to undefined
[2023-01-19 09:05 PM] rsulfuratus: ah perfect
[2023-01-19 09:05 PM] Deciusmus: which is not equal to lastSeen.place
[2023-01-19 09:06 PM] Deciusmus: the config checking would be nicer to do that as well
[2023-01-19 09:06 PM] Deciusmus: i.e. once the config is read from JSON do:
    
    if (config.whereaboutsSettings == undefined) config.whereaboutsSettings = {}
[2023-01-19 09:06 PM] Deciusmus: then you can just check the bools directly without the protection
[2023-01-19 09:10 PM] Deciusmus: This is what I am aiming for for rulers:
![[../_discord_assets/image-DFED9.png]]
[2023-01-19 09:11 PM] Deciusmus: It would, I think, be generatable off:
    
    * kingdoms: `[...]` (but usually just one)
[2023-01-19 09:11 PM] Deciusmus: * reignStart/reignEnd with the ability to do reignStart_kingdom for complex cases
[2023-01-19 09:12 PM] Deciusmus: predecessor and predecessor_kingdom
    parents: `[]`
[2023-01-19 09:13 PM] Deciusmus: anyway, signing off for now but will mess around more with rulers later. I'm going to try to get something working with a single kingdom first
[2023-01-19 09:13 PM] Deciusmus: although there are some cases in Sembaran history in particular where the crown passes between tyrwingha and sembara
[2023-01-19 09:25 PM] rsulfuratus: pushed update, based on preliminary testing should work as follows:
[2023-01-19 09:26 PM] rsulfuratus: If alwaysShow (origin, location, partyseen) is set, will always display Originally from: , Currently located, and Last seen as long as they are not undefined
[2023-01-19 09:26 PM] rsulfuratus: each can be set independently in taelgarConfig.json as above in chat, same as what you added for partySeen
[2023-01-19 09:26 PM] rsulfuratus: origin is defined as the location at birth
[2023-01-19 09:27 PM] rsulfuratus: home is defined as the most recent non-excursion location, strictly after birth
[2023-01-19 09:27 PM] rsulfuratus: current follows same rules, but doesn't ignore excursions
[2023-01-19 09:28 PM] rsulfuratus: so if only date is BORN-01-01, then will only display "Originally from: " and not "Based in: " or "Currently: " (but I might make currently still work in this scenario)
[2023-01-19 09:29 PM] rsulfuratus: I'm going to play around over the weekend and see what we think; can tweak further if needed / desired
[2023-01-19 09:29 PM] rsulfuratus: generally convention is to set BORN-01-01 for origin, BORN-01-02 for home location; or just set BORN-01-02 for home location where origin is undetermined / unimportant
[2023-01-19 09:31 PM] rsulfuratus: requires a little bit of extra text if you want to display Based in: instead of Originally from: when home = origin as you need to set both 01-01 and 01-02 and have alwaysShowOrigin = false
[2023-01-19 09:31 PM] rsulfuratus: anyway, signing off now will fiddle more over the weekend

