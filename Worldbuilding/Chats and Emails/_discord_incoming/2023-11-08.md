# Discord DM â€“ 2023-11-08

[2023-11-08 11:04 AM] rsulfuratus: re: maps, yes I have a rather fancy Photoshop map with layers for climate, many kinds of borders, etc. it is in need of some updating and haven't had a chance to do this, but perhaps will on Friday (which I have off)
[2023-11-08 11:06 AM] rsulfuratus: re: whereabouts, yes, simplification is good. i think for tracking complex npcs who travel a lot whereabouts is pretty clunky
[2023-11-08 11:06 AM] rsulfuratus: what is really useful is a way to basically tag "is the place where the PCs met the NPC their home or just a place they were traveling through"
[2023-11-08 11:07 AM] rsulfuratus: and separately, it is useful to track "was the person originally from the place where they were met"
[2023-11-08 11:12 AM] rsulfuratus: btw if you are messing around, would be nice to get get_EventsTable to parse DR-end as well as DR, maybe automatically generate a "X ends" event
[2023-11-08 12:07 PM] Deciusmus: I just got off talking for 5 hours straight of various meetings, so giving myself a little break from work to recover.  I've been meaning to add a DR_end to generate an end date for sure. Not sure about for inline, would you want something like:
    
    * (DR:: 1701) - (DR_end:: 1702): Something something
    
    Probably, right?
[2023-11-08 12:08 PM] Deciusmus: it works better for events files
[2023-11-08 12:08 PM] rsulfuratus: I would probably mostly use it for events files
[2023-11-08 12:09 PM] rsulfuratus: in lists I'm more likely to do: 
    - (DR:: 1701): Thing starts
    - (DR:: 1703): Thing ends
[2023-11-08 12:09 PM] rsulfuratus: i've been using DR-end, e.g. in Blood Years, for event files that span multiple years
[2023-11-08 12:09 PM] Deciusmus: For whereabouts, my thinking is that the the key goal of whereabouts is to indicate the difference between 3 things:
    * Were an NPC was from if it is different from where they live
    * Where an NPC lives
    * Where an NPC was when the party met them if it is different from where they live
[2023-11-08 12:10 PM] rsulfuratus: yes agreed
[2023-11-08 12:10 PM] Deciusmus: Less often, it could be used to track shared NPCs who move, i.e. someone like Vistra who might have lived in place X for years A-B and then place Y for years C-D. Simarly, there are some NPCs (i.e. Kaeso) who move during a campaign, and it can be useful to track that via whereabouts change
[2023-11-08 12:12 PM] rsulfuratus: yes, i think the flexibility to account for individuals with multiple homes or multiple excursions is useful, but ideally the structure is set up to make that an optional add on not the main purpose
[2023-11-08 12:13 PM] Deciusmus: It is probably NOT useful to use it to track goings and comings. i.e. if you had an NPC who is wandering across Dunmar (i.e. Sura) it is much more likely that you'd want do something like:
    
    - date: 1748-01-29, type: excursion, place: traveling , region: Dunmar
    
    Then to bother creating sequential records for each place they go
[2023-11-08 12:13 PM] Deciusmus: If you wanted to track a detailed timeline of moves, you'd create a bulleted list instead
[2023-11-08 12:13 PM] rsulfuratus: yes, agreed
[2023-11-08 12:15 PM] rsulfuratus: that said there are a few circumstances where i'd want sequential excursions. e.g., Antonia would be something like:
    - date: xxxx, type: home, place: Chardon
    - date: xxxx, type: excurision, place: traveling
[2023-11-08 12:16 PM] rsulfuratus: - date: xxx, type: excursion (or home?), place: Mirror of Soul trapping
[2023-11-08 12:16 PM] Deciusmus: I actually think that is better as a new home line
[2023-11-08 12:17 PM] Deciusmus: Well, maybe not
[2023-11-08 12:18 PM] Deciusmus: I actually think the key thing is that usually you want to define where the character is traveling or "settled somewhere"
[2023-11-08 12:18 PM] Deciusmus: and for the settled somewhere, you want to know whether is their origin/home/temporary place
[2023-11-08 12:19 PM] Deciusmus: but you dont want to track in whereabouts **where** someone is travelling
[2023-11-08 12:19 PM] rsulfuratus: yeah, exactly
[2023-11-08 12:19 PM] Deciusmus: so maybe type: excursion isn't actually correct
[2023-11-08 12:19 PM] rsulfuratus: thinking about this differently, i wonder if having origin as part of whereabouts is actually not that useful?
[2023-11-08 12:20 PM] Deciusmus: Probably not. Origin maybe should just be a  frontmatter field
[2023-11-08 12:20 PM] rsulfuratus: i think whereabouts should basically just be a "settled at x at y time"; "traveling in x1 at y1 time"; "settled at x2 at y2 time"
[2023-11-08 12:21 PM] rsulfuratus: (or based in instead of settled at, or whatever"
[2023-11-08 12:21 PM] rsulfuratus: basic idea would be that if party meets a random traveler on the road, you can just add "traveling in x at y"
[2023-11-08 12:22 PM] Deciusmus: I was thinking of it as:
    
    * moved to X at time Y
    * stopped in X at time Y until optional time Z
    * was travelling from time X to optional time Z
[2023-11-08 12:22 PM] rsulfuratus: what is difference in moved to and stopped in though?
[2023-11-08 12:22 PM] Deciusmus: so for someone like Kadmos, you could say:
    * origin chardon
    * whereabouts:
    ** was traveling from time x
[2023-11-08 12:23 PM] Deciusmus: The output
[2023-11-08 12:23 PM] Deciusmus: So the idea is that 
    stopped at is to capture the idea that someone was at a particular place at a particular time
    travelling doesn't have a place. It just means they were away from home
[2023-11-08 12:23 PM] rsulfuratus: ah okay
[2023-11-08 12:24 PM] Deciusmus: So the output text would for someone complicated would be something like:
    
    Origin: `<origin>`
    Based in: `<home>`
    Current location: `<traveling>` or `<stopped>` place
    Last seen by party: `<stopped place>` or `<home>`
[2023-11-08 12:26 PM] Deciusmus: It works best if we are relatively strict about saying if you are setting a last-seen-by-party date, you should also set a stopped
    And perhaps the default for a "Stopped nested inside traveling" would be 1 day
[2023-11-08 12:26 PM] rsulfuratus: is there a reason you'd ever care about a stopping place that wasn't also a "crossed paths with party" place?
[2023-11-08 12:26 PM] Deciusmus: In the simple case of I'm making up an NPC who is passing through but I don't know if the party is going to meet them and I don't want to decide where they are front
[2023-11-08 12:26 PM] rsulfuratus: ah
[2023-11-08 12:26 PM] rsulfuratus: okay
[2023-11-08 12:26 PM] Deciusmus: You would have ONLY  a stopped place for the place they are,perhaps without even a date
[2023-11-08 12:27 PM] Deciusmus: it would just render as
    
    Current location: `<stopped>`
[2023-11-08 12:27 PM] Deciusmus: with no based in or home
[2023-11-08 12:27 PM] rsulfuratus: I only ever make up full yaml information for people that you actually meet (or hear about), the notes I have for people that you remain unaware of just get recycled into my draft NPCs folder to be reused
[2023-11-08 12:28 PM] rsulfuratus: but i think it is generically cleaner to track stopped locations (which can be multiple) and last seen locations (when needed, always just 1)
[2023-11-08 12:31 PM] Deciusmus: So the idea would be:
    
    `**`Simple NPC who lives somewhere, no separate origin, no travel**
    Set origin to someplace, no whereabouts
    Renders as
    Based in: xxx
    
    `**`Simple NPC who lives somewhere, with a separate origin, no travel**
    Set origin to someplace, whereabouts to a single item without a date, with a type of "home"
    renders as
    From: `<origin>`
    Based in: `<home>`
    
    `**`Simple NPC who was met somewhere no info about origin or home**
    Set origin empty, wherabouts to a single item with a date and type of "stop", and a place
    Renders as
    
    Current location: (xyz)
    This is dynamic so it might render as (unknown) if it is before the stop date or after the stop-end date
[2023-11-08 12:32 PM] Deciusmus: `**`More complex NPC with a home, but potentially who was away from home for some period, but where doesn't matter**
    Set origin and home as desired, but set at least 1.
    Whereabouts is a single item with a start date and potential stop date, of type : traveling
    renders as
    
    From/based in as bove
    Current location: travelling (if within the travel date) or (home) if after the travel date
[2023-11-08 12:35 PM] Deciusmus: `**`More complex NPC who has a home and traveling and met PCs on travels**
    Set origin and home
    whereabouts has 2 items, a travelling and a stopped
    
    From/based as above
    Current Location : travelling or stopped depending
[2023-11-08 12:37 PM] rsulfuratus: right, I think this is the right idea
[2023-11-08 12:38 PM] rsulfuratus: so origin moves out of whereabouts, and becomes its own yaml item, which is just text
[2023-11-08 12:39 PM] rsulfuratus: whereabouts changes to have three types: traveling, stop, home
[2023-11-08 12:39 PM] rsulfuratus: then also start-date, end-date, place, region
[2023-11-08 12:40 PM] rsulfuratus: region should ideally always be either a top-level or a second-level note or folder in gazetteer
[2023-11-08 12:41 PM] rsulfuratus: start-date, end-date, and place should be optional, i think
[2023-11-08 12:41 PM] rsulfuratus: although start-date is really only optional for home
[2023-11-08 12:42 PM] rsulfuratus: (region could also be something in cosmology, of course)
[2023-11-08 12:42 PM] rsulfuratus: end-date is assumed to equal start date if blank for type = stopped
[2023-11-08 12:43 PM] rsulfuratus: end-date is assumed to equal current date if blank for type = traveling (unless current date `< start date)
[2023-11-08 12:45 PM] rsulfuratus: i haven't spent enough time looking at your event table code to figure out if this is the most sensible setup
[2023-11-08 12:46 PM] rsulfuratus: but it seems like if we just ignore homes without dates for parsing it isn't too bad
[2023-11-08 12:47 PM] rsulfuratus: could also move home out of whereabouts, have it a separate list that just takes start-date (optional), place (optional), region (required)
[2023-11-08 12:48 PM] rsulfuratus: then if you want "moved to X" to show up in the events table you need  to add it to an tagged list or
[2023-11-08 12:51 PM] Deciusmus: So a full spec would be something like
    
    Calculate the "home" and "origin" values as follows:
    1. If there is no whereabouts, home and origin are both equal to the origin front matter, and neither are considered dynamic.
    2. If there is exactly one whereabouts with type home, and that line has no date, or a date before bornYear-01-03, origin = origin frontmatter, home = home whereabouts and neither are considered dynamic.
    3. If there is more than one home whereabouts, or one home whereabouts with a date after bornYear-01-03, home = dynamic, origin = origin frontmatter
    
    Output the following information:
    
    For the origin line:
    * If origin is undefined, output nothing.
    * If origin equals home and home is not dynamic, output nothing.
    * If origin does not equal home, or home is dynamic, output "Originally from: `<origin>`"
    
    For the home line:
    * If home is undefined, output nothing.
    * If home is defined but not dynamic, and origin != home, output: "Based in: `<home>`"
    * If home is defined but not dynamic, and origin == home, output : "Location: `<home>`"
    * If home is defined and dynamic, output a DataviewJS call to get_DynamicHome (spec follows)
    
    For the current whereabouts line:
    * If home is dynamic, or there is at least one whereabouts line with a type of travelling or stopped, output a call to get_CurrentWhereabouts (spec follows)
    * Else output blank
    
    For the last seen by party line:
    * If there is at least one entry in the last seen by party section, parse the last seen by party dates to generate the correct output (spec follows)
[2023-11-08 12:55 PM] Deciusmus: Dynamic Home Spec:
    
    Find the home item in whereabouts that is >`= the current date and output "Based in: `<home>`".
    If there is no home item that is >`= current date, output nothing
[2023-11-08 12:57 PM] Deciusmus: Current Whereabouts Spec:
    
    Throw away all whereabouts lines without a date.
    Throw away all whereabouts lines with a start date >` current date.
    Throw away all of the whereabouts lines with an end date `< current date.
[2023-11-08 12:58 PM] Deciusmus: If there is 1 stopped line and 0 travelling lines and any number of home lines:
    Current location: `<stopped>`
[2023-11-08 01:00 PM] Deciusmus: If there is 1 or more stopped line and 1 travelling line and any number of home lines and the date == one of the stopped date:
    Current location: `<stopped that matches date>`
    
    If there is any number of stopped line and 1 travelling line and any number of home lines and the date != the any of the stopped date:
    Current location: `<travelling>`
[2023-11-08 01:01 PM] Deciusmus: If there are no stopped or travelling, use home.
[2023-11-08 01:02 PM] Deciusmus: If there are stopped and home but no travelling, use last stopped
[2023-11-08 01:03 PM] Deciusmus: So basically the idea is:
    
    * If you only have a single item that matches, we use that
    * If you have a traveling value and a stopped "inside" that traveling period, we use the stopped location only if the date == the stopped date (i.e. stopped has an implicit end of start)
    * If you are NOT travelling, the stopped has no implicit end and we use it instead of home if it matches
[2023-11-08 01:03 PM] Deciusmus: If you JUST have traveling and no stopped, we use travelling
[2023-11-08 01:04 PM] Deciusmus: So for example
    * Home = 1703
    * Stopped  A= 1719
    * Stopped B = 1720
    
    We use stopped A in 1719, Home before 1719, Stopped B after 1719
[2023-11-08 01:04 PM] Deciusmus: So for example
    Home = 1703
    Stopped  A= 1719
    Stopped B = 1720, end 1721
    
    We use Stopped B only until 1721, home after that
[2023-11-08 01:05 PM] Deciusmus: So for example
    Home = 1703
    Travelling = 1718
    Stopped  A= 1719
    Stopped B = 1720
    
    We use stopped A only for 1719, stopped B for 1720, travelling for anything after 1720
[2023-11-08 01:05 PM] Deciusmus: etc
[2023-11-08 01:08 PM] rsulfuratus: i think the only change i would make is to have stopped always have an implicit end == start if not specified
[2023-11-08 01:08 PM] rsulfuratus: in the case of just a stopped line, the output would be Current Location: (unknown)
[2023-11-08 01:08 PM] rsulfuratus: if the current date != stopped date
[2023-11-08 01:09 PM] rsulfuratus: the argument is that most of the time, if you just have a stopped line, that is an NPC who was just passing through a place, and you have no idea where they were before or are going after
[2023-11-08 01:10 PM] rsulfuratus: maybe they are still there - maybe they are traveling elsewhere
[2023-11-08 01:10 PM] rsulfuratus: the point is that information hasn't been invented yet and shouldn't be assumed
[2023-11-08 01:12 PM] rsulfuratus: traveling, on the other hand, is probably fine to just assume continues into the future, unless it is explicitly decided the person stops
[2023-11-08 01:13 PM] Deciusmus: Right that makes it easier as well
[2023-11-08 01:17 PM] Deciusmus: Basically, instead of the spec I wrote.
    * Assume that all home dates have an implicit end date of "death year"
    * Assume that all travelling dates haven an implict end date of "death year"
    * Assume that all stopped dates have an implicit end date of start date
    
    If there is exactly 1 stopped whereabouts. Use that. If there are multiple stops whereabouts use the last.
    If there are 0 stopped whereabouts and exactly 1 travelling whereabout, use (traveling). If there are multiple travelling ones use the last.
    If there are 0 stopped and 0 travelling, use the home. If there are multiple, use the last
    
    If the year is after the death year, and no whereabout explicitly has start >` death, use (deceased)
[2023-11-08 01:21 PM] rsulfuratus: the way i'd do it is:
    Throw away all whereabouts lines without a date.
    Throw away all whereabouts lines with a start date >` current date.
    Throw away all of the whereabouts lines with an end date `< current date.
    
    check to see if we have a precise location: 
    for each stop 
     if stop_end `<= cur_date and stop_start >`= cur_date
      print Location: `<stopped location>`; break
    
    check to see if we are traveling:
    for each traveling:
     if travel_start >`= cur_date and !travel_end or if travel_start >`= cur_date and travel_end `<= cur_date:
       print Location: traveling in `<region>`; break
[2023-11-08 01:22 PM] rsulfuratus: could add as well the home checking, if you want someone with a dynamic home to have "Based In: `<home>`; Current Location: `<home>`" instead of just "Based In: `<home>`"
[2023-11-08 01:24 PM] rsulfuratus: alternatively, you could always just print either "Current Location: `<home>`" or "Current Location: (unknown)" if you don't have a stopped or traveling location
[2023-11-08 01:24 PM] rsulfuratus: anyway i think this makes sense as a general idea
[2023-11-08 07:49 PM] rsulfuratus: do you know why this doesn't work?
    ```dataviewjs
    await dv.view("_scripts/view/get_EventsTable", { yearStart: 1748, yearEnd: 1749, pageFilter: " \"_DM_/timelines/unified_timeline\" ",includeAll: true } )
    ```
[2023-11-08 07:51 PM] rsulfuratus: getting rid of the full path doesn't work either
[2023-11-08 08:05 PM] Deciusmus: is it a file or a folder
[2023-11-08 08:05 PM] rsulfuratus: file
[2023-11-08 08:06 PM] Deciusmus: You have a space between the leading quote and the path
[2023-11-08 08:09 PM] Deciusmus: includeBirth: input.includeBirth ?? input.includeAll ?? false,
            includeDeath: input.includeDeath ?? input.includeAll ?? false,
            includeRegnal: input.includeRegnal ?? input.includeAll ?? false,
            includeExcursions: input.includeExcursions ?? input.includeAll ?? false,
            includePartyMeetings: input.includePartyMeetings ?? input.includeAll ?? false

