# Discord DM – 2024-01-14

[2024-01-14 10:09 AM] rsulfuratus: about to leave, but going to tackle the github actions to build the site today. also messing around with a nice homepage.
    
    controlling page presence and page listing separately and on a per-campaign basis is probably the last challenge to tackle (aside from a few minor text cleanup things like fixing (DR:: ) tags). using globs in the prep script might be sufficient, but i'm going to mess around a bit with this later today
    
    i think actually getting rid of rooted would simplify things a lot though, because then you don't need to run the prep script, you can just control what to copy to docs via a glob pattern + obsidian frontmatter directly. the only reason the prep script exists separately is because it is needed to delete files you want to exclude from the rooting calculations
[2024-01-14 10:11 AM] rsulfuratus: i think probably this is the solution. gitignore globs are super powerful and also very easy to parse in python since there is a well-tested module to do this already. 
    
    so you could have a "unlist" glob file and a "delete" glob file
    
    alternatively or additionally you could have:
    unlistPage: `[campaign]`
    removePage: `[campaign]`
    frontmatter, which could take 'all' as a special keyword to always unlist/remove
[2024-01-14 10:12 AM] rsulfuratus: i think that, plus getting rid of rooting, would allow the export_vault.py script to handle all file operations directly, and allow basically infinite customization of what you want to include/not include
[2024-01-14 10:15 AM] Deciusmus: As long as it runs before links are manipulated so you get correct unlinked stuff. 
    
    But also separately I was going to look at making data view queries static as well. It could be worth having deleted prior to obsidian for that reason
[2024-01-14 01:26 PM] rsulfuratus: backlinks working:
![[../_discord_assets/image-1FE77.png]]
[2024-01-14 01:27 PM] rsulfuratus: needs a lot of cleanup
[2024-01-14 01:28 PM] Deciusmus: What did you do? It is the back links plugin?
[2024-01-14 01:28 PM] rsulfuratus: yeah
[2024-01-14 01:28 PM] rsulfuratus: just added an override to override the toc
[2024-01-14 01:29 PM] rsulfuratus: on `refactor-build-process` branch
[2024-01-14 01:38 PM] rsulfuratus: website icon/logo?
![[../_discord_assets/DALLE_2024-01-14_13.37.05_-_A_line_drawing-B0112.png]]
[2024-01-14 01:41 PM] Deciusmus: That looks cool
[2024-01-14 01:41 PM] Deciusmus: I found the back links code wasnt finding any back links. But maybe I’ll try again later
[2024-01-14 01:42 PM] rsulfuratus: there is possibly a windows-related bug: https://github.com/danodic-dev/mkdocs-backlinks/issues/3
[2024-01-14 01:56 PM] rsulfuratus: needs some work but the idea is there:
[2024-01-14 01:56 PM] rsulfuratus: 
![[../_discord_assets/image-D47E1.png]]
[2024-01-14 02:20 PM] rsulfuratus: 
![[../_discord_assets/image-E0D80.png]]
[2024-01-14 02:22 PM] rsulfuratus: still a few tweaks to make to put the buttons
[2024-01-14 02:22 PM] rsulfuratus: further left and fix the title color, etc
[2024-01-14 03:28 PM] rsulfuratus: i've been messing around a bit, and I think that it is going to be easiest to set things up in the following way.
    
    I am going to rename the taelgarverse-v2 to taelgarverse-site-generator. this is going to contain just the generator code.
    
    the actual website will have submodules for the generator code and the main taelgar repo, plus templates.
    
    the protocol will be:
    1. git pull to update the taelgar repo in the website
    2. run prep_for_export.py if you have need to delete files prior to obsidian staticification
    3. run prep_for_export obsidian template
    4. run export_vault.py (which will live in the taelgarverse-site-generator)
    5. git push to push to website and let mkdocs autobuild via github actions
    
    it is actually a lot easier to just have the export_vault code run prior to mkdocs build. this conceptually allows dumping literate nav and just writing the nav to mkdocs.yaml, which is a lot cleaner
    
    it also makes the whole github actions workflow a lot simpler
[2024-01-14 07:02 PM] Deciusmus: 
![[../_discord_assets/image-4721C.png]]
[2024-01-14 07:02 PM] rsulfuratus: ooh that's nice
[2024-01-14 07:02 PM] rsulfuratus: 
![[../_discord_assets/image-33E33.png]]
[2024-01-14 07:02 PM] Deciusmus: that is nice too
[2024-01-14 07:03 PM] rsulfuratus: might fiddle with the color scheme a bit but am probably going to make the new site live tonight
[2024-01-14 07:03 PM] Deciusmus: to get leaflet to work, the ```leaflet``` block needs to be replaced with a (small) html/javascript block
[2024-01-14 07:03 PM] rsulfuratus: the home page is configurable from mkdocs.yml
[2024-01-14 07:03 PM] rsulfuratus: so you can change the buttons / title easily
[2024-01-14 07:03 PM] Deciusmus: It is actually possible to just do directly in obisidian, given we don' t have a ton of leaflet maps, but it might be nicer to have the python code strip leaflet and insert a replacement
[2024-01-14 07:04 PM] rsulfuratus: that is easy
[2024-01-14 07:04 PM] rsulfuratus: still am going to replace (DR:: ) too
[2024-01-14 07:04 PM] Deciusmus: basically, given this:
    
    ```leaflet 
    id: region-map-sembara
    image: [[`[sembara-regions.png]]]` 
    bounds: 
    - `[0,0]`
    - `[2468, 2308]`
    height: 900px
    lat: 1200
    long: 1200
    minZoom: -1
    maxZoom: 3
    defaultZoom: 0
    unit: miles 
    scale: 0.5
    ```
[2024-01-14 07:05 PM] Deciusmus: you need to create this:
    
    ```
    `<div id="map">``</div>`
    
    `<script type="text/javascript">`
        document.addEventListener("DOMContentLoaded", function () {
    
                var map = L.map('map', {
                    crs: L.CRS.Simple,
                    minZoom: {minZoom},
                    maxZoom: {maxZoom}
                });
    
                
                var bounds = `[{bounds}`[0]`, {bounds}`[1]`;
                var image = L.imageOverlay('{fileLink}', bounds).addTo(map);
                map.setView( `[{lat}, {long}]`, {defaultZoom});
            })
    `</script>`
    ```
[2024-01-14 07:07 PM] Deciusmus: it would probably be best to have a template/leaflet.html where you just replace everything in {{x}} with the yaml element from the leaflet block
[2024-01-14 07:07 PM] Deciusmus: then I can tweak the html more easily
[2024-01-14 07:07 PM] rsulfuratus: what do you replace specifically? just "leaflet"
[2024-01-14 07:07 PM] Deciusmus: the entire leaflet code block
[2024-01-14 07:08 PM] Deciusmus: ```
    
    ```leaflet 
    id: region-map-sembara
    image: [[`[sembara-regions.png]]]` 
    bounds: 
    - `[0,0]`
    - `[2468, 2308]`
    height: 900px
    lat: 1200
    long: 1200
    minZoom: -1
    maxZoom: 3
    defaultZoom: 0
    unit: miles 
    scale: 0.5
    ```
    
    ```
[2024-01-14 07:08 PM] rsulfuratus: but where does the image link live then?
[2024-01-14 07:08 PM] Deciusmus: you pull it
[2024-01-14 07:08 PM] Deciusmus: so the leaflet code block is a yaml file
[2024-01-14 07:08 PM] Deciusmus: you need to read the code block as yaml
[2024-01-14 07:09 PM] Deciusmus: then the html template I give you has {{image}} i.e which gets replaced with the image
[2024-01-14 07:09 PM] rsulfuratus: a perfect
[2024-01-14 07:09 PM] rsulfuratus: we are about to have dinner but i will mess around a bit later
[2024-01-14 07:37 PM] rsulfuratus: if you just use single `{` and `}` in the template it is really trivial to do this in python, so e.g. `{image}`
[2024-01-14 07:37 PM] Deciusmus: ok
[2024-01-14 07:37 PM] Deciusmus: can do
[2024-01-14 07:37 PM] Deciusmus: just trying to clean up a bit
[2024-01-14 07:37 PM] Deciusmus: will push in a few min
[2024-01-14 07:40 PM] rsulfuratus: for the taelgarverse-site-generator, my basic idea is that site-resources are files that get copied to specific locations, and templates are used for auto-generation
[2024-01-14 07:40 PM] rsulfuratus: fyi
[2024-01-14 07:40 PM] rsulfuratus: will work out the full build procedure and update readme later, need to figure out the github actions step
[2024-01-14 07:46 PM] Deciusmus: Ok, I pushed
[2024-01-14 07:46 PM] Deciusmus: template/leaflet.html
[2024-01-14 07:46 PM] rsulfuratus: to which repo?
[2024-01-14 07:46 PM] Deciusmus: some subtle notes in the comments
[2024-01-14 07:46 PM] Deciusmus: mine
[2024-01-14 07:46 PM] Deciusmus: my fork of yours, rather
[2024-01-14 07:46 PM] Deciusmus: msackton/taelgarverse1720-2
[2024-01-14 07:47 PM] Deciusmus: I guess with your new approach it makes sense to share a repo for site generation
[2024-01-14 07:48 PM] Deciusmus: Important bits:
    
    1. I added a leaflet.css, you need to add to css extras in mkdoc
    2. the actual leaflet code is pulled from a CDN, so you don't need any JS. You will see a script tag on the leaflet.html
    3. A few key things in the comments, i.e. I could only get it to work with /assets/world-map.png instead of ../assets
[2024-01-14 07:48 PM] rsulfuratus: i added you to the taelgarverse-site-generator repo
[2024-01-14 07:49 PM] rsulfuratus: we are taking down our tree but in a bit i'll incorporate this
[2024-01-14 07:53 PM] Deciusmus: I'm not sure I understand how I'd use the taelgar-site-generator. I think you need to split some stuff into taelgarverse or it gets hard to share. I don't want the same toc as you, for example, so I either need a fork or the toc can't be in the site-gen repo
[2024-01-14 07:54 PM] Deciusmus: whereas some of the CSS does need to be, i.e. the CSS for leaflet
[2024-01-14 08:09 PM] rsulfuratus: The idea is you’d have your own toc in your website repo
[2024-01-14 08:09 PM] rsulfuratus: Just things aren’t properly organized yet
[2024-01-14 08:09 PM] rsulfuratus: Site generator is for css, shared templates, code
[2024-01-14 08:09 PM] rsulfuratus: toc, mkdocs.yml, etc is in website
[2024-01-14 08:09 PM] Deciusmus: right that makes sense it just wasn't organized that way so it was hard to visualize
[2024-01-14 09:14 PM] rsulfuratus: cleaned up export_vault.py. it now manages all files that live in the docs directory (so, the main md files, the home page, the literate navigation file, stylesheets, and site images like the banner)
[2024-01-14 09:14 PM] rsulfuratus: the source and destination of all these things can be set in the website.json config
[2024-01-14 09:15 PM] rsulfuratus: so for example you will want to set your nav and home to your own files, while the stylesheets and site images might make sense to have shared
[2024-01-14 09:15 PM] rsulfuratus: note that the home is copied inks are checked/upated, but the nav is generated after (this is the same as previous behavior)
[2024-01-14 09:16 PM] rsulfuratus: overrides are not managed by the script - you'll need to copy these manually from taelgarverse-website-generator to the appropriate directory in your website repo
[2024-01-14 09:17 PM] rsulfuratus: stil to do for me:
    1. write code to replace (DR:: ) with actual dates
    2. write code to replace leaflet code blocks with leaflet code and make sure that any necessary files are properly managed by export_vault.py
    3. set up github actions
    
    there are also a few display things i may fiddle with, for example with backlinks living in the toc nav we don't want to hide the toc nav for people/items, so there are a few tweaks to that
[2024-01-14 09:18 PM] rsulfuratus: i may also fiddle a bit with the color scheme (which is currently lifted entirely from my work page)
[2024-01-14 09:18 PM] rsulfuratus: might not get to this all tonight, we'll see
[2024-01-14 09:51 PM] rsulfuratus: changed hide_toc behavior so that hide_toc_tags option only hides the toc itself. there is also a hide_backlinks yaml option, controlled by hide_backlinks_tags in website.json. the right side nav is only removed if both hide_toc and hide_backlinks are true for a page
[2024-01-14 09:51 PM] rsulfuratus: if i do anything else tonight it will be late
[2024-01-14 09:59 PM] Deciusmus: I think backlinks on people are nicer on the bottom of the page. Not totally sure though
[2024-01-14 09:59 PM] Deciusmus: I almost have static dataviewjs logic working
[2024-01-14 10:00 PM] Deciusmus: Ie replacing code blocks with the dataviewjs output

