# Discord DM â€“ 2023-01-11

[2023-01-11 07:27 AM] Deciusmus: I have a lot of work to do today so probably can't mess around with obsidian much, but I think we are approaching templates the wrong way.
    
    DataviewJS is very hard to get exported -- I couldn't get the obs.html plugin to work, for example, and I think there are a lot of limits on html export with so much dynamic data -- for example the commercial obsidian publish doesn't really work well either with dataviewJS.
    
    For me at least, a key goal is to produce a website so the export challenges are somewhat blocking. 
    
    I *think* the right way to do this is to work with templater, which can replace active templates in the file on startup (and could, I think, replace all active templates in all NPC files on startup).
    
    So imagine something like this:
    * Add some blocking to find the basic info block and chronology block of an NPC file
    * Templater startup template that finds all NPC files, inserts the NPC header template in place of the basic info block and the chronology template in place of the chronology block
[2023-01-11 07:28 AM] Deciusmus: (and then process the template in the file)
[2023-01-11 07:28 AM] Deciusmus: It would mean that date-changes require a restart of the app but I think that is ok.
[2023-01-11 07:28 AM] Deciusmus: I guess it would make git a mess as we'd be constantly reverting each others NPC header blocks..
[2023-01-11 07:28 AM] Deciusmus: Hrm...
[2023-01-11 08:43 AM] rsulfuratus: yeah. right now I am focusing on session prep for Monday and just getting my notes organized into obsidian - while the javascript is fun it is more useful to me just to have everything in there (so I'm just using the templater npc header we have already).
    
    I think ultimately the best solution is a templater-based solution that creates NPC pages in a directory that is not shared on github. if we could automate the creation of pages from various pieces, and figure out a way to correctly handle links, that would probably work well. you'd just build the npc pages as part of the website build process. 
    
    links are the trickest thing because you'd want links pointing to the internal npc page for regular use and the autobuilt npc page for the website. there may not be a way around that.
[2023-01-11 08:44 AM] rsulfuratus: constantly reverting each others NPC header blocks is a bit annoying since it will often create merge conflicts which take time to sort out. I don't want to have to correct 20 merge conflicts each time I sync with the repo
[2023-01-11 08:47 AM] rsulfuratus: but we are both pretty good with computers so this shouldn't be an insolvable problem. 
    
    ultimately I also want to figure out a way to generate different websites for different campaigns (or, at least, have a way to filter the website build based on campaign tags) so it is worth the effort for me
[2023-01-11 08:57 AM] rsulfuratus: and also I am increasingly wanting to use the full power of obsidian. like, for my reference I want a table of NPCs with links to session notes that each appear in, and an NPC relationship graph that shows each NPC and the links to places/people that appear in their note, that sort of thing. just to help with tracking where everyone is (the mirror plus Delwath scrying all the time make me want to track lots of stuff, minimally so when I make something up spur of the moment I don't later forget it)
[2023-01-11 08:57 AM] rsulfuratus: so moving towards a system where we preprocess the vault somehow (with templater, or something like that) to produce the website is increasingly appealing
[2023-01-11 08:58 AM] Deciusmus: I mean ultimately maybe I'll finally learn Javascript
[2023-01-11 08:58 AM] Deciusmus: Conceptually, obsidiantohtml is the wrong way to do this
[2023-01-11 08:58 AM] Deciusmus: You want a plugin within obisidian that exports the reading views
[2023-01-11 08:59 AM] rsulfuratus: right, that is ideal
[2023-01-11 08:59 AM] Deciusmus: (+ backlinks + tags)
[2023-01-11 09:00 AM] Deciusmus: https://github.com/alangrainger/obsidian-share/blob/main/obsidian-share.js
[2023-01-11 09:00 AM] Deciusmus: is an example that works for a single page
[2023-01-11 11:23 AM] Deciusmus: Are your various "Races of Taelgar" documents canonical enough to port (in GM binder)
[2023-01-11 11:23 AM] rsulfuratus: mostly I think so. the mechanics no, but the lore yes
[2023-01-11 11:23 AM] Deciusmus: I find myself looking there for background on say, lifespan
[2023-01-11 11:24 AM] Deciusmus: and having it in obsidian would be easier
[2023-01-11 11:27 AM] rsulfuratus: dwarves (in the races v2) is very up-to-date, I updated for the riswynn solo
[2023-01-11 11:28 AM] rsulfuratus: elves are sort of up to date, but you could also incorporate some of the stuff from the elves doc in gdrive from working out the ka, etc
[2023-01-11 11:28 AM] rsulfuratus: stoneborn and lizardfolk I haven't done anything with for a while so those are up to date
[2023-01-11 11:29 AM] rsulfuratus: halflings are sort of up to date in gmbinder, there is also a doc of notes, mostly stuff from wellby via schwartz, that I shared with you in gdrive. this could all be dumped in a comment into a halfling obsidian doc
[2023-01-11 11:29 AM] rsulfuratus: humans are basically a stub and could be updated with the various strands of emmigration from hkar from gdrive
[2023-01-11 12:08 PM] Deciusmus: For halflings I copied everything from the doc to either the halflings doc or the first one doc, and left most in comments
[2023-01-11 12:09 PM] rsulfuratus: great
[2023-01-11 12:09 PM] rsulfuratus: I was thinking a lot about the website setup while walking to pick up my lunch and have some ideas for a solution
[2023-01-11 12:10 PM] rsulfuratus: I think the goals are as follows:
    1) have a shared obsidian vault that allows us to collaborate on worldbuilding, keep notes organized, and share NPCs across campaigns
    2) export a website that exposes relevant information for players tailored to a specific campaign
[2023-01-11 12:11 PM] rsulfuratus: the problem is that if we go deep into the note template / export direct from obsidian way to build a website is that while it works for 2, it makes 1 harder.
[2023-01-11 12:11 PM] rsulfuratus: links get messy, and there is no reason why your obsidian vault needs to display information correct for 1719, as long as the website does
[2023-01-11 12:12 PM] Deciusmus: true
[2023-01-11 12:12 PM] rsulfuratus: I was looking at the obsdiantohtml code, and it already reads through every markdown file to convert obsidian-flavored markdown to standard markdown for export
[2023-01-11 12:12 PM] rsulfuratus: it is all python, so I don't think it would be too hard for me to tweak this to add text based filtering
[2023-01-11 12:12 PM] Deciusmus: `[ although I do find having the age correct nice ]`
[2023-01-11 12:13 PM] rsulfuratus: right, that is super helpful because if Delwath and co are in sembara in 1749 I really want to be able to see that NPC x you made up would be 112 and should be dead
[2023-01-11 12:14 PM] rsulfuratus: what I would do is the following:
    1) have a structured tagging system for information that occurs at a specific time, that means that if current date `< tagged date, that paragraph should be stripped from the output. this should ideally be invisible in the reader view in obsidian, but can be processed by the python code that converts obsidian markdown
[2023-01-11 12:15 PM] rsulfuratus: 2) use dynamic npc bioblocks for our own internal purposes, and replace the codeblocks with year-relevant text via python for the web export (this should be fairly simple as long as NPCs always start yaml block - title - bioblock)
[2023-01-11 12:27 PM] Deciusmus: How hard is 2?
[2023-01-11 12:28 PM] Deciusmus: Is the idea to try to run the templater code somehow?
[2023-01-11 12:28 PM] Deciusmus: Or would it make more sense to have the templater block only be dynamic for age + current location?
[2023-01-11 12:29 PM] Deciusmus: I mean, realistically, the only thing I really care about is age
[2023-01-11 12:30 PM] rsulfuratus: if it is just for internal use we could just use the dataviewjs codeblock
[2023-01-11 12:30 PM] Deciusmus: and just not publish the bioblock to web?
[2023-01-11 12:30 PM] rsulfuratus: the python code swaps out the dataviewjs codeblock and replaces it with plain markdown built in the same yaml frontmatter
[2023-01-11 12:31 PM] rsulfuratus: I'd have to figure out a way to add an option to a fork of obsidiantohtml to set the date for the website
[2023-01-11 12:31 PM] rsulfuratus: but if I'm already tweaking it to custom process markdown files that shouldn't be that difficult
[2023-01-11 12:33 PM] rsulfuratus: basically I'd write a new version of this: https://github.com/obsidian-html/obsidian-html/blob/master/obsidianhtml/parser/MarkdownPage.py
[2023-01-11 12:33 PM] rsulfuratus: it already grabs yaml frontmatter and codeblocks
[2023-01-11 12:34 PM] rsulfuratus: could either modify that or write my own python script that sits between the md generation stage and the html generation stage of obsidiantohtml
[2023-01-11 12:40 PM] rsulfuratus: so the basic structure would be:
    1) obsidian vault contains all the information for all dates, and also includes dataviewjs codeblocks to dynamically generate things like NCP bioblocks, possibly NPC current location (this is a bit trickier because you'd then need a way to record where NPC is when - might be easier to just do this manually), possibly things like tavern information (founded X, destroyed Y), whatever else seems useful and fun for internal session planning / worldbuilding purposes. this is all done view dataviewjs and/or templater code in obsidian. 
    2) we have some kind of tag that is easy to parse in python that marks paragraphs that happen at a specific date, and potentially that are relevant/known only to a specific campaign. 
    3) to generate the website, we run obsidiantohtml, either in modified form or in combination with custom code. this modifies markdown pages to: a) replace dataviewjs codeblocks with static markdown, and b) remove paragraphs tagged with a date or a campaign that should not be included. once we have the modified markdown, we can run obsidiantohtml again to produce html from markdown.
[2023-01-11 12:41 PM] Deciusmus: Right, that makes sense
[2023-01-11 12:42 PM] Deciusmus: I think 3a -- replacing dataviewjs codeblocks with static markdown -- isn't really going to work generally
[2023-01-11 12:42 PM] Deciusmus: but for npcbioblocks and other special things would presumably be easy
[2023-01-11 12:42 PM] rsulfuratus: right, the assumption is that most dataview blocks aren't meant to be exported and will just be removed
[2023-01-11 12:43 PM] rsulfuratus: the only thing that gets replaced is structured stuff.
[2023-01-11 12:43 PM] Deciusmus: this works just fine, btw:
    
    ```dataviewjs NPCBioBlock
    ```
[2023-01-11 12:43 PM] Deciusmus: so it would be pretty easy to tag code blocks with "known purposes" and then just re-gen in python
[2023-01-11 12:43 PM] rsulfuratus: right that is what I was thinking
[2023-01-11 12:44 PM] rsulfuratus: it would work well for dynamically generated text from yaml frontmatter. wouldn't work so well for some other things, like producing an npc list using dataview queries
[2023-01-11 12:45 PM] rsulfuratus: but the latter could be done with a templater command that already produces static markdown, and would be in the campaign directory so wouldn't hit git issues
[2023-01-11 12:48 PM] Deciusmus: `%%` AFTER 1721 `%%`
    ## stuff
    sdj
    lkds
    `%%` AFTER 1721 END `%%`
[2023-01-11 12:48 PM] Deciusmus: seems fairly natural
[2023-01-11 12:48 PM] rsulfuratus: the only problem with that is that I am not sure where in the obsidantohtml code comments are stripped
[2023-01-11 12:49 PM] rsulfuratus: `<date:(DATE)>` text `</date:(DATE)>` might be easier, kind of pseudo-html
[2023-01-11 12:50 PM] rsulfuratus: ideally want something that is a) invisible in obsidian reader view, and b) is passed unmodified by obsidianhtml when it converts obsidian markdown to proper markdown
[2023-01-11 12:50 PM] rsulfuratus: might just need to play around a bit and see what works
[2023-01-11 12:51 PM] rsulfuratus: for now I would not switch to this system. but I will probably play around a bit over the long weekend with writing some python that takes as input a date and a markdown page and writes out a corrected markdown page, updating npc bio block and removing text as needed
[2023-01-11 12:52 PM] rsulfuratus: if that is easy can then get more complicated
[2023-01-11 12:52 PM] Deciusmus: honestly, the more useful thing would be to get an NPCBioBlock working
[2023-01-11 12:52 PM] Deciusmus: than removing text
[2023-01-11 12:52 PM] rsulfuratus: right maybe I'll do that first
[2023-01-11 12:53 PM] Deciusmus: hell, if we are willing to do HTML there is an even easier way to do it
[2023-01-11 12:53 PM] Deciusmus: `<div class="mindate1719">`
    sdj
    lkds
    `</div>`
[2023-01-11 12:54 PM] Deciusmus: as long as that is preserved intact, you can just have a  CSS style to set display:none
[2023-01-11 12:54 PM] Deciusmus: that isn't super flexible, but I bet there is a way to use html5 data attributes and CSS to make the date stuff work with no processing work at all
[2023-01-11 12:55 PM] Deciusmus: just a requirement to wrap the information in the right `<div>` blocks when righting
[2023-01-11 12:55 PM] Deciusmus: `*`writing
[2023-01-11 01:48 PM] Deciusmus: Bingo
[2023-01-11 01:48 PM] Deciusmus: My paragraph [[Tester]]
    { .time-event data-applies-to-date='1719 1720 1748 1749' }
    
    My paragraph [[Tester]]
    asf
    asd
    { .time-event data-applies-to-date='1748 1749' }
[2023-01-11 01:48 PM] Deciusmus: the applies to is a bit messy
[2023-01-11 01:50 PM] rsulfuratus: don't quite understand what that is supposed to do
[2023-01-11 01:52 PM] Deciusmus: page data:
    ```
    <%+ tp.frontmatter.born %>
    
    This data applies to both Clee and DuFr
    And we continue the paragraph with markdown like a [[Halflings|halfling]] link
    { .campaign-event data-applies-to-campaign='clee dufr' }
    
    This data applies to only DuFr
    This data continues and is about stuff that doesn't apply to Clee
    {  .campaign-event data-applies-to-campaign='dufr' }
    ```
[2023-01-11 01:53 PM] Deciusmus: CSS (for the website only)
    ```
    .campaign-event {
       display: none;
    }
    
    .campaign-event`[data-applies-to-campaign~="clee"]` {
      display: inherit !important;
    }
    ```
[2023-01-11 01:53 PM] Deciusmus: your CSS changes the applies to campaig to dufr
[2023-01-11 01:53 PM] Deciusmus: (for your website)
[2023-01-11 01:54 PM] Deciusmus: Display Result:
![[../_discord_assets/image-48C33.png]]
[2023-01-11 01:55 PM] Deciusmus: Depends on https://github.com/valentine195/obsidian-markdown-attributes plugin
[2023-01-11 01:56 PM] Deciusmus: But the basic idea is to apply CSS classes to blocks, and then use CSS selectors to hide stuff on the web
[2023-01-11 01:57 PM] Deciusmus: It is a little hacky for dates because CSS selectors can only do exact matches
[2023-01-11 01:58 PM] rsulfuratus: well, I have a python script that strips out codeblocks, replaces codeblocks at that are labeled (in the first line) NPCBioBlock with a custom NPCBioBlock generated from yaml metadata, and strips any text in a block that starts `%%`^Date:year`%%` and ends `%%`^End`%%`, and then overwrites the markdown file
[2023-01-11 01:59 PM] rsulfuratus: so you would run obsidan to html to produce markdown, then my code to clean markdown, then obsidian to html to produce clean html
[2023-01-11 01:59 PM] Deciusmus: You moved to fast ðŸ™‚
[2023-01-11 01:59 PM] rsulfuratus: still fiddling to make the parsing more flexble. could have the cleaned blocks start `%%`^Strip`%%` and then have properties (e.g. date=, campaign=)
[2023-01-11 02:00 PM] rsulfuratus: I actually think cleaning the markdown is more flexible than css classes
[2023-01-11 02:00 PM] Deciusmus: So... on the bio block, I think having a bio block is actually the wrong way to go
[2023-01-11 02:00 PM] Deciusmus: It was occuring to me that there are all kinds of things we might want to have different in a header block
[2023-01-11 02:02 PM] Deciusmus: `<%+ tp.(something) %>`
    
    is a lot nicer than the messy dataviewJS stuff
[2023-01-11 02:02 PM] Deciusmus: (the magic + means re-render each time you display the page)
[2023-01-11 02:03 PM] Deciusmus: And templator supports a Javascript format
[2023-01-11 02:03 PM] rsulfuratus: I haven't gotten the `<`%+ `>` to work with computed variables
[2023-01-11 02:04 PM] rsulfuratus: maybe I'm doing something simple wrong
[2023-01-11 02:04 PM] Deciusmus: ah
[2023-01-11 02:04 PM] Deciusmus: let me prove this first
[2023-01-11 02:04 PM] rsulfuratus: have a meeting now
[2023-01-11 02:04 PM] rsulfuratus: let me know if it works
[2023-01-11 02:08 PM] Deciusmus: `<%+ tp.user.getAge(tp.frontmatter.born, tp.frontmatter.died) %>`
[2023-01-11 02:08 PM] Deciusmus: it works
[2023-01-11 02:26 PM] Deciusmus: Ok, it works perfectly.
    
    Here's the way to do it:
    
    1. Add this JS to a file in _templates\templateScripts\getAge.js
    
    ```
    function getAgeString(yearBorn,yearDied,noteYear) {
                
        if (!yearBorn && !yearDied) return "(unknown age)";
        if (yearBorn && yearDied && yearBorn >` yearDied) return "(timetraveler, check your YAML)";
        
        let currentYear =  window.FantasyCalendarAPI.getCalendars()`[0]`.current.year
    
        if (noteYear) {
            currentYear = noteYear
        }
        
        // we have a born year, no died year
        if (yearBorn && !yearDied) {
            if (yearBorn >` currentYear) return "(not yet born)";
            else return (currentYear - yearBorn) + " years old";
        }
    
        // we have a death year, no born year
        if (yearDied && !yearBorn) {
            if (yearDied `< currentYear) return "(deceased)";
            return "(unknown age)";
        }
    
        // we have both    
        if (yearDied `< currentYear) {
            if (yearBorn >` currentYear) return "(not yet born)";
            return "(deceased) at age " + (currentYear-yearBorn);
        }
    
        return (currentYear-yearBorn) + " years old";
    }
    module.exports = getAgeString;
    ```
    
    2. In the templator config, set a user scripts folder (to _templates\templateScripts and click the little refresh icon. You should use "detected 1 user script, tp.user.getAge)
    
    3. Add `<%+ tp.user.getAge(tp.frontmatter.born, tp.frontmatter.died, tp.frontmatter.yearOverride) %>` to a page

![[../_discord_assets/image-6D825.png]]
[2023-01-11 02:27 PM] Deciusmus: 4. Click "reading mode"
[2023-01-11 02:27 PM] Deciusmus: It caches the result, so if you change the YAML you have to close the tab and reopen it
[2023-01-11 02:30 PM] rsulfuratus: does that work with obsidiantohtml? that is what does the exported markdown look like?
[2023-01-11 02:30 PM] Deciusmus: I assume it would have the `<%+ xxx %>` in it
[2023-01-11 02:31 PM] Deciusmus: but... I was basically thinking rather than an NPCBioBlock python script we could have a python script that basically replaces the simple line::
    
    `<%+ tp.user.getAge() %>`
    
    With a python-copy of the JS
[2023-01-11 02:32 PM] Deciusmus: Then the python duplicates less of the obsidian
[2023-01-11 02:32 PM] Deciusmus: so rather than regenerating the entire bio block you just replace the age piece
[2023-01-11 02:45 PM] Deciusmus: `<%+ tp.user.getValue(tp, "origin") %>`
    
    `<%+ tp.user.getAge(tp) %>`
    
    `<%+ tp.user.getDeath(tp) %>`
[2023-01-11 02:45 PM] Deciusmus: origin: OldTown
    origin-clee: OldTownDD
[2023-01-11 02:45 PM] Deciusmus: because my JS for getValue has "clee" hardcoded the preview renders as OldTownDD
[2023-01-11 02:52 PM] Deciusmus: obsidian html generated MD is:
    `<%+ tp.user.getValue(tp, "origin") %>`   
       
    `<%+ tp.user.getAge(tp) %>`   
       
    `<%+ tp.user.getDeath(tp) %>`
[2023-01-11 02:52 PM] Deciusmus: So... I think this would all work totally brilliantly
[2023-01-11 02:54 PM] Deciusmus: We just need a python function that runs on the generated markdown and:
    
    1. Finds all instances of the string `<%+ tp.user.getAge(tp) %>` and replaces it with the correct age string
    2. Finds all instances of the string `<%+ tp.user.getDeath(tp) %>` and replaces with the the correct death string
    3. Finds all instances of the string `<%+ tp.user.getBirth(tp) %>` and replaces with the the correct birth string
    4. Finds all instances of the string `<%+ tp.user.getValue(tp, "(something)") %>` and replaces it with the correct string based on the frontmatter and the input campaign
[2023-01-11 02:56 PM] rsulfuratus: that is pretty straightforward
[2023-01-11 02:57 PM] Deciusmus: And I'm playing around with generalizing to a "status" that would work for other types of dates
[2023-01-11 02:58 PM] rsulfuratus: yeah I don't really like location. want you want is "status: key, value" where key is a date and status is what is written for that date
[2023-01-11 02:58 PM] rsulfuratus: e.g. I want Arcus to be "petrified" for any date after march something 1748
[2023-01-11 02:59 PM] Deciusmus: what you really want is something like
    
    getPageStatus(tp, "status to use if not yet existing", "status to use destroyed")
    
    and
    
    getPageStart(tp, "prefix")
    
    and
    
    getPageEnd(tp, "prefix")
    
    ---
    
    Then you can have Arcus have:
    
    getPageStatus(tp, "not yet born", "petrified")
[2023-01-11 02:59 PM] Deciusmus: Or an inn that burned down in 1722:
    
    getPageStatus(tp, "not yet built", "burned down")
[2023-01-11 02:59 PM] Deciusmus: Or a regular person:
    
    getPageStatus(tp, "not yet born", "deceased")
[2023-01-11 03:00 PM] Deciusmus: But that isn't quite the same as born/died
[2023-01-11 03:00 PM] rsulfuratus: right but that can't report location. location is actually the thing that comes up the most - like, who is roaming around northern dunmar in Nov 1748 is a pretty relevant question for my session prep for monday
[2023-01-11 03:00 PM] Deciusmus: But is there any upside in tracking by date for that?
[2023-01-11 03:01 PM] Deciusmus: why not just do it by campaign
[2023-01-11 03:01 PM] rsulfuratus: because location changes by time within a campaign. one of the most common things I check my notes for is who is where
[2023-01-11 03:01 PM] rsulfuratus: for about 80% of npcs that doesn't change
[2023-01-11 03:01 PM] Deciusmus: But do you care about their location history?
[2023-01-11 03:02 PM] Deciusmus: At some level, the location is going to change only when you edit the frontmatter to give them a new location
[2023-01-11 03:02 PM] rsulfuratus: I care about location now, and "last known location" from the player perspective
[2023-01-11 03:02 PM] rsulfuratus: I guess just a "location now" and a "last known location" would be enough
[2023-01-11 03:02 PM] Deciusmus: Right, but isn't that just:
    
    last-seen-location:
    location-now:
[2023-01-11 03:02 PM] rsulfuratus: yes
[2023-01-11 03:03 PM] Deciusmus: and then use a campaign flag if needed
[2023-01-11 03:03 PM] Deciusmus: so it would work to have:
    
    last-seen-location-dufr:
[2023-01-11 03:03 PM] Deciusmus: (not sure how that works with dataqueries and such)
[2023-01-11 03:03 PM] rsulfuratus: can we agree on camelCase for metadata instead of words-by-dashes?
[2023-01-11 03:03 PM] Deciusmus: sure
[2023-01-11 03:04 PM] Deciusmus: The idea of the getValue(tp, string) JS function is that it gets the value out of the frontmatter that you pass as the string
[2023-01-11 03:04 PM] Deciusmus: But it does 2 things -- 
    1. Gets it live
    2. Allows for (value)_(campaign) to override (value)
[2023-01-11 03:06 PM] Deciusmus: Realistically the main use case of this would be something like:
    
    I want a halfling caravan to come to Cleenseau and rather than make up a whole new one, I grab the Charmhearts.
    
    But I don't want the location to be "Tokra" so I add
    
    currentLocation_Clee: Cleenseau
[2023-01-11 03:06 PM] Deciusmus: then getValue resolves Cleenseau for me and whatever is in currentLocation for you
[2023-01-11 03:07 PM] Deciusmus: On the other hand, if you steal some of my NPCs, because we are in western Sembara, you can add currentLocation_DuFr
[2023-01-11 03:08 PM] rsulfuratus: so I need to write a python function for each .js function, basically
[2023-01-11 03:09 PM] rsulfuratus: and then just run my processing script (which takes date and campaign flags) on the obsidiantohtml markdown
[2023-01-11 03:10 PM] rsulfuratus: I am also going to keep the code that removes `%%`^`%%` text `%%`^End`%%` blocks, where you can either have a ^Date: or ^Campaign flag
[2023-01-11 03:11 PM] Deciusmus: No
[2023-01-11 03:11 PM] Deciusmus: I have something much better
[2023-01-11 03:11 PM] Deciusmus: hold on
[2023-01-11 03:12 PM] Deciusmus: this is freaking making me learn JS the languag I hate the most
[2023-01-11 03:38 PM] Deciusmus: Does this seem too annoying:
    
    whereabouts: `[{date: 1740-10-11, place: Thing}, {date: 1710-10-11, place: other}]`
[2023-01-11 04:00 PM] Deciusmus: Ok
[2023-01-11 04:00 PM] Deciusmus: that was an unfortunate detour from my actual work... But
[2023-01-11 04:03 PM] Deciusmus: I think it would be pretty straightforward to make the following work:
    
    Define a whereabouts yaml frontmatter like:
    ```whereabouts: 
    - {date: 1740-10-11, place: on 1740, region: xx}
    - {date: 1720-12-12, place: "on 1720 dec"}
    - {date: 1710-10-11, place: on 1710}
    - {date: 1719-10-23, place: on oct 23}
    - {date: 1719-10-18, place: on oct 18}
    ```
    Define a yaml frontmatter of lastSeenByParty: xxx (that could have a campaign specific override)
    
    Define a dataview table that shows you both (a) everyone in a certain region as of a date and also (b) where the party thinks the person is
    
    Define a templater JS function that tells you for a specific NPC (a) where the person is and (b) where the party thinks the person is
[2023-01-11 04:05 PM] Deciusmus: If you pythonized the JS functions you could then have the HTML export versions have the actual location stripped and the party location be the location
[2023-01-11 04:06 PM] Deciusmus: for NPCs that you didn't care for all this detail, you could just do:
    
    whereabouts:
    - {date: 1-1-1, place: x}
[2023-01-11 04:06 PM] Deciusmus: Or, alternatively, the NPC template could be something like:
    
    Origin: (if specified)
    Home: (...)
    Whereabouts: (only if the whereabouts is defined)
[2023-01-11 04:08 PM] rsulfuratus: That seems pretty cool. Need to think about how many NPCs it would actually affect and whether it is worth the extra effort over just tracking a single location/last seen location
[2023-01-11 04:09 PM] Deciusmus: Ah
[2023-01-11 04:09 PM] Deciusmus: but the reason it would potentially be worthwhile is to make it easier to track for shared NPCs
[2023-01-11 04:09 PM] rsulfuratus: Hmm yeah thatâ€™s true
[2023-01-11 04:10 PM] Deciusmus: because the data is normalized, it doesn't impact either of us
[2023-01-11 04:10 PM] Deciusmus: and the dataquery stuff is a bit easier
[2023-01-11 04:10 PM] Deciusmus: the problem I was thinking was...
[2023-01-11 04:11 PM] Deciusmus: Let's say we did just:
    
    currentLocation: (somewhere in DuFr)
    currentLocation_clee: (somewhere in Clee)
    
    Then if you have a query that gets everyone in a certain location via a dataview table, it is going to show weird NPCs you don't care about
[2023-01-11 04:11 PM] Deciusmus: (if we ever have same locations)
[2023-01-11 04:12 PM] Deciusmus: Now, maybe, who cares
[2023-01-11 04:12 PM] Deciusmus: or we could just have he current location always be campaign specific
[2023-01-11 04:12 PM] Deciusmus: But actually, I think it would be possible to take into account born and died as well
[2023-01-11 04:13 PM] Deciusmus: So that you could get a location of everyone who is currently alive in a current region, regardless of who defined the NPC
[2023-01-11 04:13 PM] Deciusmus: You'd potentially want the dataview query to include "home" if the character didn't have a whereabouts
[2023-01-11 04:15 PM] Deciusmus: For example:
    
    ```dataviewjs 
    let pages = dv.pages("#NPC/testing")
    let currentYear = window.FantasyCalendarAPI.getCalendars()`[0]`.current.year
    let currentMonth = window.FantasyCalendarAPI.getCalendars()`[0]`.current.month
    let currentDay = window.FantasyCalendarAPI.getCalendars()`[0]`.current.day
    
    for (let group of pages) {     
    
        if (group.whereabouts) {
             let whereaboutsAtDate = group.whereabouts.sort((a,b)=>`a.date-b.date).find(f =>` f.date `<= new Date(currentYear, currentMonth, currentDay) )
             if (whereaboutsAtDate != undefined && whereaboutsAtDate.region == "Dunmar") {
               dv.paragraph(group.name)
               dv.paragraph("b." + group.born)
               dv.paragraph(whereaboutsAtDate)
               dv.paragraph("Party Last Met: " + group.lastSeenByParty.toString())
             }
        } else if (group.home == "Dunmar") { dv.paragraph(group.name)}
    }
    ```
[2023-01-11 04:16 PM] Deciusmus: that gives you a list of all of the NPCs that are currently in Dunmar
[2023-01-11 04:32 PM] rsulfuratus: that is pretty cool
[2023-01-11 04:37 PM] rsulfuratus: I have a meeting at 5 but will have a few hours after dinner to mess around. my understanding of where we are is:
    
    1) for dynamic templates, we will use Templater dynamic templates + user code, with a python script to replace `<` %+ `>` constructs in obsdiantohtml md output with the correct value from replicating the Templater user functions in Python. Initially this will be mostly for NPC headers but can extend to anything, just need to have an equivalent python function for anything to replace. 
    
    1a) for NPC locations, can use a complex whereabouts yaml frontmatter as needed, as discussed above 
    
    2) for campaign specific or date specific freeform text, will either use python text stripping based on `%%`^Date`%%` or `%%`^Campaign`%%` comments, or will use custom css and the obsidian-markdown-attributes
[2023-01-11 04:38 PM] rsulfuratus: honestly the most immediately useful thing to me is to get the dynamic templates (not necessarily with the whereabouts code) working, so if you can push your js files I can fiddle tonight with reimplementing in my python filter, and then at least we can update the NPC blocks to be dynamic immediately, and have that work with website exports
[2023-01-11 04:40 PM] rsulfuratus: if the whereabouts stuff is already working in your test code may as well include it even if I don't immediately use it (there is a bit of an issue here in that I don't necessarily want to encode crucial secret whereabouts in metadata since I can't use the `%%`SECRET `%%` comment for my github filter there, although I could write another github filter that would clean up just the whereabouts location specifically I guess
[2023-01-11 04:45 PM] Deciusmus: Right, I didn't think about the whereabouts for secrets (but you'd have the same problem for any location-based NPC with metadata)
[2023-01-11 04:46 PM] Deciusmus: I will push something soon, just trying to clean it up a bit
[2023-01-11 04:46 PM] rsulfuratus: I think using whereabouts is actually pretty useful for this because it is really easy to write a github filter that just replaces the place:  with place: unknown`[1]` etc for any place tagged with ^secret or something like that
[2023-01-11 04:47 PM] rsulfuratus: just would need to think a bit about how to encode it so that it still works with dataview
[2023-01-11 04:48 PM] Deciusmus: do:
    
    - { date: x, place: y, region: z, secret: 1 }
[2023-01-11 04:48 PM] Deciusmus: then replace the place/region with unknown
[2023-01-11 04:48 PM] Deciusmus: that should work
[2023-01-11 04:48 PM] rsulfuratus: right that
[2023-01-11 04:48 PM] rsulfuratus: that would be easy
[2023-01-11 04:49 PM] Deciusmus: the one annoying thing btw is that the dates have to be full dates, i.e. y-m-d
[2023-01-11 04:49 PM] Deciusmus: but it is easy enough to use y-01-01 when you dont care
[2023-01-11 04:49 PM] Deciusmus: if any date isn't a full date, it all breaks down
[2023-01-11 04:49 PM] rsulfuratus: sure that's fine
[2023-01-11 04:50 PM] rsulfuratus: probably 80% of NPCs don't need whereabouts, 10% just need one or two YYYY-01-01 to reflect cross-campaign shifts in location (e.g. vistra), and only 10% need anything more complicated
[2023-01-11 04:50 PM] Deciusmus: yeah
[2023-01-11 04:51 PM] Deciusmus: I mean, at some level, the other thing you could do would be just gitignore Vola, Kadmos, Cassion, and a few others
[2023-01-11 04:52 PM] rsulfuratus: I don't think it is that hard to replace whereabouts with a secret if it is well-structured
[2023-01-11 04:52 PM] Deciusmus: true
[2023-01-11 04:52 PM] rsulfuratus: but yeah if I can't get the secrets filter working that is easy. it is only like 10 or so NPCs and all are ones you wouldn't really use in your campaign anyway
[2023-01-11 04:52 PM] Deciusmus: I mean, that is better but realistically neither my game nor my general design to do collaborative worldbuilding will be impacted in the slightest if you drop a handful of "key" npcs from the shared set
[2023-01-11 04:56 PM] rsulfuratus: last question, did you get the css class thing working or should I still include the text filter for history stuff in my python?
[2023-01-11 06:07 PM] Deciusmus: I did get it working but it is a bit messy
[2023-01-11 06:10 PM] Deciusmus: OK
[2023-01-11 06:10 PM] Deciusmus: I pushed my JS files
[2023-01-11 06:10 PM] Deciusmus: See the specifications.md for details
[2023-01-11 06:15 PM] Deciusmus: If you have a mechanism that uses date comparisons to strip I think that is better than the CSS
[2023-01-11 06:16 PM] Deciusmus: the css stuff requires something like
    
    { .timeline-event data-date-applies="1719 1720 1721 1748 1749"}
[2023-01-11 06:17 PM] Deciusmus: and if the current year is not one of 1719, 1720, 1721, 1748, or 1749 it won't appear
[2023-01-11 06:17 PM] Deciusmus: which is a bit of a mess
[2023-01-11 06:19 PM] rsulfuratus: okay, well you can also just use my `%%`^Date:`%%` thing which will take YYYY-MM-DD format or YYYY format
[2023-01-11 06:19 PM] rsulfuratus: that is already written. I can make an option to turn it off but it shouldn't affect anything as long as you don't have `%%`^Date strings lying around your markdown
[2023-01-11 06:42 PM] rsulfuratus: just looking at your javascript this should be trivial to reimplement as python, it is basically just changing how the metadata is parsed and a few small other things
[2023-01-11 06:56 PM] rsulfuratus: I am also planning on checking metadata in my python script, and if born/built/created is after current year, the page is not built and instead you get a "This `<type>` doesn't exist yet!" where `<type>` is replaced by whatever is in type of the yaml frontmatter
[2023-01-11 06:57 PM] rsulfuratus: the page will still exist so as not to break any links but there will be no information on it
[2023-01-11 06:57 PM] Deciusmus: that makes sense
[2023-01-11 08:06 PM] Deciusmus: I'm getting carried away with an NPC template
[2023-01-11 08:06 PM] rsulfuratus: great
[2023-01-11 08:07 PM] Deciusmus: how do you feel about prompts?
[2023-01-11 08:08 PM] Deciusmus: like, does it make sense to do Alt-N (for new file from template) pick NPC, and then get prompted for stuff?
[2023-01-11 08:09 PM] rsulfuratus: eh. I don't see a huge advantage
[2023-01-11 08:10 PM] rsulfuratus: a lot of the time I'm doing something like just click-creating a bunch of npcs from session notes and would prefer to just create all the pages and then fill in metadata etc later
[2023-01-11 08:10 PM] rsulfuratus: it doesn't really seem faster to have prompts, you still need to type the same text
[2023-01-11 08:11 PM] rsulfuratus: I guess one place where it would be useful is if you can select from existing notes, e.g. if we had stuff in the gazetteer with type = region, and when you create an NPC it prompts you to select a home region, create a new one, or skip
[2023-01-11 08:11 PM] rsulfuratus: that would keep things organized in the sense that right now I am somewhat inconsistent about how big a "region" is
[2023-01-11 08:13 PM] rsulfuratus: but overall I think prompts are more likely to break my workflow then help it
[2023-01-11 08:17 PM] Deciusmus: The main reason to do prompts is I can't figure out how to get the frontmatter and main template to play nice together
[2023-01-11 08:17 PM] Deciusmus: that is, if you have one "NPC" template with both the frontmatter and the bioblock it doesn't really work without prompts
[2023-01-11 08:17 PM] rsulfuratus: ah. right. I played around with this for a while when I first started messing with templater. this is why there is a separate NPC-yaml and NPC-header template
[2023-01-11 08:18 PM] Deciusmus: Right now it has the following features:
    * Prompt for name
    * Try to auto-create species and ancestry from the folder name
    * If it can't, prompt for species using the Species\ files as the source for an auto-complete list
    * If species is human, prompt for ancestry
    * Prompt for gender
[2023-01-11 08:19 PM] Deciusmus: * Prompt for home in the form of "somewhere, town, region"
[2023-01-11 08:19 PM] Deciusmus: auto-link "somewhere", "town", and "region" if they are places with notes, otherwise dont
[2023-01-11 08:20 PM] Deciusmus: populate 
    home: 
    with
    Somewhere, Town, Region
    
    populate
    homeRegion with region (never linked)
[2023-01-11 08:20 PM] rsulfuratus: right, but what happens if I am writing session notes, come to an NPC that doesn't exist, click the link to auto-create the note in my New Notes folder, and then insert the template into the new note?
[2023-01-11 08:21 PM] Deciusmus: in that situation you'd get a lot of prompts
[2023-01-11 08:21 PM] Deciusmus: unless you moved the note to the right folder first
[2023-01-11 08:22 PM] rsulfuratus: there needs to be a "just insert the post yaml stuff" template anyway since we already have (partially filled) yaml blocks for 100+ NPCs that I don't necessarily want to redo
[2023-01-11 08:23 PM] rsulfuratus: I would suggest an NPC-yaml, NPC-text and NPC template, where the NPC template can have prompts if you like
[2023-01-11 08:23 PM] rsulfuratus: but realistically I will probably mostly just insert yaml and then insert text
[2023-01-11 08:24 PM] Deciusmus: I was thinking of a "convert" template which reads an existing file, fixes up the frontmatter, and then recreates with the current text post-pended
[2023-01-11 08:24 PM] Deciusmus: it could potentially even delete existing bio-blocks
[2023-01-11 08:24 PM] rsulfuratus: that would be nice
[2023-01-11 08:24 PM] Deciusmus: i.e. to convert 100+ npcs to "live bio blocks"
[2023-01-11 08:25 PM] Deciusmus: what about a template that asks you where to move the file to when you insert
[2023-01-11 08:25 PM] Deciusmus: so when the file is in the new note folder, when you insert the template it prompts for where to move it to, and then calculates what it can from there
[2023-01-11 08:25 PM] rsulfuratus: that would be useful, yes
[2023-01-11 08:27 PM] rsulfuratus: I still will make for myself at least a template that inserts a yaml block and a template that inserts the text, but a full "build NPC" template with prompts and a "convert old NPC" template would be very useful. I can always split the build NPC template and remove the prompts if I want
[2023-01-11 08:27 PM] rsulfuratus: I like having the flexibility to make like a Dunmar template, a dwarf template, etc that inserts partially-filled yaml for things I'm doing a lot of, even if temporary.
[2023-01-11 08:28 PM] rsulfuratus: if I'm processing a bunch of Chardonians it is great to copy the default yaml, type in the common fields, make a new hotkey, and just blast through a bunch.
[2023-01-11 08:31 PM] Deciusmus: Well, but my template will do that auto for you if you just do it in the Chardonians folder
[2023-01-11 08:31 PM] rsulfuratus: the templater stuff to replace is always in the format `<%+ tp.user.<FUNCTIONNAME>(<ARGUMENTS>) %>`, right?
[2023-01-11 08:31 PM] Deciusmus: yes
[2023-01-11 08:31 PM] rsulfuratus: it won't autofill Chardon as home and Chardonian Empire as homeRegion
[2023-01-11 08:31 PM] Deciusmus: true, although it could
[2023-01-11 08:31 PM] rsulfuratus: but again, like I said, I'm happy to chop up your stuff for my own workflow if I want to
[2023-01-11 08:39 PM] rsulfuratus: the first argument to FUNCTIONNAME is always tp, right?
[2023-01-11 08:59 PM] Deciusmus: yes
[2023-01-11 09:22 PM] rsulfuratus: I almost have the python converter working, there is some fiddliness with properly parsing the arguments
[2023-01-11 09:35 PM] Deciusmus: would it be easier if it wasn't json?
[2023-01-11 09:36 PM] rsulfuratus: will templater break if you quote the json? e.g. ```{ "startPrefix": "built", "preExistError": "(not yet build)", "endPrefix": "burned down in"}```
[2023-01-11 09:37 PM] rsulfuratus: I am using a json module to read it in but it complains because the variable names aren't quoted
[2023-01-11 09:39 PM] Deciusmus: works fine
[2023-01-11 09:41 PM] rsulfuratus: still have one bug in the getCampaignValue I'm trying to fix but python converter otherwise almost ready
[2023-01-11 09:51 PM] rsulfuratus: input:
    ```
    ---
    built: 1599
    destroyed: 1742
    yearOverride: 1743
    reignStart: 1741
    died: 1742
    location: abc
    location_clee: 123
    ---
    
    _<%+ tp.user.getAgeBasedValue(tp, { "startPrefix": "built", "preExistError": "(not yet build)", "endPrefix": "burned down in"}) %>_
    `<%+ tp.user.getAgeBasedValue(tp) %>`
    `<%+ tp.user.getRegnalValue(tp) %>`
    
    Location: `<%+ tp.user.getCampaignBasedValue(tp, "location") %>`
    ```
[2023-01-11 09:51 PM] rsulfuratus: output:
    ```
    ---
    built: 1599
    destroyed: 1742
    yearOverride: 1743
    reignStart: 1741
    died: 1742
    location: abc
    location_clee: 123
    ---
    
    
    _built 1599 - burned down in 1742 at age 143_
    b. 1599 - d. 1742 at age 143
    reigned 1741 - 1742 (1 years)
    
    Location: 123
    ```
[2023-01-11 09:52 PM] rsulfuratus: leaves unmatched functions alone, e.g.:
    ```
    Not replaced: `<%+ tp.users.newFunction(tp, "argument") %>`
    
    Regular text
    ```
[2023-01-11 09:53 PM] rsulfuratus: ```
    Not replaced: `<%+ tp.users.newFunction(tp, "argument") %>`
    
    Regular text
    ```
[2023-01-11 09:53 PM] rsulfuratus: the only thing is that in the json argument to the age function, both the keys and the values need to be in double quotes or the code will throw an error
[2023-01-11 09:54 PM] Deciusmus: does it work if the arg is not specified at all?
[2023-01-11 09:54 PM] Deciusmus: I figured most of the time the defaults are correct
[2023-01-11 09:54 PM] rsulfuratus: yes, it used the same defaults as your javascript
[2023-01-11 10:21 PM] rsulfuratus: pushed my convert_markdown.py code
[2023-01-11 10:22 PM] rsulfuratus: haven't extensively tested but seems like it works
[2023-01-11 10:22 PM] rsulfuratus: will test more later
[2023-01-11 11:03 PM] Deciusmus: I pushed my NPC template
[2023-01-11 11:03 PM] Deciusmus: And a short readme
[2023-01-11 11:03 PM] Deciusmus: Need to update it to read default species/ancestry/homeregion from taelgarConfig.json rather than hardcoded in the javescript
[2023-01-11 11:04 PM] Deciusmus: also, you have to downgrade the template plugin to 1.15.3 from 1.16
[2023-01-11 11:04 PM] Deciusmus: `<`%+ templates are broken in some places in 1.16
[2023-01-11 11:06 PM] Deciusmus: If I get a chance my next project will be to use the whereabouts stuff to:
    * create a JS function like `<%+ tp.user.getWhereabouts(tp) %>`
    * create a JS function like `<%+ tp.user.getKnownWhereabouts(tp) %>`
    
    Add those to the template
[2023-01-11 11:07 PM] Deciusmus: Then add a converter template that updates the frontmatter and regens the bio block

