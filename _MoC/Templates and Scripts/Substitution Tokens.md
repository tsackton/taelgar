The following substitution tokens can be used in display defaults to substitute data from the frontmatter. Note that in all cases, the code attempts to handle missing data 'correctly', i.e. a line like: `<ancestry> <species> of <primary>` will strip the "of" if there is no primary. This code is not massively tested, so bug reports of failure to strip correctly is appreciated. 

Note that all tokens are treated as lowercase, so `typeOf`, `typeof`, and `TypeOf` are the same

Allowed tokens:

* `name`: the name as generated by NameManager.getName. This will be linked and cased as per the format specifier (see below) and will include the correct definitiveArticle and title from the page
* `pronunciation`: the pronunciation from the page
* `pronouns`: the pronouns or calculated pronouns from gender
* `typeof` or `type`: the page type. This is either the actual `typeOf` from the frontmatter, or a calculated value based on tags. The calculated value is `place` if the page has any place tags, and `item` if the page has any item tags
* `subtypeof` or `subtype`:  the `subTypeOf` metadata element, or a calculated value, if there is no `subTypeOf`. `subTypeOf: ` in the frontmatter disables automatic calculation. The calculated value is the first subtag under `place/` or `item/` that doesn't match the `typeOf` or calculated `typeOf`. For example, a page with no `subTypeOf` and a `typeOf` of `ring` and tags of `[item/magical]` would generate a `subTypeOf` of `magical`
* `maintype`: The "primary type" of the page. Equal to the first non-null value from the following list: `subspecies, species, typeOf, calculated or actual subTypeOf, calculated typeOf`
* `current`: The current whereabouts, or unknown if there is not one. This will follow whereabouts chains to generate a comma-separated list of locations at the current date
* `home`: The home whereabouts, or unknown if there is not one. This will follow whereabouts chains to generate a comma-separated list of locations at the current date
* `origin`: The origin whereabouts, or unknown if there is not one. This will follow whereabouts chains to generate a comma-separated list of locations at the create date or `0001` if there is no create date
* `lastKnown`: The last known whereabouts, or if there isn't one, the current whereabouts, or if there isn't one, unknown. This will follow whereabouts chains to generate a comma-separated list of locations at the last known date
* `lastknowndate`: The date of the last known whereabout, or the current date if there is no last known whereabout. Unknown if there is no date.
* `currentdate` or `targetdate` or `target`: the current date, from Fantasy Calendar or the target date of the string format operation, if one was provided
* `startdate`: the page start date. This uses the display value of the date. Blank if there is no start date
* `enddate`: the page end date. This uses the display value of the date. Blank if there is no enddate
* `end`: the end status from the display defaults
* `start`: the start status from the display defaults
* `age` or `length`: the age/length between the start and end dates, including units (currently, only years supported). Blank if cannot be calculated
* `ka`: the ka of an elf; unknown if no ka and the species is elf; blank if no ka and the species is not elf
* `population`: the population from the front matter, formatted as "pop. value" if the value is numeric, just the value otherwise
* `partof`: the partOf value from the front matter, following the change. Note that partOf for locations terminate the chain as they are considered whereabouts not partOfs. 
* `primary`: the list of primary affiliations, in the form:  `affiliation, affiliation, and affiliation`

Any frontmatter element can also be used as a token, in particular: `subspecies, species, ancestry`

### Special Cases
There are two areas that are handling specially:
* The generation of the `campaignInfo` uses the campaign info structure to format the `whereaboutsParty` line. This supports two additional tokens:
	* `met`: the "type" info from the campaign info line
	* `person`: the person or campaign, from the campaign info line
	* Additionally, the target date is the date from the campaign info line, so a typical line uses current for the location and can use currentdate for the date from the campaign info line
* The generation of the `affiliations` section uses two additional values:
	* `affiliationtitle`: the title of the affiliation
	* ``org``: the calculated list of affiliations with the same title, start, and end date, in the for: `a, b, and c`
	* Additionally, the startdate and enddate and age refer to the affiliation itself, not the page

### Format Specifiers

The token is specified like: `<token:format>` where the `:format` is optional. The format is a set of numbers and letters with the following meaning:

**Location chain filtering**
* numbers (in the form X-Y): the depth to follow the location chain. Valid for current, home, origin, lastknown only. If both X and Y are present, returns depth X to Y. If Y is missing, return depth X to end of chain. If X is missing, returns up to depth Y. A single number Y is equivalent to -Y. **Must be the first element of a format specifier string**. 
* F or f, only or exclude first element of chain. F is a synonym for 1, f is a synonym for 2-. 
* R or r, only regions (if R) or exclude regions (if r)
* P or p, only or exclude person
* L or l, only or exclude locations
* I or i, only or exclude items
* O or o, only or exclude organizations
* ! if set, will override the format specifier from the whereabouts line, so if you have a wHome like "The <current:3!>" and the whereabouts line has "formatSpecifier: 10" you get 3 not 10

**Linking**
* n, never link
* y, always link

If no format: link if page exists

**Casing**
* t, use title case
* s, use lower case
* u, use initial upper case 
* U, use initial upper case if and only if it ends up as the first element in the string

If no format: preserve case

**Other**
* a, add calculated indefinite article
* A, add calculated indefinite article if and only if it ends up as the first element in the string
* !, use this format specification preferentially (overrides any other format specification that might apply)

General order of precedence for format specifications is to start with the displayDefault specification, if it exists (e.g., <current:spec>), following the displayDefault chain as described in [[Metadata Spec#Display Defaults|Display Defaults]], and then if that string points to a particular whereabout location, apply the whereabout format specification for that location. However, the special character "!" in a spec overrides this behavior and ensures that spec will always be used. E.g.:
```
displayDefaults: {wHome: "<home:5!>"}
whereabouts:
- {type: home, location: place, format: "2"}
```
Will generate a 5-deep location chain for home, instead of a 2-deep location chain. 

