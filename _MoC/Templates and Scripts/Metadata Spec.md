# Header Block Metadata

Each header block is generated by a combination of the ```generateHeader``` template and three dynamic header scripts: ```get_PageDatedValues, get_RegnalValues, and get_Whereabouts```. Each of these four components uses different parts of the YAML frontmatter (metadata) to generate the correct data. Other YAML data can exist, but is not documented here.

### Display Defaults and Display Management
As much as possible, string data is generated through the display default system rather than being embedded in the JavaScript logic. Display defaults are a set of formattable strings that can be defined either in the ```metadata.json``` file or in the YAML frontmatter and are used to construct display data. Each display element can be set in one of three spots:
* Hardcoded, in the Javascript. This is used to provide simple baseline defaults so that the code does not encounter null-ref exceptions
* metadata.json's "per type" display information
* The YAML frontmatter for a page

The YAML wins over the per type data which in turn wins over the hardcoded values. This strings support replacement tokens which are documented below.

Note: the ```<loc>``` replacement token supports a "format string". ```<loc:{n}{case}>```  {n} defines the depth of the location chain walking, i.e. 1 is just this file, 2 is the file and its parent, etc. The default is 3, but this can be changed via the format string. {case} is either the letter "t" to force title case, or the letter "l" to force lower case. Otherwise it uses the preserving case.
### File Types

As much as possible, the header generation code does not care about file types and just generates a header based on the available frontmatter. However, the display defaults are managed per file type, defined as follows:
* event: Any page with a DR or DR_end or CY or CY_end frontmatter element
* person: A page with a person tag of any sort (i.e. person/ruler, person/pc, person)
* place: A page with a place tag (place, place/settlement, etc) or a leaflet ```location``` frontmatter tag
* organization: A page with an organization tag
* item: A page with an item tag

Any other page uses the "unknown" file type and the associated unknown file type defaults.

### Header Format
The header block is basically:

```
# Display Name
secondary information
> [!info]+ Box name
> Type-of information
> Dynamic: Date Information
> Dynamic: Leader/Regnal Information
> Part-of information
> > Dynamic: Location information (whereabouts)
> > Campaign information
> > Affiliations
```

|Line |Contents|
|------|-----|
|Display Name | The primary name of the page |
| Secondary Information | This is pronouns, pronunciation, and population | 
| Type of Information | This provides information for the type of thing the is - species, type of item, etc |
| Date Information | Provides birth/create and death/end date information |
| Leader Information | Parses the leaderOf frontmatter to provide a list of places this person was the leader of |
| Part-of Information | Provides a link to some larger thing (of the same type, usually) that this is part of. Part of relationships, unlikely location, is fixed, either in time or space |
| Location information | The current, home, origin, and last known whereabouts. Works with any item of item |
| Campaign Information | Outputs a line for each campaignInfo block | 
| Affiliations | Inputs information about the groups this page is part of |

### Type-Of Information
The following frontmatter elements contribute to the type of line, in this order. Each element that is present is joined with a space, so if there are five elements the line would be: One Two Three Four Five. Type of information not linked unless the target page exists in which case it is

Order: rarity, mundane/magical, ancestry, species, typeOf (but only if there is no partOf), primary affiliations (see below), ka, ddbLink.

Primary affiliations are any affiliation that has a typeOf that matches this page's affiliationTypeOf (an array). 
Example:
* A page defines displayDefaults.affiliationTypeOf : ```[ family, clan ]``` 
* A page defines 4 affiliations: House of Sewick (typeOf family), Gemcrafters (typeOf clan), Army of the West (typeOf army), The Cleansed (type of secret society)
* The type of line will include "of House of Sewick and Gemcrafters" at the end
* If no displayDefaults.affiliationTypeOf is set, no affiliations appear in the typeOf line

The person item type defines a default displayDefaults.affiliationTypeOf of ```[ family ]``` 

Some display elements are special:
* ka, if present, is displayed at the end of type-of in ()s, i.e. (ka 24)
* ddbLink, if present, is displayed at the end of type-of line as the word ```[Mechanics]``` with a link to the D&D Beyond page
* rarity, gender, typeOf and species are displayed lowercase (i.e. to make Phasing Stones become phasing stones)

### Part of line
The part of line uses the displayDefaults.partOf display string and the partOf frontmatter to generate a "chain" of what this thing is part of.

The display string supports several replacement tokens:
```
<loc> -> the actual location data
<typeof> -> the typeOf from the frontmatter, or the defaultTypeOfForDisplay from the display defaults if there is no typeOf in the frontmatter
<article> -> a or an, depending on whether typeof starts with a vowel
```

### Date Line
This calculates dates (from the DR, DR_end, born, died, created, and destroyed frontmatter) and then generates a single output line. This is one of three values:
* displayDefaults.pageCurrent, if the page is currently "alive" based on the target date
* displayDefaults.pagePastWithStart if the page is no longer "alive" and it has a start date
* displayDefaults.pagePast if the page is no longer "alive" but doesn't have a start date

These take the following replacements:
```
<length> - the time between start and current or start and end, in years
<start> - the start status, also from displayDefaults.startStatus
<end> - the end status, from displayDefaults.endStatus
<startDate> - the display value of the start date
<endDate> - the display value of the end date
```

If the page doesn't yet exist, this displays as **(page is future dated)**

### Frontmatter Rules
|Item |Usage|
|------|-----|
| name | Used to generate the name of the page |
| title | Used to generate the name of the page and as the default 'leader' word in the Leader Of section |
| gender | Used to generate pronouns |
| pronouns | Overrides the generated pronouns for the secondary information line| 
| pronunciation | Populates the pronunciation section of the secondary information line |
| population | Populates the secondary information line. Formatted as pop. value if numeric, or as a plain string if not|
| typeOf | What type of thing this is. It is used in the typeOf and partOf header lines and to match organizations |
| ka | An elven ka. Output as unknown if not specied for elves only |
| species | The type of creature this person is. Used for type of line |
| ancestry | The background / culture of this person. Can be used for subspecies (i.e. hag ) | 
| mundane | If true, adds a "mundane" word to the type of line field | 
| magical | If true, adds a "magical" word to the type of line field | 
| rarity | Adds to the type of line | 
